ну собственно да нет ну конечно до принцип телегии там телегена не телегена я вам сегодня
не обещаю конечно да сегодня будет попроще в том числе и фамилии дата флойд там форбелван
возьму если повезет то как занов и голдер но я думаю нам не повезет максимум клей вот по
анонсировали так но прежде как но как некоторые из вас уже заметили называется у нас тут
появилось новое домашнее задание да ну да ну как второе у нас единая дз на самом деле да
которая на фф там уже много знать более там будет еще больше вот потому что вот пока пока что что
вот осталось только сделать техническое действие это залить еще три задачи первая задача сделать
длинное деление вторая задачи сделай длинный корень к этой степени кадр 9 и вот так кстати
никто случайно там каких-нибудь инков эту задачу не встречал а да там была вот нет я вам даже даже
открою страшную тайну есть конспект от филиппа грибова как и искать правда честно скажу когда
вы прочитаете вы сильно удивитесь вот соответственно вот потому что потому что там потому что то что там
написано к тому что мы обсуждать никого отношения имеет даже в том числе по асимптутике почти почему
не знаю но впрочем впрочем по каким-то причинам с 21 года это никто не почему-то эти задачи не
даются вот но впрочем и не но от впрочем да как и такому статистическом программировании нужно
делить длинные числа вот значит соответственно что далее вообще по-хорошему говоря это должно
быть еще не все почему потому что вот сегодня сегодня мы скажем будем обсуждать потоки допустим
но вот то и пути но ты по идее нужно дать чудеса на потоке но мне почему-то возникает жуткое
ощущение что это многовато да редкий случай да но 3 нет он нет если бы у меня у меня там на
потоке больше задать чисто по потоке да и да там но там их там где-то там у них приличное
количество да поэтому поэтому будьте готовы к тому что соответственно они появятся до следующего
севестра нет у длин фурье чтобы контеста есть как всегда за счетной неделей ну там те там
только практически задачи потому что так что никаких проблем вот поэтому да то есть конечно
поэтому вы разделите на тех кто как бы и смог написать fft и тех кто зачет не
получит да вот но собственно дайфов то это не очень сложный алгоритм да но сложных алгоритмов
как вы помните у нас нету нет ладно денис может вам рассказывал неделю назад я не ставил да но
судя по вашей реакции сложного не рассказывал да ну или нет ну и понятно как бы сколько народу
вообще придет послушать принцип телегена а кто придет послушать флойда ну логично да ладно не
знали ну например если вспомнить чем мы закончили в прошлый раз то как бы флойд фортбелман
напрашивался мы даже обсуждали прошлый раз мы закончили на чем правильно на алгоритме до экстры
то есть мы с вами практически мы с вами полностью ладно есть уже переходить непосредственно к
занятию то что у нас в прошлый раз было мы в прошлый раз с вами в прошлый раз обсуждали что мы
как я ищу расстояние в графе от стартовой вершины до всех остальных предположений что все рёбра имеют
не отрицательный вес вот ну и прошли там этот собственно путь суровый путь от бфс одно там
алгоритма д экстры во всех его вариациях вот но вот но сегодня нужно тогда поговорить о том а что
делать если ребра бывают отрицательные вот казалось бы что это меняет отменяет прям все потому
что возникает такой интеллектуальный объект который он от которого при не отрицательных
выборах вообразить себе нельзя объект называется циклы отрицательного веса
чем он собственно так портит жизнь
вот
ну ладно не вот вот так
ну или вот так вот еще
да не помогло да ну хорошо хорошо вот вот теперь хорошо вот чем такой цикл портит жизнь
портит жизнь тем что у нас это иногда как-то начинает претепевать изменение понятие кратчайший
путь ну так нет формально это тоже самое что кратчайший путь это путь наименьшей
возможности стоимости и возникает ситуация когда его не существует ну у нас в принципе раньше
была такая ситуация ну потому что могла быть ситуация когда пути от с доте нет вообще допустим
но теперь у нас возникает другая ситуация бывает ситуация когда путь вообще в принципе есть
а кратчайшего пути нет чем даже это может быть не так вот даже можно вот так дает это такой
самый достаточно подлый случай как говорится ну да многие горели нова 30 на подобных случаях
потому что в чем прикол то есть прикол в том что оказывается но вместо того чтобы идти каким-то
вот путем по одному ребру или там каком-то количестве можете дойти до цикла отрицательной
стоимости накрутить себе сколь угодно мало и потом собственно дойти дота то есть поэтому получается
такие два два два два два случая то есть бывают случаи когда пути нет вообще бывают случаи когда
кратчайший путь наоборот есть вот мы эти случаи будем помечать как вот как длина пути равна плюс
бесконечность и минус бесконечность соответственно ну понадобится бесконечность пути нет минус
бесконечность скукуну ну то есть по сути рассмотрим все пути и рассмотрим точную ну чтоб совсем
формально было точную нижнююolicsих их длин и соответственно автоматически она бывает помимо
мимо вот всего прочего она бывает плюс бесконечности,
минус бесконечность.
Вот такая вот красота.
Ну вот и теперь возникает задача, а как быть в пути
найти?
Вот как идентифицировать эти случаи, а если кратчайший
путь существует, то его найти.
Ну вот тут возникает вот идея, действительно, вот
что делать, если мы не знаем там никаких умных фамилий.
Ну вот ничего страшного, просто кому-то на самом деле
может сразу придет в голову, ну мы же знаем динамическое
программирование.
Вот казалось бы, если вспомнить такие слова сочетания,
то практически сразу приходит в голову вообще какая-нибудь
такая динамика.
Например, там dp vt lt это длина кратчайшего пути, кратчайшего
пути, допустим, от v от s до v, состоящего из l-ребер.
Вот такая вот, например, красота.
И действительно, что-то в этом удобное есть, вот,
ну удобное, как минимум, то, что пересчитывать эту
динамику достаточно легко, правда.
Ну, например, там, потому что так можно и сказать,
что там dp от vl это будет равно там минимум по каким-нибудь
там, как будет написать.
Ну, давайте так напишем, там, минимум по всем ребрам,
у которых, которые заканчиваются в вершине v, там пишем, что
значит до этого, до начала этого ребра мы доходим
до, так, dp от e.start, да, это вот так, да, и плюс еще,
конечно, e.weight, то есть весы ребра, вот, то есть,
чего?
А, это да, это да, да, l-1, конечно, конечно, вот, так
что такая вот начинается красота и мы радуемся жизни,
да вот.
Ну, радуемся жизни, за какой симпатиком мы радуемся
жизни.
Ну, вообще, за, ну, давай, да, чтобы как не путаться
n или m, говорите в это, да, говорим v, e, ну, потому что
на каждом слое мы перебираем в точности все ребра, ну,
тут, конечно, надо перебирать именно входящие ребра,
но в принципе, если пересчитывать через динамику вперед,
собственно, можно ничего не разворачивать, вот,
то есть вот получается такая красота, остается только
естественный вопрос, а как нам, а как нам, собственно,
идентифицировать плюс бесконечности и минус бесконечности?
И еще вопрос, а до какого момента мне вот это l насчитывать?
Ну, только это еще доказывать надо.
Так, ну, нет, это осторожно, это неправда.
Да, так осторожно, да, подлости, да, так, ну, как, а, да, вот
было утверждение, да, что качали, да, что действительно
качали, да, что качайший путь у нас обязательно состоит
из меньше, чем Энн и Греберт, да, ну, даже если он существует.
Вот, да, верное утверждение говорит о том, что если существует
качайший путь, то существует качайший путь из меньше,
чем Энн и Греберт.
Да, потому что есть такая подлость, как циклы нулевого
веса.
И это, ну, и более того, кстати, там потом восстановление
ответа, они нам потом могут очень сильно портить жизнь
на самом деле, вот, но так-то, да, утверждение, но так действительно
утверждение, что если качайший путь существует, то существует
качайший путь в состоянии менее, чем Энн и Греберт.
Почему?
Ну, собственно, доказательство очень простое, давайте рассмотрим
какой-нибудь качайший путь, ну, вот, и заметим, что если
он случайно зациклился, то давайте из этого пути
цикл удалим.
Ну, отрицательного веса он быть не может, потому
что в противном случае тогда очевидно тут будет минус
бесконечность.
Вот, но мы можем удалить один цикл, если все еще
зацикливается, то другой, так как у нас с каждым удалением
цикла количество ребер на пути уменьшается строго,
то в бесконечном этот процесс не будет.
В какой-то момент мы удалим, в какой-то момент зациклы
исчезнут, и мы получим простой путь, а простой путь у нас
содержит не более чем Энн, не более чем Энн, минус
одно ребро, что очень приятно, да, то есть теперь мы можем
тогда написать такую динамику, то есть если даже значит
просто найти кратчайший путь и мы поверим, что
циклов отрицательного веса нету, ну или скажем,
что пока не думаем об этом, то в общем-то нам вполне
себе скажет, вполне себе хватит перебирать L до
модуль V минус ID, вот, так, да, и ответ на задачу еще
найти, конечно, да, то есть вот в конкретно такой
интерпретации, да, обратите, то есть она конечно жрет
квадрат памяти и все такое, вот, но значит там ans от
V будет просто минимум dp от V и L, где L прибегает от
нуля до модуль V минус 1, вот, то есть, то есть заметим,
что вот такой простой алгоритм действительно найдет длину
кратчайшего пути, если она конечно существует.
Понимаете, да?
Вот.
Более того, в принципе, если я тут напишу еще какой-нибудь
массив pR, где вот будет написано, откуда мы такую dp выкопали
с какого предыдущего шага, то в общем-то и восстановить
ответ никаких проблем не будет, понимаете, да?
Ну, пока скажите, при таком способе восстановления
ответа, да, у нас проблемы, вот, да, то есть, да, у нас
проблемы.
Ну да, нет, ну, смотрите, нет, если у вас задача найти
кратчайший путь именно от sdT, то в принципе, да, аналог
Хиршберга какой-нибудь может тут и сработать, в принципе,
хотя не факт, ну, как сказать, просто давайте вспомним,
потому что Хиршберг базировался на том, что мы как бы там
обе строки делим на две части, то есть, да, очень хочется
найти как бы, то есть, давайте найдем кратчайшие пути,
допустим, dL пополам и dL пополам, да, пожалуйста, вот, и как-то
разделим.
Но фишка будет в том, что мы и векшины на два множества
не поделим, поэтому это как бы и там, то есть, поэтому
получится там не совсем то, вот, то есть, ну, точнее
так, нет, хотя, ну, давайте так, а симптотику какую-нибудь
типа ve log v вы получите, вот, но я боюсь там, если хотите
там, чтобы это было именно ve, то как минимум придется
как-то еще что-то думать, вот, хотя, но вот, хотя возможно
необходимости в этом нет, потому что в принципе
некоторая часть олимпиадников вообще может не понять,
а в чем тут вообще проблема, потому что классический
алгоритм Форд Бодда Белмана выглядит вообще не так,
классический алгоритм Форд Бодда Белмана выглядит
вот так, ну, допустим, у меня вот это s, да, а да, так,
ну ладно, не так, и дальше начинается какой-нибудь
в духе.
Все.
Остановление.
Ну, восстановление, ну, давайте вот здесь еще, собственно,
еще порежки переприсваивайтесь, если что, и все, а потом стандартным
вайликом.
Чего?
Ну, ну, как сказать, и дальше, ну, вот, ну, вот, ну, и дальше
начинаем, ну, вот, ну, и дальше начинаются двухчасовые
припирания на экзамене, да, ну, вот, ну, вот, ну, вот, ну,
припирания на экзамене, да, в половине случаев
высекают, зачем это вообще надо, просто это работает
и все, ну, вот, ай-яй-яй-яй-яй-яй, ну, да, как вы уже дорадуете
студенты с таким подходом на физтехе уже не учатся,
вот, нет, ну, да, вот, но это уже правда, правда, не
совсем поэтому, но вот, и так, ну, то есть, действительно,
казалось бы, по умолчанию действительно не очевидно,
что в принципе с такой порежкой, но с такой порежкой
восстановление ответа вообще работает, хотя, хотя казалось
бы, хотя казалось бы, почему не очевидно, в каждой
вершине находится предыдущая, там предыдущая, в чем проблема.
Так, у вершины может быть несколько предыдущих,
и что, ну, сохраним какую-то из них, и что, потом дойдем
до С, в чем, да, как это, нет, ну, да, то есть, конечно,
если, то есть, да, то есть, к сожалению, про, там, чтоб
совсем просто, если думать об этом совсем просто, то,
да, есть действительно такая проблема, что, то есть,
мы знаем пока только одно, что, пока, в мире, ну, допустим,
пока для простоты, что нет циклов отрицательного
веса, допустим, не, если цикл отрицательного веса
есть, то как бы вы и путь не восстановите, ну, нет,
но тут как бы, да, просто, на самом деле, можно сказать
так, что для, там, действительно, ну, вот, что, то есть, просто
пока можно заметить, что, если кочайшие пути есть,
да, то, ну, во-первых, очевидно, что до любой вершины, которой
пути есть, он найден будет, это мы по индукции доказываем,
это мы просто доказываем по индукции, видо, рассмотрим
вот этот путь, и, там, допустим, длины шеи, там, из шестеребер,
и замечаем, что они по, там, за шесть итераций, а то
и за меньше, мы тут, на всех этих вершинах, действительно,
это, это найдем, логично, да, вот, но, но, но, но останется
только, вот, действительно, доказывать, как, там, то
есть, что будет с восстановлением ответа, потому что с восстановлением
это просто так, то есть, пока мы только можем гарантировать
лишь, что, там, что, что у каждой вершины есть пыры,
которые удовлетворяют свойству, что D здесь, D здесь,
плюс какой-то ребро, да, только, правда, D не здесь, а, там,
просто существует какая-то вершина, что вот тут какой-то
ребро, но тогда возникает закономерный вопрос, а почему
тут, собственно, если мы начнем таки по этим ребрам
ходить, у нас, там, не окажется какой-нибудь цикл нулевого
веса, по которому мы будем берить, но возникает такой,
вот, закономерный вопрос, но, на самом деле, как и странно,
вопрос решается проще, чем кажется, просто надо, там,
это более аккуратно делать, а делать надо следовательно,
надо просто по индукции доказывать, что в каждый
момент времени, на самом деле, D, то есть, вот эти порыжки
образуют дерево, имеющееся на текущий момент путей,
ну, типа, вот, нет, ну, вот, да, ну, да, ну, вот, но, правда,
надо аккуратно, потому что заметим, что порыжки за
цикл образовывать не могут, почему, пока, по крайней
мере, кажется так, действительно, давайте думать, вот, жило
было дерево, да, вот, то есть, в каждый момент времени,
ну, изначально у нас дерево порыжек вообще состоит из
одной вершины S, правда, если мы делаем релаксацию
у вершины с плюс-бесконечностью, то мы просто подключаем
вершину к дереву, правда, а теперь, ну, вот, ну, а теперь,
что тут в процессе может с этим деревом происходить,
в процессе мы могли взять какую-то вершину и пойти,
допустим, в какую-то другую вершину.
Вот, и неожиданно узнать, что, оказывается, из этой
вершины у нас нашелся более короткий путь, вот, но возникает
вопрос, может ли так случиться, что у нас, что у нас дерево
перестанет, что у нас возникнут какие-то проблемы?
Ну, во-первых, оно должно идти в предка, да, но на
самом деле тут, но на самом деле проблемы возникают
уже на тему того, а какие варианты мы хотим, вот,
мы просто хотим вариант, чтобы у нас порыжки образовывали
дерево или все-таки, чтобы они образовали дерево
у нас чем-то умным, потому что, в принципе, заметим,
что если у нас вариант такой, что у нас дешки дают какие-то
текущие пути, и по порыжкам мы эти текущие пути восстанавливаем,
то уже вот этот случай торжественно фейлит этот вариант, ну,
точнее так, для этой вершины может это и правда, а вот
для этих уже нет, по крайней мере, до ближайшей релакса,
до каких-то следующих релаксаций.
Вот, то есть, на самом деле, проблема начинается уже на этом этапе.
Спрашивается, что делать?
Ну, вот проблема, когда-то, да, вот почему-то, да, но вот почему-то,
только вы взять, чтобы пока вы не начнете это доказывать,
собственно, да, это будет очевидно, пока вы не попытаетесь это доказать.
А давайте мы будем считать, что у нас порыжки будут корректные в пути,
но мы не будем ничего говорить про дешки, то есть, мы не будем считать,
что дешки корректно делаются вующих путей.
Так, а что мы будем говорить?
Мы будем просто говорить, что по порыжкам можно найти оптимальные пути.
Так, именно оптимальные или вообще, или что такое оптимальные?
В каждый момент?
Сейчас, погоди, что такое в каждый момент?
После очередной релаксации мы, для каждой машины,
идя по порыжкам назад, устанавливаем прощайший путь.
Корректный путь, который сейчас дешка?
Да, который сейчас дешка, дешка может быть другой.
Дешка может быть больше, чем оптимальный.
Нет, ну, проверь, откуда мы, в самый начальный момент времени,
мы по порыжкам не установим вообще ничего, потому что ничего нет.
Ну, а есть вариант тогда в чем?
Ну, в том, что все пути, которые мы нашли, мы можем установить по порыжкам.
А про длину что мы установим?
Ну, по барабану, это айта, ну, возможно длина по барабану, главное, что мы можем установить.
А что про дешную длину?
А дешную длину, в смысле, она не больше, чем д?
Ну, почему не больше, чем d, то есть в конце у нас получится д rejection,
и в конце, если у нас в каждом момент в порыжках Elsa die越,
пути которые мы наusions по порыжкам не больше, чем текущая дешка,
в конце у нас дешка корректная, по порыжкам дерево, значит мы по порыжкам.
Это если порыжки дерево,
��고 что но мало wrists а может на порыжке построиться так что пыль будет�� togg
чтоocrы
Если мы идем в предко, то это означает, что у нас нашелся ситуация, а если мы идем в другой вершине, то это означает, что мы ее перепадаем.
Так, ладно.
Мы знаем, что за N шагов мы посчитаем корректные пути реверверной дины меньше или равно N.
Давайте скажем, что наша дерево порежет корректно в N окрестности вершины S.
Для всех вершин, для которых минимальный путь стоит изменен, чем N.
Когда дерево порежет будет для них корректно, она все остальные назовет.
На каждый раз мы будем просто управлять новые вершины.
Мы с N переходим на N плюс один.
Мы говорим, что это корректное дерево, но только для тех, которые находятся на расстоянии не больше N.
Но тут продолжает быть небольшая путаница, что конкретно такая реализация подразумевает, что путь может появиться и раньше.
Если он появился на L-то итерации, то это не означает, что он состоит не из L-ревервера,
он может и из большего числа ревервера вполне себе состоять, поэтому тут надо...
Как по мне, нет лишних изоциклов и не начало возникать.
Будет длинный путь.
Главное, чтобы зацикла не возникла.
Что?
Зацикла не возникла по окрестности.
Что такое окрестность?
Окрестность – это все вершины, которые не более чем по ангробрам достижены из S.
Почему это не возникло?
Может какая-то очень неудачная перешка.
Это действительно неприятно.
Если у нас сейчас перешки не соответствуют дешкам,
почему то, что мы пересчитываем из потомков деревья перешек предка,
то не означает, что мы сейчас зациклимся, если у нас дешки подойдут директные.
Почему это означает, что у нас сейчас появится цикл обязательно веса?
Это абсолютно нормально.
Ну, в поединке два.
Особенно если циклы.
Ну, да.
Ну, тут по-разному.
Нет, рассуждать с рассуждениями проблема.
Хотя в итоге на самом деле рассуждение в итоге придумывается.
Потому что можно сказать так.
Заметим, что у каждой вершины, у которой, по крайней мере, есть качайший путь,
наступит такой момент времени, в который дешка станет равна зиму.
Правда?
Вот.
И теперь тогда у меня утверждение такое.
Давайте для каждой вершины введем такое понятие ТВ.
То есть в какой момент времени в D от В появилось качайшее расстояние до В.
Так вот, мне почему-то хочется заявить мистическое утверждение.
Мистическое утверждение заключается в том, что когда вы в момент ТВ релаксируете D от В,
вы релаксируете ее какой-то вершиной ПР.
Которую мы запишем в ПР от В, в которой качайший путь уже нашелся ранее.
То есть у этой вершины Т была меньше.
Поэтому зациклов нет.
Вот мне почему-то хочется так сказать.
Зациклов, по крайней мере, нет.
Ну и пути в общем-то восстанавливаются, потому что вот это вот верно.
Не та-не та вершина, видимо, больше релаксироваться не будут, очевидно.
Так что мораль очень простая.
Если качайший путь существует, то более того, заметим, что это рассуждение никак не завязано
на том, что где-то там есть цикл отрицательного веса.
То есть утверждение такое, если до вершины качайший путь есть, то вот на самом деле вот этот код его восстановит.
Итак, давай.
Значит рассуждение такое.
Введем понятие ТВТ.
Это время, то есть момент времени, в который в D от В было записано реальное качайшее расстояние.
Утверждение P от V будет вести в вершину с меньшим ТВТ, с меньшей Т.
Логично, да?
Но тогда это означает, что если я пойду из вершины В теперь за ЧПР, то до С я дойду.
Зациклов не будет.
И более того, я утверждаю, что это и есть качайший путь.
Почему это качайший путь?
Потому что я нашел какой-то путь.
То есть я утверждаю следующее, что на каждом ребре будет выполнено то, что вот это равно вот этому.
Логично, да?
На последнем ребре это верно, потому что у нас сейчас релаксация ровно так происходит.
И более того, в стартовой вершине там написано уже, видимо, качайшее расстояние,
потому что было бы оно не качайшим, значит и вот это вот это не качайшее.
Соответственно, вот.
Ну а то, что там на предыдущих ребрах это происходит, это уже мы доказываем по индукции по времени.
Мы хотим сказать, что вот этот путь, который мы получим, в нем наибольшее ТВ это наша последняя вершина.
Наибольшее по Т.
Да, конечно же не по D.
Но по Т, да.
То есть это же не просто наибольшее, а просто вдоль этого пути Т строго возрастают.
Да, вот в этом идее.
То есть чтобы был зацикл, они как-то должны совсем одновременно появиться.
Да, то есть вот оказывается, что в общем-то...
Господи, слушайте, когда-то это был вопрос на лоту вообще.
Но это было лет восемь назад, поэтому да.
Ну, я вам так скажу.
Скажете, кто-то сидя прямо два-три часа на экзаменах, а да, такое было, на самом деле это придумывали.
Ну вот.
Я помню это вообще.
Я помню, даже до срока, кстати, кто-то сдавал.
Вот, кстати, ныне забытая опция.
Вообще есть такая опция до срока называется.
Но обычно, правда, до срока это типа лучшим студентам заслуги перед отечеством предлагаем опцию сдать экзамен заранее.
Но у меня обычно опция это называется, если вы хотите сдать экзамен когда-нибудь раньше, я могу это организовать.
Потому что если вы хотите, то, собственно, в общем-то мне тоже, на самом деле, вы же себя облегчите, на самом деле.
Поэтому я не против.
Но тем более, что, знаете, эта опция может быть актуальна.
Ещё почему?
Потому что традиционно экзамен по алгоритмам, он в расписании экзаменов последний.
То есть, какой он там?
Ну, будет он там традиционно?
Какой-нибудь там 24 июня плюс-минус эпсилон.
Чего?
Ну, нет.
Ну, как вам сказать?
Да.
В принципе, да.
С одной стороны, если вы там поймёте, что вы хотите сдать его, скажем, где-нибудь, там есть возможность сдать его в конце мая.
И тем самым приехать там на несколько дней раньше домой, то в принципе это вариант.
Нет, кто-то этим пользовался.
Да, не скажу, что это массово, но как бы.
Что?
Да.
То есть, как бы, если есть такое желание, то пожалуйста.
Вот.
Ну да.
Нет, я помню.
Нет, я помню.
Кто-то вот.
Нет, я помню, что я какой-то до срока, то ли что.
Потому что я помню, два человека сдавали.
Да.
Не причём это точно не перезнача, потому что людей звали Илья Степанов и Андрей Сергунин, если вам эти фамилии что-то говорят.
А так, если не говорят, бронзовые призёры 2019 года, если что.
Вот.
Так что дело было.
Ну вот.
И вот я помню, по-моему, как минимум кто-то из них точно сидел это придумывал и там что-то подобное придумал в итоге.
Да.
Такое.
Вот.
Но теперь вернёмся, собственно, к следующему.
Так.
А что же делать, если цикл отрицательной стоимости есть?
Вот.
Потому что, да.
Распространённая ошибка.
Ну вот.
То есть, ну, в принципе, нот распространённая ошибка может быть такая, например.
Давайте, хорошо.
Давайте L считать до, там, допустим, 2y-1.
Да.
И очень хочется.
Ну вот.
Хотя надо подумать.
Хотя это называется ошибка ли это?
А нет.
Нет.
Казалось бы, алгоритм такой.
Вот есть ans.
Вот давайте назовём его ans1.
А есть вариант ans2.
Давайте напишем то же самое.
Только L теперь бежит до 2y-1.
И напрашивается прям наглый вариант.
А давайте просто скажем, что если V, если вот здесь ans2 оказался меньше, чем ans1,
значит пишем минус бесконечности радость.
Нет.
Причём самое страшное, кажется, действительно верное утверждение, что если у нас,
потому что оказывается, что если мы нашли путь, состоящий из, там, n или более, там,
n или более ребер, который оказался короче, чем все простые пути,
как бы, значит, на этом пути явно цикл отрицательного веса находится.
Значит, казалось бы, всё хорошо.
Вот.
Ну вот да, этот тест я нарисовал не случайно.
Да, потому что то, что я перед этим сказал, это абсолютно правильно.
Неправильно, если вы на радостях скажете, что если этого не произошло,
то там минус бесконечности нету.
Собственно, да.
Собственно, тест я нарисовал не случайно.
Да, то есть там вот, собственно, V30 там на подобной задаче возникает вот ровно,
вот примерно из-за этого.
Потому что оказывается, что, то есть, может быть, сразу какой-нибудь пусть на минус много,
но вот и так, и как бы через цикл отрицательной стоимости вам очень много итераций придётся накрутить,
чтобы действительно его обыграть.
То есть, по крайней мере, за 2V вы не прибежали, там это не успеете сделать.
И за 3V, и за 4V, и вообще за сколько угодно, там за много, сколько V.
Проблема.
То есть, картинка называется не всё так просто.
Можно сказать, что если у нас где-то ответы изменились, то у нас есть цикл отрицательной длины.
А если ответы нигде не изменились?
Да, но это даст нам только маленькую задачу вида.
А есть ли у нас цикл отрицательной стоимости?
И если есть, то мы даже знаем, где.
А это может помочь для накажения, что может этот цикл из пола?
Ну, в принципе, да.
То есть, в принципе, да.
То есть, лайфхак высекает действительно такой.
Правда, ладно, давайте оговорим всё только сразу.
К сожалению, мы не умеем пока решать задачу, если цикл отрицательной стоимости.
Пока вот эта штука нам скажет только одно.
Есть ли цикл отрицательной стоимости достижимый из стартовой вершины?
Потому что заметим, что если из стартовой вершины что-то недостижимо, то мы по неё не знаем ничего от слова в ноль.
Но действительно.
То есть возникает, конечно, следующее.
Следующая подхачка.
Естественно, олипиадная подхачка.
А, так, ну хорошо.
Давайте скажем так.
На этих-то вершинах, наверное, минус бесконечность будет идентифицирована.
И ведь, действительно, смотрите.
Предположим, что у нас есть какой-то цикл отрицательной стоимости,
допустим, который достижим из вершины С.
Тогда у меня возникает мистическое утверждение.
Значит, утверждение заключается в том, что на каждой итерации,
то есть я утверждаю, что на каждой, то есть, ну, начиная с какого-то момента, да,
ну, скажем так, ну, в какой-то момент выяснится, что мы до каждой из этих вершин уже найдем расстояние меньше, чем плюс бесконечность.
Так вот я отпечатляю.
Начиная с этого момента у нас на каждой итерации будет там релаксация хотя бы по одному из этих вершин.
Вот такое у меня неожиданное утверждение.
А более того, начнется релаксация даже начиная с того момента, когда хоть на одной вершине появится что-то отличное плюс бесконечность.
Почему это так?
Ну, причина проста.
Значит, жило было v1, v2, v3 и, допустим, vk.
И тут, допустим, у меня веса w1, w2, w3 и так далее.
И тут, допустим, wk.
Для того, чтобы накануть очередной итерации, у вас релаксации не произошло, что должно произойти?
Ну, должно быть, что dp от v1, l.
Хотя в данном случае что такое релаксация?
Да, dp-шки обновятся.
Вот так.
Просто надо правильно сформулировать.
То есть, ладно, давайте...
Так.
Так-так-так-так.
Нет, меньше либо равно, тогда, но...
Нет, ну скажи так, ладно, это утверждение легче просто сформулировать в тех терминах на самом деле сразу.
Ну, от s2 следующий цикл ребер, но у нас есть путь, который прошел по этому циклу.
Ну, длина от s2 можно v1 плюс k ребер.
Ну, нет, причем тут путь-то вообще?
Нет, ну как вы знаете, что само все ничего не значит, может там...
Ну, хочется сказать, что если мы сделаем...
Хотя, если мы сделаем уже следующую итерацию, то есть модуль v, то есть количество v,
там какая-то dp-шка изменится, соответственно изменится p-r-шка,
и хочется сказать, что если мы пройдем от вот этой изменившейся вершины по этим p-r-шкам,
то мы найдем как раз этот цикл.
Нет, ну так-то да, так-то да.
Там вот эта модуляция, она передвинет нужное ребро,
но замкнется в этот цикл.
Нет, в принципе да.
Да, действительно, что...
Ладно, если мыслить в терминах этой dp-шки, то да.
Действительно, становится очевидно, что если до вершины,
вершина доступная, через нее проходит цикл отрицательной стоимости,
то заведомо ans2 для нее окажется меньше, чем ans1,
вот ровно потому, что если мы здесь в ans1 нашли какой-то путь до нее,
то длины не более, чем v-1,
то тогда мы можем найти путь не более, чем 2v-1, который будет меньше.
Почему?
Ну просто потому, что прибавим к этому пути цикл отрицательной стоимости.
Правда, для этого придется доказать еще маленькое утверждение.
Такое техническое.
Если существует цикл отрицательной стоимости,
то существует простой цикл отрицательной стоимости.
Ну а то вдруг длина этого цикла окажется больше, чем n.
Вот, ну это такое техническое утверждение,
я его даже в качестве упражнения оставлю,
то есть оно там тоже ничего страшного в нем нет.
Вот.
Но, соответственно, да.
Но тогда действительно окажется, что если эта вершина лежит на цикле отрицательной стоимости,
он доступен из S, то тогда эти вершины будут идентифицированы как минус бесконечности.
И тогда алгоритм, то есть более точный алгоритм, окажется таким.
Возьмем все вершины, у которых ans2 меньше, чем ans1,
и запустим из них, например, DFS.
Очевидно, до всего, до чего мы дойдем,
очевидно, это будет минус бесконечность.
Почему все остальное не будет минус бесконечность?
Ну, как минимум потому, что если до вершины расстояние минус бесконечность,
то тогда, просто я мог бы прям теория ему написать, да,
то есть расстояние до вершины v равно минус бесконечность тогда,
и только тогда, когда существует цикл отрицательной стоимости,
Какой цикл отрицательной стоимости доступный из С, из которого доступно В?
Ну, доказательства просто заметим, что будем рассматривать сколь угодно маленький путь,
рассмотрим какой-нибудь путь меньше, чем все простые.
Ну, раз у нас безконечность, а простых путей у нас конечное число, что приятно.
Рассмотрим этот путь, зациклы на нем есть.
Рассмотрим какой-нибудь первый зацикл.
Если цикл больше либо равен нуля, то вытянем его, повторим операцию.
То есть заметим, длина пути от этого стало только меньше.
И простым путь от этого не стал.
Тогда, получается, рано или поздно мы найдем просто цикл, на котором стоимость отрицателя.
Ну, доказательство окончено.
Так это понятно?
Пока вроде тут ничего сложного нет.
Ничего сложного нет, просто надо точечно разбираться.
Я понял, раз у нас минус бесконечность, то найдется сколь угодно маленький по весу путь.
Тогда, среди всех простых путей, а их конечное количество, можно выбрать минимум.
Мы берем вот это значение меньше, чем минимум.
Если у нас получится не простой путь, значит, на нем будет цикл, и он должен быть отрицательным.
Да, только если путь взял строго меньше, чем этот минимум.
То есть тогда на нем обязательно будут за циклы.
И просто подтверждается, что найдем отрицательный, потому что давайте если найдем не отрицательный, то будем его выкидывать.
И все.
Да, совершенно верно.
То есть надежное доказательство вот такое.
И алгоритм такой, в принципе, надежный, действительно приятный.
То есть более того, в качестве приятного бонуса именно такого алгоритма,
то есть какая-то ощущение, что на самом деле какой-нибудь цикл отрицательной стоимости где-то можно и восстановить.
Ну, например.
Ну, потому что есть подозрение такое, что допустим у нас до вершины v, у вершины v ans 2 оказался меньше, чем ans 1.
А давайте просто этот ans 2 реально восстановим.
Что-то мне подсказывает, что цикл отрицательного веса там найдется.
Правда?
Нет?
Что еще там?
Нет, ну там как всегда.
То есть найдется какие-то циклы, может быть циклы перед циклами, вот это все.
Но с другой стороны заметим, что вот этот алгоритм выкидывания лишних циклов на самом деле можно реализовать за линию.
Ну, там идея будет такая.
Идем по пути и помечаем вершины, которые были.
Идем, идем, идем, идем, идем, идем.
А вот это неожиданно произошел за цикл.
Теперь мы можем пробежаться по этому циклу и проверить, если у него стоимость больше либо равна нуля, а давайте его из пути выкинем.
Выкинем и пойдем дальше.
Ну, из стека, например, выкинем.
А если цикл оказался отрицательным, ну все, ура.
Значит, вот мы цикл нашли, и после этого давайте как-нибудь дойдем.
Ну, минус, конечно, такого алгоритма, что придется вам жрать квадратичную память.
Почему нет?
Почему?
При таком восстановлении как бы да, придется, да.
То есть нет, если ваша задача просто определить минус бесконечность плюс бесконечность или расстояние, то, конечно же, там каждый слой пересчитывается только через предыдущий, поэтому храним только два слоя, радуемся жизни.
Да, безусловно, безусловно, безусловно.
Вот это да.
Вот.
Так.
Сейчас, Кива.
Ну, так или иначе, как античная память, если у нас на синтоте B на E.
Я на B на E на 10 восьмой, то в памяти у тебя будет вызывать RG, а по времени будет B.
Если граф словно почти линейный, то у тебя примерно равно E.
То B на E равно, типа, 10 восьмой.
Ну.
Нет, ну как-то да.
Да, но по-разному нет.
Ну, как сказать, memory limit просто иногда и просто чистые заиздевательства могут и ужать.
То есть так-то этот вопрос можно было и при Хишбеке задать.
То есть как бы, спасибо.
То есть у нас там, ой, ау.
Нет, то есть как бы в Хишбеке это тоже вообще-то проблема, да, что, казалось бы, у нас там алгоритм СН квадрат быстрее, невозможно в принципе, как выяснилось.
Ну, если там только мы что-то новое не знаем про строки, да, тогда высекает вопрос, да.
А если длинный строк, то максимум 5000 спрашивается, как там может быть memory limit.
Ну, то выясняется, что если вам memory limit потом повесят 8 мегабайт, то как бы.
Не, будьте внимательны, кстати.
Да, я надеюсь, я не сильно большой спойлер открою, если скажу, что там вообще-то 2 года назад задачу с подобным эффектом даже на четверть финала подсунули московские.
Ну, вот, то есть что-то народ, то есть какая-то часть участников почему-то осталось сильно недовольна.
Ну, вот, но с другой стороны, ну, что подумать, это тоже алгоритм, его тоже надо знать, что вы хотите.
Вот, в общем-то там, ну, там, конечно, не это надо было там, что-то там с рюкзаком надо было что-то делать, но суть была та же.
Так, но правда, остается вот действительно вопроса, а действительно, а если мы вот в такой интерпретации это делаем, что можно сказать здесь?
Ну, да, да, то есть в принципе, да, то есть какой-нибудь какой-нибудь такой классик программирования, как Максим Иванов.
Емакс, вот, познакомьтесь.
Вот, да, Максим Иванов, собственно, там Олимпиадник из Саратов, там, по-моему, Дукрат, Дукрат и Серебряный Придер и CPC, по-моему.
Вот, значит, так вот, значит, Емакс предлагает следующее.
Вот, соответственно, он говорит так, а давайте-ка в этом месте сделаем еще одну итерацию, то есть не до n-1, а до n.
Ну, то есть все качайшие пути до n-1, первые итерации, в общем-то, уже будут найдены, мы это знаем, но давайте сделаем еще.
Утверждение, если у какой-то вершины произошла релаксация на n-1 итерации, значит, наверное, у нее минус бесконечности.
Вот, ну, неудивительно, да, но как мы уже и сказали, потому что если бы у него был качайший путь, то он за n-1 итерацию был бы уже найден.
Вот, но, а если релаксация не произошло, как бы, для вершины v на n-1 итерации, значит ли это, что у нее расстояние действительно качайшее, а не минус бесконечности?
Конечно нет, с тем же тестом, да.
Да, все не будут, но я утверждаю, что хотя бы одна будет.
Почему так? Давайте вот это неравенство мы запишем, оно нам сегодня будет помогать.
Так, вот давайте v-1, v-2, вот здесь уже это работает, v-1, v-2 и так далее.
W-1, W-2, W-3, бла-бла-бла, W-k.
Тогда смотрите, для того, чтобы на n-1 итерации не произошло релаксации, должно быть выполнено следующее.
Должно быть выполнено, что d от v-1 плюс wv-1 должно быть больше либо равно d от v-2.
d от v-2 должно быть плюс w-2 больше либо равно, чем d от v-3.
Значит d от v-3 плюс v-3 больше либо равно, чем d от v-4 и так далее.
И в конце d от v-k плюс w-k оказывается больше либо равно d от v-1.
Казалось бы, радость.
Вот. Заметим, что все неравенства, если мы говорим о цикле, доступном из S,
то очевидно, что к n-1 итерации все эти, то есть ни одной плюс бесконечности здесь не будет.
Понятно, да?
То есть поэтому, казалось бы, кайф, пока мы не начинаем эти неравенства складывать.
Потому что если мы их сложим, то получится
Сумма d от v-1 плюс сумма w-1 должна быть больше либо равно, чем сумма d от v-1.
Да, и везде прибегает от одного дока.
Вот.
Ну вот. Ну, собственно, так как у нас за цикл, то получается шлеп-шлеп.
И в результате окажется, что длина этого цикла оказывается больше либо равно нуля.
Упс, противоречие.
То есть вывод.
Пока, как только хоть кто-то из этих вершин перестанет быть плюс бесконечностью,
на самом деле, то релаксация на этом цикле будет происходить постоянно и всегда.
Поэтому получается, что мы не все вершины цикла отрицательного веса идентифицируем,
но хотя бы одну найдем.
Поэтому старый алгоритм вида возьмем все эти вершины, запустим из них DFS, продолжает работать.
Восстановление, конечно, цикла отрицательного веса я вам не обещаю.
Хотя...
Но да.
Но да.
Да, особенно если обойти прямо сейчас.
Хотя...
Ну, в принципе, оно похоже на правду, да.
Хотя, хотя, хотя, погодите.
Угу, угу, угу, угу.
Нет, вот, вот и да.
То, что опять же из цикла вроде так должно быть, но вот с конкретным доказательством могут быть проблемы опять.
Ну, как...
Ну, что-нибудь такое, да.
Пройдя от всех обновленных вершин назад до цикла и вот взять циклическую часть, мы найдем все циклы отрицательного веса.
Но, во-первых, нужно взять циклическую часть, а во-вторых, мы считаем циклы несколько раз.
Угу, возможно.
Нет, вот сейчас.
Нет, вот как...
Ну, мы до S-а можем не дойти, допустим.
Ну, если что, мы вот там скажем...
Если мы будем скакать от вершины VK до S по порежкам, то мы можем до S-а не дойти, потому что мы...
Да, я имею в виду, что, можно сказать, от вершин, которые дальше, чем этот цикл, пойти назад, но зациклиться...
Да, да, да, да.
Будет нет на нее сам.
Нет, ну, да, да.
Ну, вроде да.
Нет, останется такой вопрос, а почему мы действительно такое обязательно найдем?
Ну, опять же, циклы отрицательного веса.
Мы хотим все циклы отрицательного веса найти.
Да, да.
Хотя это вопрос, да.
Нет, все, нет, все мы не...
Нет, ну, как всегда, нет.
Нет, все там мы, может, и не найдем.
Нет, ну, все мы не найдем их.
Естественно, там бесчисленное множество.
Ну, ладно, численное, но если мы о простых циклах говорим.
А, ну да, не простых циклов, бесчисленные, конечно.
Но, но, но, но.
Ну, вот.
Но, как бы обычно у нас задача только, если...
Вот желательно, что если через вершину, то есть если там какая-нибудь минус бесконечности,
то покажите мне, пожалуйста, цикл отрицательного веса, который это идентифицирует.
Так.
Но, не знаю, можно жить по принципу, что
вот почему-то ощущение такое, что если какая-то вершина,
то есть как бы мы можем даже n-ую итерацию делать без релаксации.
А просто проверим, какие бы вершины могли бы проек apprenticeslerваться,
если бы мы n-ую итерацию запустили?
И тогда почему-то вот есть жуткое ощущение, что...
Есть жуткое ощущение, что все такие вершины,
которые могли бы проек рассироваться, то
как бы там по UErezhki дадут вам цикл отрицательного веса.
По крайней мере, слету не видно причин, почему это не так, да, типичная олимпиадная логика, да.
Ну да, это я придумал решение, я не понимаю, почему оно может быть неверно, значит надо писать.
Да, ой, что? Ва 38.
Чего?
Да.
Ну нет, у кого картично?
У меня поэтому, я говорю, у меня поэтому и с задачами нажать некие проблемы,
потому что я как бы не рискую писать решение, пока его не докажу.
А там некоторые жадники бывают из цикла, что пока ты доказываешь, тысяча человек его уже сдала.
Да, это буквально.
Да, я как-то на одном из последних раундов своей жизни, который я писал, я так погорел.
Найдем.
Сейчас, ну, корректно найдем минус бесконечности, это безусловно, да.
Так.
Нет, это тогда. Нет, у меня вопрос именно в другом, почему мы, собственно, вот это при таких скачках действительно там какой-то цикл отрицательного веса найдем.
Ну, хотя бы просто, допустим, я сейчас в хиленную итерацию нашел первую вершину V1, которая неожиданно могла бы прелоксироваться.
Почему скача по порешкам из нее или там хотя бы вот из VK мы действительно цикл отрицательного веса найдем?
Нет, DFS-то да, это понятно, да.
Каким образом?
Ой, ну, по-моему, там, ну, я не знаю, чем нам это поможет.
Нет, ну, очень хочется сказать, что да, мы пробежимся еще и порешки будут это, но с другой стороны, там в графе еще что-то есть.
Поэтому, как будет работать, это что-то непонятное.
Как всегда, нет, DFS, да. Нет, DFS мог бы там нам помочь, потому что, да, в DFS мы могли прописывать, из каких вершин мы куда пришли, это да.
Но как бы хотелось бы восстановить сам цикл.
А мне тоже хочется сказать, что это просто неправда, что мы, наверное, что мы можем там сделать одно или два, или, я не знаю, N, до конца этой трассы и пропишемся по порешкам.
То есть, если у нас в какой-то вершин цикл ведет в ребро, то есть, конечно, минус там 10, 9, то у нас никогда не замкнет.
Ну, за нормальную трассу не замкнет цикл порешек.
Нет, почему, может и, ну, смотря как делают порешки. Нет, вот почему, прямо сейчас, наверное, интерация, если он берет по этому ребру, то он как бы дает за цикл как раз.
Если до этого порешки, конечно, были именно вот такие. То есть, это как бы вроде нормально.
Если, например, вершина в БКАТ ведет в ребро, минус 9, мы не преодолевсируем.
Да, но мы, скажем так, мы...
А потом за следующий модуль Каэтерации обновим...
Нет, то есть мы же не обновим все порешки, мы не обновим порешку для БКАТ еще долго, потому что еще Каэтерация.
Нет, почему не обновим?
Не, тут, не, ну, да, хотя да, кстати, боль-то вот там...
Сейчас, тут как бы...
То, что мы доказали про Форт Бернер, до этого это некременимо.
Там одной личной трассы не хватит, а N дополнительной трассы не хватит.
А если есть путь в какую-то извершину цикла, который...
Дальше у тебя есть еще цикл.
Давай ты задлину цикл, и по этому циклу обновишь снова в тебе ответ.
Когда я тут знаю, что звена по циклу изнацикла не больше, чем N.
Ну, я тут вот не понял, что в принципе да.
Нет, есть, конечно, соблазн такое сказать, что в каждый момент времени ПРНшки у вас извершины перейдут либо в вершину S,
либо в цикл, причем почему-то хочется сказать, что отрицательные стоимости.
Потому что, в принципе, вообще, простое отвержение звучит так.
Если по ПРНшкам можно дойти до S, то эти ПРНшки задают путь, длина которого не больше, чем то, что сейчас в дэшке написано.
Так, давайте, так, утверждение такое.
В всех вершинах цикла будут написаны ПРНшки, которые зацикливаются.
Так.
В всех остальных вершинах не обязательно написаны корректные ПРНшки.
Опять же, вот этот пример.
Сейчас. Сейчас в каких вершинах еще раз написаны ПРНшки корректные?
Которые на цикле отрицательного веса, или для которых нет ни минуты конечности?
Так, цикл, ну вот.
Сейчас, которые не находятся на цикле, у которых не минус бесконечность, или у которых, которые на цикле отрицательного веса, я не понял.
Что значит корректное?
Ну, корректное так, что утверждение такое, что если до вершины есть корречайший путь, то по ПРНшкам он восстанавливается.
В этом мы вроде даже убедились.
Да, через вот, через технологию ТВ, да.
Так, через технологию ТВ мы убедились в том, что корректайшие пути ПРНшки действительно идентифицируют четко.
Получается, что для всех вершин на отрицательном цикле ПРНшки должны зацепиться.
Ну, вот, да. Они обязательно должны зацепиться, да, может быть, предперируют.
Нет, ну понятно, да.
Нету должны, но теперь...
Нет, ну как?
Нет, ну как должны?
А почему они должны зациклиться? Кто сказал, что они зациклиться?
Потому что они, так скажем, в ВЭС прийти не могут.
Почему в ВЭС прийти не могут? Они вам выдадут какой-то путь.
Давайте докажем, что для всех вершин на отрицательном цикле у нас ПРНшки не оказывают какой-нибудь цикл.
Так, сейчас еще раз. Чего ПРНшки?
Если вершина лежит на отрицательном цикле, то, идя по ее ПРНшкам после интерации, мы получим этот цикл.
Так, идя по ПРНшкам, мы получим какой-то цикл.
Почему?
А, слушайте, Оль, нет, есть более простое доказательство. Знаете какое?
Смотрите, что означает, что на Н-ной интерации вершина обновилась?
Это значит, что мы нашли путь длины не меньше, чем Н, который короче, чем все, что было раньше.
То есть, короче, чем все простые пути.
Вот.
То есть, это оно. То есть, это...
Сейчас. И чего?
Нет. Ну, скажем так, это...
Нет.
Нет, ну нет, просто это как бы, ну вот.
Нет, ну просто...
Так, сейчас.
Сперва восстанавливаем ПРНшку путь длины не больше, чем написано в ДД.
Только в ДД у нас уже записано более коротко, чуть простой.
Значит, даже цикл по циклу овеси.
Значит, ПРНшки мы узнаем, какой цикл по циклу овеси.
Ну, логика это вопросал. А кто сказал?
Тут логика это вопросал. А как...
Тут надо понять тогда. А как то, что написано в ПРНшках, связано с этими Д-шками, которые мы тут находим?
То есть, вот как-то связано.
Может, там в ПРНшках Q какая-нибудь написано, которая даст вам какой-нибудь простой путь.
То есть, пока нот.
То есть, как бы...
Ну вот.
Ну вот сюда. Было бы неплохо.
Нет, было бы неплохо.
Хотя, нет, была мысль такая, что, допустим, ПРНшки в какой-то момент времени дают...
То есть, ПРНшки из вершины В, допустим, вам в какой-то момент времени дают какой-то путь.
Вот дают, дают, дают, дают.
Вот мне теоретически очень хотелось бы заявить, что этот путь по длине не превосходит того ДРВ, который там сейчас написано.
Да, вот хочется мне почему-то такое заявить.
Может, такой вопрос.
Правда ли, что эти ПРНшки в любой момент времени расцикливаются?
Нет, но осторожно.
Кстати, да, интересный факт.
ПРНшки могут сейчас зацикливаться, а потом перестать зацикливаться, если что.
Ну, по крайней мере, слетают непонятно, как опровергают.
Вот.
Нет, ну ладно, но утверждение такое, действительно.
Жили были, что если по ПРНшкам можно дойти из С, то эти ПРНшки задают путь, длина которого не превосходит ДРВ.
Верно по индукции по времени.
То есть рассмотрим обдавление вот по этому ребру.
Тогда по этому ребру то, что написано, то есть D отсюда плюс вес равно D от В.
А вот длина вот этого пути, она у нас не превосходит, то есть при положении индукции не превосходит D от этой вершины.
Вот.
Да, то есть, ну вот.
То есть, нет, хотя не совсем так.
Конкретно в момент релаксации это так.
Но заметим, что в процессе вот эти ПРНшки, то есть в процессе, на самом деле, даже пока эта ПРНшка не меняется, вот эти ПРНшки могут меняться.
Ну, с другой стороны, заметим, что...
Нет, а вот непонятно.
Вот тут опять подлянка.
Смотрите, то есть как бы если у нас просто, допустим, у одной вершины там путь поменялся на другой, то как бы да, нам хуже не стало.
Вот именно для того, чтобы нам тут хуже не стало, мы и говорим, что тут меньше либо равно, пути они просто равен.
Но вот это вопрос, а что делать, если тут неожиданно произошел зацикл?
Мы побегали, побегали, побегали, а потом зацикл быть перестал.
Вот.
Да, в общем, повесились, да.
Зациклились, повесились, в общем, да.
Пишите за квадрат памяти, не ошибетесь.
А черт его знает, я не знаю.
Хотелось бы, хотя честно скажу, я не знаю, правда это или нет, может это и неправда.
Ну может, но нам не важно, если мы установим хоть что-нибудь, даже если мы будем просто идти по этому, удалять неотрицательные зациклы, в итоге найдем зацикл отрицательный, да, зато тоже устроит.
Ну может она раньше испортилась.
Да, которая так.
Да, да, да, только одна маленькая проблема, мы не доказали это утверждение.
Вот, вот что проблема, так-то да, план был именно такой.
Так-то да, вот как-то так, как-то.
Да, да, да, да, хотя, ой, слушайте, хотя, нет, все еще тупее вообще, хотя на самом деле тут, кажется, думать особо не надо.
Вообще, как бы, есть базовое свойство любой такой Д.
В каждый момент времени D от V это длина какого-то пути от S до V.
То есть существует такой путь, там простой, не простой, не знаю, но точно такой путь есть, да.
И более того, и более того, ПРЭшка корректно говорит, через какую предыдущую вершину такой путь мог бы проходить.
Логично, да.
То есть, вот.
Так, то есть, вот такое, теперь мы начинаем думать.
Давайте, допустим, мы, ну вот, то есть там, допустим, мы начинаем восстанавливать ответ.
То есть, допустим, мы начинаем восстанавливать ответ.
Ну вот, допустим, идем от вершины V, тут написано какая-то D от V.
В ней записано, что как бы последним ребром этого пути
могло быть вот это и это у нас предыдущее, допустим, в V1.
Так, говорим мы теперь, что у нас происходит в ПРе от V1.
Ну, заметим, там сейчас в Де от V1 находится, может быть, не тот путь,
через который мы релаксировали, собственно, В, конечно.
То есть там может, но он не больше, может он там меньше.
Вот. Поэтому, значит, мы рисуем, получается, V2.
Так. Нет, хотя, блин, опять все плохо.
Потому что действительно доказательства сейчас у нас,
то есть мы, конечно, сейчас докажем, что мы действительно зациклимся.
Потому что выясняется, что там действительно будет V3 и так далее.
То есть если мы случайно так дойдем до S, то получится путь не более,
чем D от V, но D от V меньше, чем все, что можно получить на простых путях.
Вывод из этого только один.
Вывод из этого только тот, что нас ждет зацикл.
Теперь выясняется вопрос, а верно ли, что на этом зацикле можно,
верно ли, что этот цикл простой, там что это цикл отрицательной стоимости?
Непонятно.
Так. Нет, ну наличие цикла да.
Но знаете, сокращение жизни хорошо.
Наличие цикла да.
Нет, если он в этом месте является циклом отрицательного веса,
то как бы да, мы уже можем возрадоваться в этом месте.
Вау.
Так.
По порешкам никогда не бывает цикла отрицательной.
Вот так.
Так, ну да, потому что когда впервые...
Ну это да.
А если так?
Да.
Хотим верить в это.
А можем ли мы в это верить?
Давай.
Нет, то как можем там, когда цикл только возникает неожиданно,
то конечно да, это мы легко можем в это поверить, это правда.
Но когда там в процессе возникает, когда там цикл...
Да, ну просто нет, там может быть какая-нибудь, ну вот...
А, ну хотя да.
Хорошо, да.
Рассмотрим держа ребро УВ, по которому сейчас произошла
релаксация в результате которой произошел...
В результате которой у нас тут есть цикл.
Да, вот так.
Так, что это означает?
То есть в принципе да.
Если рассмотреть вот этот вот путь, то мы заметим, что...
То тогда заметим, что D от V, которое было раньше,
то есть до этого момента был найден какой-то путь по вершине V.
То есть это было раньше,
то есть до этого момента был найден какой-то путь по вершине V.
То есть какой-то D от V.
Ну вот и мы знаем, что тут путь, который был найден раньше,
плюс вот этот путь, плюс вот это ребро оказался меньше, чем D от V.
Значит, цикл отрицательный.
Пока мы никак не трогаем ни одно из ребер этого цикла...
Нет, почему?
А мое решение никак не завялось на тему того,
образовывали ли эти ребра еще какой-то цикл или что-то еще?
Нет?
Нет, мы говорили следующее.
Потому что из-за чего мог вот это ребро образовывал цикл?
Из-за того, что по ПРЭшкам,
у нас на самом деле, когда прыгая из U по ПРЭшкам, мы прыгали до V.
Заметьте, я даже не знаю, можно ли из этой V допрыгать до S было.
Мне это сейчас вообще по барабану.
Я знаю только одно, что раз я могу дойти до ПРЭшек,
то я знаю следующее, что...
Ну вот то, что я знаю.
Да, почему-то мне кажется следующее,
что тут можно проапгрейдить вот это вот утверждение.
Прогрейдить в том плане, что на самом деле,
если у вас есть просто путь от какой-нибудь вершины V
до какой-нибудь вершины U, допустим,
и это путь по ПРЭшкам,
то я утверждаю, что для каждой вершины,
вот промежуточной вершины, допустим, X,
можно сказать, что D от X...
То есть, то, что там написано,
на самом деле...
Нет, вот хочется сказать...
Сейчас, что хочется сказать?
Хочется сказать, что D от X больше либо равно,
чем, соответственно, D от V плюс вот это вот.
Вот.
Ну да, вроде похоже...
Похоже?
Нет, опять не похоже.
Не хотел бы на экзамене выяснить, что не похоже.
Я тоже расстроюсь.
Ну вот.
Нет.
Хотя...
Не, ну на U тут перебор, конечно.
Не такое уж это и U, но вот.
Так.
Нет, ну хочется действительно такое сказать.
Нет, вообще доказательства,
но доказательства, помните,
тут доказательства даже без индукции особо было.
То есть, там жила была...
То есть, допустим, что у нас есть путь от U до V.
Или, допустим, у нас есть путь от X до V по ПРЭшкам.
Тогда мы замечаем, что в тот момент,
когда мы релаксировались по этому ребру,
то есть, в тот момент, когда мы релаксировались по этому ребру,
оказывалось, что D от этой вершины плюс этот вес оказался равен D от X.
С тех пор D как бы больше не стало.
Вот.
Ну вот, потому что, да, берем дальше, записываем эту цепочку,
там записываем цепочку, и получается кайф.
Главное, что, просто приятно, что это утверждение можно обрубать,
как бы не на вершине S, а на вершине V.
Вот.
Ну и тогда получается, что если...
То есть, тут, казалось бы, да.
То есть, получается, да.
Если взять это записать для D, в том числе и D от U,
там плюс, то есть, D от U, соответственно,
больше либо равно, чем этот путь.
И у нас ПРЭшка образовала за цикл,
то мы вынуждены заключить, что...
Упс.
Значит, цикл отрицательного веса мы его нашли.
Так.
Так.
Ну что, вроде выковырили.
Репку вроде выковырили.
Да, в чем...
В чем, да.
То есть, получился, да, штурм получился сложный,
но, как бы, если вроде там разобраться,
доказательство оказывается простое достаточно.
Так.
Так что, да, слава богу, можно писать из-за линейного количества памяти.
Правда, возможно, какая-то аккуратность нужна, конечно,
хотя...
А нет, аккуратность не нужна.
Нет, аккуратность вроде не нужна, да.
Просто на n-й, да, там...
Просто повез...
На n-й интерации просто автоматически.
Скажем так, для каждой вершины мы сможем найти тот отрицательный цикл,
который делает эту вершину в минуты бесконечности.
Ну да, да, получается так.
Так.
Что?
А можно найти цикл отрицательной длины,
через который можно крутить минуты бесконечности именно для тэр,
для фиксированной тэшки?
Да, можно.
Нет, ну, может, из всех циклов можно DFS запустить, как минимум.
Мы запускаем DFS...
А, мы знаем, что...
Да.
Да, то есть, это такая надежность.
То есть...
Да.
Ну да.
То есть, циклы нашли, там, ну...
Или другие порешки насчитать уже тогда.
Вот.
Ладно.
Значит, это был алгоритм Форда Белмана.
Он у нас работает за WE.
Да, но это как бы нот...
Да, казалось бы, что тут еще можно сделать?
Правда, честно говоря, мне неизвестно,
можно ли сделать что-то лучше, чем WE.
Может, и можно, я не знаю.
Вот.
Но остается только отметить, что здесь, конечно, еще
одна постановка задачи.
Постановка задачи называется, а давайте найдем кратчайшие
пути не от одной вершины до всех остальных,
а между всеми парами вершин.
Вот, хочется.
Ну, напрашивший вариант, мы, конечно, можем запустить
в ЭРА с Форда Белмана,
но этого бы не хотелось.
Вот.
Ну и, действительно, оказывается, что есть алгоритм,
который нам в этом сильно помогает.
В чем пишется, едва ли не проще.
Ну, пишется, оказывается, он неожиданным образом.
Ну, пока если вы это первый раз видите.
Вот.
Это его величество, Флойд.
То есть вот предлагается каким-то вот таким мистическим
образом искать кратчайшие пути.
Ну вот, вот, возникает вопрос.
Как же это делать?
Ну, для начала.
Ну, да, как делать, понятно.
А почему это работает?
Ну, да, ну, возникает вопрос, а что такое?
Ну, давайте так.
Возникает вопрос, а что такое работает?
Ну, корректно, да.
Ну, по камере хочется сказать, что в итоге этой динамики
АИТ и ЖИТ реально равно кратчайшему пути.
Если он есть хотя бы.
Ну, давайте разбираться.
Ну, по одному.
Теперь главное только сформулируйте, что мы доказываем
по индукции.
То есть какое конкретное утверждение?
Ну, по количеству, да.
Ну, да, вот так.
Сейчас.
Ну, непонятно.
Как бы неверно, что на первой итерации
обязательно найдутся все кратчайшие пути длины.
Там 2, например.
То есть если на л-те итерация
мы найдем минимальные из путей,
проходящие через вершины
только от 1 до l.
Да.
Да, вот обойти внимание.
Индукция здесь другая.
То есть утверждение такое, что после ката итерации
мы найдем все кратчайшие пути
среди всех путей, которые в качестве
промежуточных используют только вершины
от одного дока.
То есть изначально у нас просто матрица смежности,
то есть не ходим вообще ни через какие вершины.
После первой итерации
ходим через вершину 1,
после второй через вершину 1 и 2 и так далее.
Понимаете, да?
Так что вот такой вот тоже кайфец
происходит.
Вот.
Ну, вот так.
Что же нам теперь делать дальше?
Ну, да.
Более того, заметим, что в принципе
и ответ достаточно легко восстанавливается.
Да, ну, казалось бы, тоже там
могли быть какие-нибудь зациклы.
В данном случае такой
надежный
вариант
восстановления ответа.
Какой может быть?
Ну, можно ввести,
то есть можно при вот этом вот восстановлении
написать, что при этом от
ИЖ в случае чего равно
вот тому самому К.
Ну, например, да?
Тогда оказывается, что
ну тогда придется вам просто рекурсивно восстанавливать
ответ для отрезка от И до К
и ответа от К до Ж.
Ну, получится рекурсия, но она
не зациклется, потому что опять же
логика та же, что и в ТВ.
То есть как бы это означает, что
раз через вершину К это максимальная
вершина, значит А от ИК и от К Ж
значит там на самом деле уже
как бы все восстановлено с меньшими вершинами
в промежуточке.
Потому что к этому моменту мы уже все
посчитали. Да.
Пока здесь действительно ничего сложного.
Но это пока нет циклов отрицательного веса.
Ну как восстанавливать цикл отрицательного веса?
Как говорится, я не знаю.
Потому что
заметил, здесь, конечно, очень
приятно восстанавливаются вершины,
из которых, по крайней мере,
то есть какие-то вершины, через которые
проходит какой-то цикл
отрицательного веса не сильно большой
длины.
В частности, например, тут очень приятно,
что иногда возникает такая ситуация,
что А от ВВ
неожиданно становится меньше нуля.
Казалось бы, на изначальном отрице смежности
нули, а вот падишь.
Но я утверждаю, что
если это произошло, то цикл
отрицательного веса через вершину В точно
проходит какой-нибудь.
Ну как всегда, тут уже
очевидно, потому что всегда
А от ИЖ это длина какого-то пути
реально существующего.
Так что, раз такое есть, значит
отрицательный путь из вершины В, вершины В
нашелся.
Нет, такого не может быть.
Я утверждаю следующее,
что если
если есть простой цикл
отрицательного веса,
то тогда в результате
у каждой из этих вершин в конце
будет вот это.
Нет, то там просто, ну да.
Потому что жила была вершина В,
и вот рассмотрим,
пусть она лежит на цикле отрицательного веса.
Рассмотрим вот эту вершину К,
самую большую вершину, помимо В
на этом цикле.
Тогда я утверждаю, что к катаитерации
А от ВК
будет не более, чем вот это,
а от КВ будет не более, чем вот это.
Логично, да?
Ну там просто, честно, по индукции
можно легко доказать.
То есть просто, ну вот.
Но тогда в итоге
просто на катаитерации этот цикл
включается и получится меньше нуля.
Все.
То есть, ну вот.
То есть, конечно, вот.
То есть, опять же, я не могу
гарантировать, видимо, что
если вершина лежит на каком-то цикле отрицательного
веса, то обязательно
она таким образом
спалится.
Ну там, как всегда, стандартные тесты в духе
там, я не знаю, там 10-18.
10-18.
Ну вот, как так всегда, 1-1-3
какой-нибудь, да?
То есть, как бы да.
То есть, есть подозрение, что
А от ВВ в этом тесте ничего не грозит.
То есть, конечно,
набирать, то есть
если есть цикл отрицательного веса, то конечно
иногда бывает риск, что набирать обороты
это будет быстро. Потому что у этого алгоритма
есть подлость. Представьте себе, как
он будет работать, если
у вас изначально все ребра равны
минус 1.
Тогда заметим, что этот алгоритм вам
обеспечит веселую жизнь а-ля
переполнения.
То есть, там на каждой итерации, там просто как минимум
в два раза, на самом деле, пути будут залетать,
а то и быстрее.
Так что да.
Так что придется делать что-то аккуратное там в духе.
То есть, там придется добавлять какой-нибудь
ипчик, что если тут оказалось меньше
чему-нибудь приемлемого, значит
пишем минус бесконечность.
Ну и в релаксации тоже.
Минус бесконечность плюс что-нибудь, значит равно
минус бесконечность.
Ну ладно, если что-нибудь не равно
плюс бесконечности, конечно, да.
Да, потому что
плюс бесконечность равно
да, ну
в нашем случае, видимо, да.
Хорошо.
В нашем случае
глобально, конечно,
вопрос. Но, с другой стороны,
тем не менее, если у нас вершина есть, то
на самом деле
идентифицировать минус бесконечность
для любой пары вершин теперь достаточно просто.
Потому что надо просто
выяснить, можно ли дойти до вершины
вот с таким свойством.
А потом из этой вершины выйти еще и
в другую вершину. Это можно прям
ну просто едва ли не за
линию для каждой пары вершин и делать,
просто прибегаясь по этой диагонали.
Тем более, есть ли вообще путь или нет,
вам та же самая матрица
А, в общем-то, уже и скажет, потому что там
написано плюс бесконечность, значит пути нет.
Если меньше плюс бесконечность, значит пути есть.
Очень удобно.
Так, ну вот.
Отдельная, конечно, песня
Отдельная, конечно,
будет песня, называется
«А восстановить, пожалуйста, собственно, сам путь».
Ну, я не знаю там.
Как всегда, можно опять, видимо,
придумать простые решения, потом бесконечно
долго доказывать, видимо, что они работают.
Или, наоборот, неожиданно
там добавить задачу 128-й тест,
который это обвалит,
потому что как бы жюри не пришло,
не приходило в голову валить это решение, например.
Но, с другой стороны,
что тут еще
можно делать?
Ну, в принципе, заметим,
что пути-то теоретически можно и DFS
вот там, хотя вот
интересно, можно восстановить цикл
отрицательной стоимости DFS.
Ну, допустим, задачу мы неожиданно выяснили,
что А от ВВ оказалось меньше нуля.
Спрашивается, а как бы этот цикл отрицательной
стоимости восстановить?
Ну,
какое текущее расстояние?
На каких?
Ну, я боюсь, что даже
если мы найдем цикл
среди вот всех таких
вершин,
нет гарантии, что именно этот цикл
будет отрицательного веса.
Не все так просто в датском королевстве,
к сожалению.
Мы поддерживаем текущее расстояние до вершинки.
И что? А как нам восстановить цикл
хоть как-нибудь даже за куб?
Вот как компьютер
не понимает команды, сделай как-нибудь.
Ну, или, по крайней мере,
очень хорошо надо нейросетку обсуждать,
как бы наверное обучать,
чтобы она сделала как-нибудь
что-то адекватное.
Ну, тут проблема будет в том,
что после того, как мы идентифицировали
этот цикл, на самом деле вот этот путь мог
обновиться еще на большую вершину.
Поэтому как бы рекурсия пойдет
в бесконечность, и причем
тут, к сожалению, не та структура,
чтобы у нас там находился какой-то путь и находился
какой-то зацикл. То есть у нас в каждый момент
времени будет находиться подпоследовательность
вершин на этом пути, но как бы
где там зацикл, непонятно.
Так что такая она вот.
Так что тут, конечно,
самый надежный способ
это, конечно, там
какой способ
вообще есть.
Ну, как бы чисто теоретически
можно было бы там, я не знаю, попытаться найти
наверное, конечно, поймать вот этот
момент, когда от ВВ меньше 0,
и ровно в этот момент восстанавливать цикл.
Да, ну минус бесконечность,
что такое минус бесконечность? Нет, все пары
вершины минус бесконечность
мы поняли, это да.
Но как бы если мы будем просто по ним
ходить и находить циклы, это не означает, что эти циклы
будут там
отрицаем. Так что
тут, конечно, подляночка.
Но тогда,
если мы первый момент времени
такой найдем, то мы, конечно, мы найдем
саму вершину, там цикл
через саму вершину ВВ.
Просто восстанавливая, аккуратно
восстанавливая, там
аккуратно допустим
восстанавливая этот путь, хотя отдельная
песня в этом случае не очень понятна,
как бы, а как мы его восстановим.
Хотя, да, до этого
и то там надо сказать, давайте
сохраним матрицу на момент К-1,
там циклов отрицательного веса
видимо без вершины К не было
в принципе, наверное.
Но вот поэтому
типа там
все пути восстанавливаются адекватно,
поэтому тут мы это нашли.
Но это мы найдем, только вот жила была вершина В,
в чем не просто вершина В,
а вершина В такая, что цикл отрицательного
веса из вершины В проходит через
вершины с минимальными номерами.
Не всеми номерами,
только это. Хорошо, да, это мы восстановили.
Один цикл такой случайно.
Но желательно все, да, хотя
Нет, не все, но как всегда
хочется, наверное, для каждой вершины
ИЖ хочется восстановить цикл
отрицательного веса, наверное, через который
мог бы идти путь, а ты даже есть
крештам минус бесконечно. Ну как всегда,
в общем, там мы тоже это хотели. Нет, есть, конечно,
наглый вариант. Найдем компоненты
сильной связности.
И в каждой компоненте сильной связности
найдем хоть один цикл.
После этого на самом деле для каждой вершины
ИЖ можно просто находить компонент
у связности, через которую
плохую компоненту сильной связности
через которую можно пройти.
Это, я думаю, за какой-нибудь
куб это точно делается.
Логично, да?
Хотя нам уже не важно,
дело не в компоненте сильной связности,
но в компоненте сильной связности находим цикл,
там находим вершину,
лежащую на нем, и в результате теперь
для каждой пары ИЖ надо просто пробежаться
по таким выделенным вершинам и сказать,
а можем ли мы пройти через эту выделенную вершину?
Да, да, нет, нет.
Да, но если мы,
внутри каждой из них мы можем запустить независимого
флойда и найти хотя бы один цикл.
В этом смысл. Но если мы там найдем,
то как бы там внутри себя мы уж как-нибудь дойдем
везде до чего угодно.
Так что, в принципе, вот обнаглеть
можно таким образом.
Вот, да, это конечно
реально обнаглеть, но чтобы, хотя,
хотя тут можно вообще подумать,
а исходный флойд, собственно,
ровно это не сделает случайно.
Но, кстати, сделает,
потому что компоненты сильной связности обладают
приятным свойством. Если вы из нее вышли,
то вы в нее уже не войдете.
Логично, да?
Поэтому, на самом деле, да,
нот.
Поэтому, да, нот.
Нет, поэтому, поэтому что?
То есть, конечно, все равно там могут быть проблемные
вершины, так что лучше для надежности там.
Сильный.
Ну, да, да, да,
что-нибудь такое.
Да, при чем-то прида, приятное, да,
в чем действительно, заметьте, приятная добивка
заключается в том, что
сейчас в чем это заключается?
Нет, ладно, насколько нам да, приятная добивка
заключается в том, что компоненты сильной связности
можно умными алгоритмами не искать, кстати.
Ну, вообще, да.
В общем, можно того же Флойда написать.
Ну или там, да.
Так, ну окей, ладно.
Нашли уже пути,
циклы,
нашли существование
цельных циклов через машины
В и У, в том смысле, что
А, ВВ меньше ныря, А, У меньше ныря,
то они лежат в одной коэффициенте,
то они лежат в одной коэффициенте,
то они лежат в одной коэффициенте,
то они лежат в одной коэффициенте,
то они лежат в одной коэффициенте,
А, ВУ и А, УВ оба уже меньше ныря.
То есть в какой-то момент мы уже начитали
Нет, в смысле.
Мы уже знаем, что есть пути.
Сейчас не понял.
Просто если...
Нет, ну верно, просто утверждение.
В момент, когда найдем оба всем по одному циклу
в соответствующей длине, правда, что мы уже...
Не факт,
что может быть конкретно эти пути
проходят через там большие вершины,
чем те, чем те, которые лежат
в этой цикле.
А, ну это да.
Можно чуть-чуть назад и начаться
в восстановлении поговорить.
Если мы хотим найти путь,
в котором содержит цикл отрицательной диней,
да,
то мы смотрим на компоненты,
через которые этот путь должен проходить.
Да.
Но мы же можем сконденсировать их
в одной вершины,
посмотреть на индуцированном крапе этот путь.
А потом в каждой компоненте
смотрим, есть ли внутри нее
цикл отрицательного веса.
И если мы говорим,
что вот на этом пути найдем какую-нибудь компонент,
у нее есть цикл отрицательной дины,
значит потом куда идет?
Нет, у нас вопрос был только в том,
как технически проще эти циклы потом восстановить,
если что, в каждой компоненте.
Поэтому я считаю, хочется не запускать флойды
для отдельной каждой компоненты.
Ну, типа да.
Да, то есть самый тупой, да,
хотя у нас получился самый тупой способ восстановления,
это типа, если нашлась вершина А
от ВВМХ0, давайте приближимся
по ее компоненте сильной связности и запомним,
что вот для этих вершин цикл восстанавливать не надо.
Ну, например.
А дальше потом все пути от любой вершины
до любой вершины в этом,
если нам задача найти хоть какой-нибудь путь,
то запускаем ДФС.
Хотя самое смешное, кстати,
что вообще, если вы запустите,
что, кстати, если у вас задача найти кратчайший путь,
а ты даже и вы знаете, что он существует,
то самое смешное, что вы ДФСом
можете этот путь найти.
Просто ДФС надо запускать
не по всем вершинам,
берет не по всем ребрам,
а только по тем ребрам, чтобы там,
то есть по каким-то таким ребрам УВ,
что там А
от ИУ,
там плюс вес ребра
от УВ
было равно А
от ИВ.
Поэтому я говорю ДФС.
То есть расстояние найденной кроки,
поэтому какой-то путь вы находите.
Поэтому мы буквально ДФС запускаем.
Так-то да, по нулевым ребрам мы, конечно,
можем бегать, поэтому мы делаем это
не жадно, а именно ДФСом.
Это да.
Можно сделать так,
если вам не нравится вот эта
мерзкая рекурсия какая-то,
если она для вас мерзкая,
по какой-то причине, я не знаю.
Получается такой красивый флойд,
который вот так
работает за куб.
Но как-то не странно,
это еще не все.
Так, но однако
ой-ой-ой-ой.
Да, однако,
что уже давно пришло время перерыва.
Вот.
Но на самом деле попробуем сейчас решить еще одну
веселую задачу.
Значит, нам все еще хочется найти
кратчайший путь от УВ
между всеми парами вершин.
Но мы попробуем с вами
это сделать все-таки в предположении, когда циклов
отрицательного веса нет.
Вот.
Казалось бы, чем это будет отличаться
от обычного флойда?
Чем мы его можем перекупить?
Ну кое-чем можем.
Дело в том,
что у нас есть голубая мечта.
Нет,
голубой мечты у нас нет.
У нас есть немножко другое.
То есть мы помним, что если мы хотим искать кратчайшие пути,
то у нас есть алгоритм D extra.
Ну как за какое время у нас работает?
D extra.
Какая у нас лучшая асимптотика D extra?
У нас была E plus V log V,
потому что у нас есть наша любимая куча фибоначи.
Вот.
Поэтому есть такая D extra.
И в принципе, если это
замножить на V,
то у нас уже есть асимптотика круче куба.
Особенно с учетом того,
что у нас особо нет кратных ребер.
Ну а маленькая проблема.
Работает, к сожалению, алгоритм D extra.
Когда?
Но только для не отрицательных ребер.
А у нас отрицательные ребра есть.
Ну вот.
Но есть неожиданный лайфхак.
Называется потанцеваль.
Вот.
Возможно, имел бы смысл назвать его
именно потанцеваль,
потому что официальное название, конечно,
потенциал, но у нас под словом потенциал
подразумевается немножко другое.
Но, пожалуй,
не будем мы все-таки этого делать.
И так.
Идея неожиданно такая.
Введем потанцеваль.
Что такое потанцеваль?
Вот.
Ну никогда там, в смысле, вы там сходили на дискотеку, естественно.
Вот.
А потанцеваль
это просто какая-то
функция,
которая просто...
Короче, на каждой вершине нарисовали какое-то рыжее число.
Да, просто на этот раз
никаких ограничений нет.
То есть потанцеваль может быть любым.
Вот.
И мы неожиданно
заявляем, что
вес ребра... Вот, допустим, у нас есть ребро
УВ
и его вес.
ВУВ.
Вес В.
Вот.
То есть такой ВУВ.
Так вот.
По нему
мы вводим такое понятие,
как приведенная
стоимость.
Приведенная
стоимость.
Значит
W
с индексом P
от УВ.
Пусть будет равно
W от УВ.
Только плюс P
от У и минус
P от В.
Вот такое определение.
Я ввожу... Это называется
приведенная стоимость ребра относительно
потанцевали.
Зачем
оно надо?
Но штука оказывается
очень приятной.
Смотрите.
Основное свойство такое,
что если мы рассматриваем какой-нибудь путь
от какой-нибудь там вершины С
до какой-нибудь вершины Т,
и там
в процессе это типа там В0,
В1, В2, там
и так далее, ВК
равно Т, допустим.
И тут у нас веса какие-нибудь В0,
В1, там
В2 и так далее, ВК-1.
То какова
длина этого пути?
Длина в смысле веса, она
сумма weight.
Но если мы хотим
рассмотреть приведенные
стоимости,
то что получается?
То получается, давайте честно
распишем, В0
плюс П от В0
минус П от В1.
Плюс
В1 плюс
П от В2
минус П от В1.
Плюс
W2
плюс там
П от В3 минус П от В2.
Плюс
и так далее.
Ну и плюс там
WK-1
плюс П от
ВК
минус П от ВК-1.
Ну, как вы можете заметить,
у нас здесь начинается массовый
шлёп-шлёп.
Что я написал-то вообще?
Во-первых, это тройбан, во-вторых, тут
В1 минус
В2, а тут
В2 минус В3.
А тут К-1
и ВК.
Ну, согласно этому определению
логично. То есть плюс в начале,
минус в конце. Это важно.
Запомните очень легко, чуть позже увидите,
почему.
Ну да, тут начинается массовый
шлёп-шлёп.
Потому что вот тут шлёп-шлёп,
вот тут там шлёп-шлёп.
И
какой-то вот, что-то ещё.
И вот тут.
Получится, что получится?
Получится маленькая приятная вещь.
То есть получится просто та же самая сумма.
Только
плюс
чего?
Плюс начало, минус конец.
То есть идея заключается
в чём?
Получается следующее, что
от того, что мы ввели приведённые стоимости,
просто все пути между
одной и той же парой вершин
изменились
на одну и ту же константу.
В чём константа зависит только
от начала и конца пути.
То есть это означает, что кратчайшие
пути, структура самих кратчайших
путей не поменялась.
То есть получается, если я введу потенцивал
и найду относительно него кратчайшие
пути, то у меня
ничего не поменяется.
Да, кстати, да. Ещё
спасибо. В качестве дополнительного
свойства ещё то, что веса циклов не
поменялись от слова никак.
То есть, к сожалению,
введение потенциала
не спасёт нас от циклов
отрицательной стоимости, если они есть.
Если их нет у циклов отрицательного веса,
то потенциалы нам могут
ой, как сильно помочь.
Помогут нам они
следующим образом.
Ну вот, так. Ну, во-первых, определение.
Значит, определение.
Потенциал P
не отрицателен
если
для любых
УВ окажется
В с индексом P от УВ
больше либо равно 0.
Да ладно, я тут, конечно, написал, как будто
все гобры существуют.
Ну вот. Ладно.
Вот так правильно
тогда написали.
Вот. И получается кайф.
Ну, по крайней мере, точнее кайф, который бы нам хотелось.
Потому что заметим, что
если мы случайно каким-то
мистическим образом найдём
неотрицательный потенциал,
то тогда VDX
нас приветствует.
Вот.
Вот.
Вот.
Но как же его найти?
Хотя математически возникает вопрос,
а существует ли он?
Но как?
Решим систему уравнений?
Не равен? Симплярс метод запустим?
Да.
Ну,
когда-то бывает неплохая.
Есть мистическая теория, хотя бы математически
существует ли он. Но теория
говорит о том, что
в графе нет циклов отрицательного веса,
тогда и только тогда, когда этот потенциал
существует.
Вот.
Ну да.
Вот.
Значит, и более
того,
оказывается, что
действительно этот потенциал достаточно несложно найти.
Как же его
найти? То есть идея
очень простая.
Надо сказать, что у вас
P от V
будет просто расстояние
от вершины S
до вершины V.
Где вершина S фиксирована.
То есть алгоритм
получается простой. Один раз
запустим Форда Белмана,
а после этого из всех вершин начинаем
запускать DX.
А симпатически мы ничего не потеряли.
Первая попавшаяся
вершина.
Вот. Причем действительно
я утверждаю, что относительно этого
действительно оказывается, что
действительно потенциал не отрицательный.
Вот сейчас проявится, почему мы
прибавляли начало, вы читали конец.
Потому что рассмотрим какой-нибудь ребро
у V с весом W.
И так, то есть приведенная
стоимость этого ребра получается должна быть
равна P
Q плюс V минус P от V.
Спрашивается, почему это больше
либо равно 0?
При вот таком потенциале.
Ну то есть или что то же самое.
Почему DIST от
SU
плюс W оказывается больше
либо равен, чем DIST от
SW?
Но не совсем.
Еще какие-то
пару слов бы добавить.
Ну какая монотонность у нас отрицательная ребро есть?
Ну да.
Ну по сути да,
по определению,
только по определению даже не столько DIST,
сколько слова кратчайший.
Что значит кратчайший
или минимальный?
То есть DIST от SW это длина кратчайшего
пути от SW.
Стоит только добавить, что
DIST от SU плюс W это длина
какого-то пути
W.
Но длина какого-то пути W больше
либо равна, чем длина кратчайшего пути W
по определению слова кратчайший.
Кратчайший.
Ошибку конечно в нем придется найти.
Но в принципе казалось бы да,
берем вершину S, находим вот эти расстояния
и говорим, что вот все потенциал найден.
Где мы воспользовались тем, что
этоpling.
Обратно доказывается легко.
Если есть потенциал,
то как бы
приведенный вес любого цикла
оказывается не отрицательным.
Но так как приведенный вес любого цикла
равен исходному весу, то получается вообще
и циклов отрицательного веса нет.
В эту сторону очевидно, а в эту сторону
нет циклов отрицательного веса,
значит есть DIST.
А раз есть DIST, значит есть
потенциал.
Вот, а в этом и ошибка, да. Подлянка заключается в том, что, к сожалению, нет гарантии вообще,
что существует вершина S, из которой вы дойдете до всех вершин. То есть даже не в том смысле,
что вы там их сложно искать, а фишка в том, что ее может вообще не быть. Поэтому в данном
случае предлагается сказать, что вершина S это не одна из вершин В, а предлагается так. Вот у
вас есть RAF. Значит, мы просто вводим фиктивную вершину S и проводим из нее ребра во все вершины.
Ну, по умолчанию, с весом 0, но на самом деле даже не сильно принципиально,
с какой вес вы тут напишете. И забабахиваете потенциал. То есть расстояние от нее забабахиваете
потенциал. То есть это вот называется классический алгоритм Джонсона. Ну, и потенциалы называются
потенциалы Джонсона, кстати. Вот. Да, то есть кто-то начинает, почему-то у многих иногда это
ассоциируется чисто с потоками, но на самом деле оберутся они здесь. То есть пока еще никакого
отношения к потокам это не имеет. Так что вот таким образом получается, что за вот уже
аж такое симптотики достичь в принципе можно. Вот. Ну, потенциалы. Да, потенциалы мы ищем
Фордом Белманом из S, но один раз. Вот. После этого мы с помощью потенциала из каждой вершины запускаем
здесь использование потенциалов простое. Ну, как ты и сказал, циклы, приведенный вес цикла равен исходному весу цикла.
Нет, это прямую сторону. Если нет циклов отрицательного веса, значит есть потенциал. Мы это доказали тем,
что просто предъявили этот потенциал как расстояние от этой вершины до всех остальных. Вот. А в обратную
сторону доказательства, что пусть существует не отрицательный вес, значит все приведенные веса относительно
него циклов больше либо равна нуля, значит и веса в принципе всех циклов больше либо равна нуля, циклов
с этой веса нет. Ура. Вот. Да, тут все, тут как бы тут все просто, да и кодится в общем-то со сложностью
дэ экстры. Вот. Вот. Итак. Так. Ну, кажется, если тут вопросов нету, то на этом мы заканчиваем говорить
о поиске кратчайших путей и наконец переходим в сладостный, чарующий и упалительный мир потоков.
Вот. Ура. Наконец-то мы до этого дошли. Алгоритм Джонсона или потенциалы Джонсона. Ну, вот такое.
Фамилия здесь Джонсона. Вот. Так. Ой, так вот тут бы уже нормальные маркеры, конечно, нужны. Так.
Так. Так. Главное не перепутать какие мои, а какие не мои. Да. Ну, как всегда. Да. Ну, тут
спросим логично. Вот, допустим, у вас есть предмет теории жруб. Какой самый первый вопрос возникнет на
самом первом занятии? Разумеется. Но у нас это будет немножко не так. Скажем, но не сразу. Не-не-не-не-не-не-не.
Первое, что мы скажем, это что такое сеть. Нет, рыболовная. Да-да-да, интернет. А интернет, ну это вот
это с проводами, вот эта вот штука. Знаете, да, приходите на экзамен, потом мне достается куриный
бог. Ой, я стал куриным богом. Очень классно. Такой с перьями такой красивый. Там вот это, а в том
там, а куриный бог. Господи. Да, ну, отдельная песня. На каком экзамене-то вам такое могло возникнуть?
Ну, да. Вот. Ну, мы с вами, слава богу, не в магической школе. Хотя магию мы с вами тоже делаем, надо
признать. Да, вот, в некотором смысле. Так вот, что такое сеть? Так вот, вообще говоря, сеть это такой вот
пятерка. Ну, точнее так, знаете, тут два определения есть на самом деле. Значит, что такое сеть? Значит,
это значит, где значит у нас VE, это просто ориентированный граф. Значит, С это просто такая
функция, которая называется пропускные способности. Так, там S это вершина, которую мы будем называть
и stock, T это вершина, которую мы будем называть stock. Вот. Ну, то есть, по сути, в общем-то,
такой взвешенный граф, только с неотрицательными весами. Формально, в котором выделили две вершины.
Вот. Ну, что это такое по смыслу? Так, хотя, насколько надо подробно об этом говорить,
интересно. А кто знает, что такое поток вообще? Ага, надо говорить. Хорошо. Или кому-то лейб-руку
подымать. Да, хотя да, юмор заключается в том, что это как бы самая математическая часть вообще
всей программистской теории. Но да. Нет, у нас вообще была ирония, когда нам вообще на дискретке,
на семинаре стали что-то предлагать задачи, которые решаются через теорию Муфорда Флкерсона. Да,
причем да, ирония, что кому-то пришлось подробно рассказывать, а у нас семинар закончился за
половину времени, потому что мы знали, что это такое. Но ничего, сейчас все расскажу. Значит,
идея такая. То есть, на самом деле, виртуально у нас такая идея. Ну, классическая интерпретация такая,
что вот этот вот граф, это не просто граф, это водопровод. И мы хотим, чтобы этот водопровод
бесперебойно доставлял нам воду из вершины С в вершину Т. Ну, что значит бесперебойно? Да,
обратите внимание, то есть мы тут сейчас не кратчайшие пути какие-то ищем, а хотим,
чтобы был процесс бесперебойно. Это означает, что мы хотим, чтобы по каждой трубе каждую единицу
времени текло какое-то фиксированное количество жидкости. Вот такая у нас идея. Зря я это стал
здесь рисовать. Лучше тут. Какая-нибудь вот эта вот. Ну, а теперь в чем фишка? Да, граф вполне
может быть сколь угодно зацикленный. Но маленькая, какие у нас проблемы есть? Проблема в том,
что в водопроводе, наверное, по каждой трубе бесконечное число воды течь не может. Там где-то
их 5, где-то 3, где-то 8, где-то 1, где-то 2, где-то 7, 6, там 5, 4, 3, 6, ну и так далее. Ну, что угодно
может быть. Бывает ноль. Но ноль, конечно, это будет означать, что примерно одинаковая ситуация,
когда типа трубы нет и труба имеет вес, там профессиональная способность ноль. В зависимости
от ситуации мы будем считать и так, и так. Вот. То есть вот такой смысл. Но как же мы можем запустить
воду? Что значит запустить воду? Ну, запустить воду надо, конечно, так, то есть надо каждой трубе
сказать, сколько воды должно течь. То есть мы как бы не в самом начале процесса. Мы должны
растворить в конечную фазу, когда мы уже наладили процесс. Чего? Да. Да, это буквально,
да. На самом деле, да, это буквально они. Да, только течет у нас не только вода. Или, знаете,
вот еще на самом деле красивая интерпретация, на самом деле, это транспортная сеть, когда на самом
деле это города, и по городам едут, и тут едут машины. То есть мы там запускаем какие-нибудь там
грузовички с грузами, а это просто количество полос, допустим. Вот. Но, действительно, есть какие-то,
ну, во-первых, есть, конечно, ограничения, что по каждой дороге едет не более чем задное число
машинок. Ну, лучше, конечно, воды. Почему? Потому что числа могут быть и какими-нибудь там не целыми.
Да, 99% случаев, конечно, у нас все для целочисленных сетей будет, но тем не менее, да. Вот там корень,
там корень, ограничение, там корень из двух машин, там машин в единицу времени, это тоже,
в принципе, бывает. Да? Интересно. Нет, если поскорее, поскорее, то, пожалуйста, а так это ограничение
не более, да, то есть, знаете, ограничение не более, чем корень из двух машин, называется в минуту, там
въезд не более, чем корень из двух машин в минуту. А теперь высказывается вопрос, а что такое корень из машины? Да,
то есть, да, нет, это что-то новенькое, мало нам нема единицы, это только, только что избавились,
так еще и, ну, как избавились? Не избавились, ладно, у вас там целая ДЗ на нее, да. Нет, ладно, не целая,
там есть умножение на простому модулю. Да, да, да, да, да, это правда, окей, да, но это правда,
да. Ну, да, да, да, а потом выяснить, да, все задачи там коротцумно издаются, да, вот, ну, попробуй,
попробуй, может, и заходит, я не знаю, ладно, ладно, не будем извлекать корень из машины, да,
будем, значит, есть ограничение, что по каждой трубе течет, но есть, как правильно заметили,
это правила Киргофа, то есть, хочется, чтобы вода нигде не скапливалась и нигде ниоткуда не бралась,
кроме истока, ну и машинки, то есть, машинки, то есть, не должно быть у нас там бесконечное,
то есть, куда там, не должно быть у нас бесконечное накапливание, нет, у программистов, конечно,
бывает всякое, да, как это было там, 10 ноября, куда-то исчезают малярии штукатуры, там думаем,
а потом, 12 ноября, выяснилось, что из-за ошибки Сидорова двери в некоторые квартиры открываются
только на вход, думаем, что делать, пока кормим через форточку, да, это дело было, да, но вот,
да, здесь мы хотим этого избежать, приводит нас к этому программическому определению понятия поток,
вот это прикол, а не нормально, вот, вот, надо просто поднажать, так,
упшик ифа поможет, а ну-ка, а если я вот эту возьму, да и нет, она вот, нет, так-то работает,
но, как это Петрович говорит, что будет работать, если снег не пойдет, 25 ноября снег пошел,
так, так, ладно, все убрали, так, это мы убрали, это мы убрали, так, вон пусть тут лежит,
а, господи, это ж маркер отсюда, небось, да, ладно, так вот, определение,
определение, так, господи, нормальные макеры есть, ну, что такое,
о, маркер для флипчертов, да, печалька,
чего, конечно, да, нет, как-то я не знаю, мне страшно бояться за каждую букву, потому что,
как бы, придется все это открыть, потому что, видимо, полностью знал, что тут будет написано,
поэтому, да, и то, пожалуйста, в предпоследней строчке слова отсутствия неправильно написано,
да, вот, да, нет, понятно, да, это называется, нашел, потому что искал и все такое, да, ну, вот,
ну, как бы, нет, дайте это так, ну, я лучше, я лучше это буду писать на доске с обратимой
операции записи, вот, значит, это определение, пусть, значит, вот у нас есть сеть,
тогда, значит, поток f, что такое поток, это функция,
значит, функция такая f из e в r, на этот здесь больше либо равно нуля, у нас односторонние дороги,
если что, удовлетворяющее, вот, следующим условиям, или как-то пишется, короче, такая шо,
такая шо, значит, во-первых, для любого ребра e верно, что f от e меньше либо равно c от e,
и второе утверждение, что для любой вершины v, которая не из сток и сток, оказывается,
что сумма f от e равна сумме f от e, да, только с мелкой оговоркой, первой сумме мы перебираем
ребра входящие в вершину v, а здесь исходящие, вот, то есть, типа, прям в явном виде, сколько втекает,
стока вытекает, да, собственно, что-то, что, вот, нет, у нас, к сожалению, у нас такого счастья не будет,
да, да, да, вот, смотрите, да, да, действительно, у нас такая подлость, да, что у нас может никто не ехать из st,
а просто вместо этого вот это одинокая машина вот так вот гоняет по гоночному кругу, это тоже поток,
да, какие дрифтеры, господи, это еще просто, нет, просто вот ездит машина, да, причем этот поток
будет величины ноль, сбегая вперед, сразу скажу, ну, потому что из st никто не ездит, но, помните, да,
то есть, как бы, если поток ноль, это не значит, что никто нигде не едет, но это как с конденсатором,
казалось бы, что такое конденсатор, просто вот такие две доски вот так поставлены, очевидно,
очевидно, между ними ток течь не может, а он течет, вот, ну, вот, если переменные, то оказывается,
течет по каким-то мистическим причинам, то есть там, да, вот, ну, вот, да, но, как бы, ладно, да,
возможно, именно по этим, да, по причине этого вы, собственно, поступили на вкульте, где физику не
изучают, да, а то тут, как бы, нет, почему нет, формально там течет, там даже это объясняется тем,
что, ну, да, нет, ну, там как-то, да, воображайте себе, что это не так вот плюсик течет, а минусик вот так
вот в обход течет, это нормально, да, нет, у меня учитель физики так объяснял, вот, так что можно
себе это так воображать, да, в общем, да, в общем, это отдельная песня, но, как говорится, да, вот,
значит, смотрите, но, значит, но, погодите, пока развлекаться, значит, смотрите, потому что пока
надо ввести, на самом деле, может быть, еще одно определение, ой, это стереть-то можно вообще,
кстати, аптечек, так, ой, интересно, этот маркер пишет нормально, потому что на самом деле мы с
вами будем пользоваться двумя определениями, это определение программистское, то есть оно максимально,
оно ближе к тому, что обычно реально кодит, но математически поток оказывается удобно
рассматривать немножко по-другому, так, ой, ладно, пойду свистну маркер, так,
вот, ну, и смотрите, более математически иногда оказывается удобнее считать,
что между любыми двумя вершинами есть такова, просто между некоторыми просто способность 0,
вот, ну, в общем, ладно, это как бы тут еще такой балансный момент, то есть круче, на самом деле,
оказывается, когда мы начинаем вводить поток, значит, так, давайте тут тоже, так, да, давайте
еще немножко порезем, так, так, порезем маркер, да, да, прям это таймкод, да,
лектор грызет маркер, так, да, да, да, ну, типа, если вам не интересно, проматывайте,
а если интересно, нет, ну, мало ли, знаете, у каждого человека там иногда в фильмах есть там
какие-нибудь там это любимые моменты, да, то есть, например, кто-то любит, например, когда там
самолет взрывается, да, ну, например, там, я не знаю, или кто-то там любит момент, когда там он
там забил там решающий гол, например, или там что-то вроде, ну, вот, ну, вот, вот,
вот, значит, смотрите, определение, так вот, поток, поток в сети, нет, не аминус ажи,
значит, это опять функция f, такая шо, шо, так, ну, во-первых, для любых двух вершин,
конечно, для любых двух вершин, оказывается, верно, что f от uv меньше либо равно, чем c от uv,
но возникает весьма нетривиальное свойство, да, для любых двух вершин верно, что f от uv равно
минус f от vl, внимание, обратите внимание, не отрицательность на этот раз не требуется,
здесь такое удобство такой матрицы смежности, что там, если там это из Москвы в Питер едет
пять машин, это то же самое, что из Питера в Москву едет минус пять машин, да, ну, вот,
вот, и в результате уже третье свойство можно записать, между прочим, сильно проще, чем вот
эту гадость, потому что оказывается, что для любой, для любой вершины v, которая не исток и не
сток, оказывается, верна маленькая приятная вещь, сумма f от, допустим, uv, ну, или можно было f от
vu написать, равно нулю, вот, то есть, видите, так стало чуть-чуть удобнее писать очень сильно,
потому что оказывается, что, как бы, потому что в этой сумме, как бы, все входящие учитываются
со знаком плюсов, все исходящие со знаком минус, поэтому вот запись уже оказывается короче,
ну, например, да, ну, вот возникает первая теря, хорошо, понятно, что на самом деле это всего лишь
интерпретации одного и того же, правда, то есть, суть одна, более того, в принципе, то есть,
их можно даже примерить, что там программисты скажут, ну, то есть, это типа тут всегда матрица
смежности в квадрат ребер, но на самом деле необходимости в этом нет, то есть, на самом деле
примерить эти определения можно было бы, например, если для каждого ребра ввести обратное ребро и
договориться о вот таком свойстве, понимаете, да, вот, то есть, в принципе, так тоже можно и
программисты, собственно, это постоянно делают, как мы с вами убедились, но вот что нас сейчас
интересует, а что такое величина, ведь задача у нас об поиске какого-то там максимального потока,
а что такое максимальный поток, вот, да, надо ввести, а вообще, да, что такое вообще какую-нибудь
величину потока, ну, казалось бы, что такое величина потока, ну, наверное, в идеале нам бы хотелось,
сколько товарищей едет из СВТ каждую единицу времени, да, вот, а сколько их едет, ну, казалось бы,
вот так определение вводим, да, ну, можно определить так, ну, что, ну, ну, наверное, да, давайте просто
посмотрим, зафиксируем, сколько выезжает у нас каждый день из гаража, из истока, и все.
Да, ну, опять-таки, да, тут вот, хочется здесь сказать, что модуль fs, это сумма f от e по e точка
старт равно просто сколько выезжает, просто так и фиксируем, то есть выехал из гаража там 10
трамвай, там, 10 трамвай, значит, 10 трамвай на маршруте ездят, да, есть одна маленькая подляночка,
да, подляночка называется в том, что этим трамваем никто не запрещал возвращаться в
исток, то есть может быть вот, например, вот такая ситуация, вот, ну, тут что-нибудь, неважно,
ой, да, а ой, да, значит, тут надо тогда, так, тут мы пишем один, так, давайте, тут мы пишем два,
тут мы пишем два, тут мы пишем два, тут мы пишем два, да, и тут пишем два.
Куда? Серьезно? Меньше восемь, так, ну хорошо, три втекает, но нет, почему нет, одно втекает,
нет почему смотрите 1 вытекает 1 вытекает 2 втикают кайф а 3 втикает а во да ну хорошо
давайте наконец рассмотрим поток в котором датте все-таки что-то да езжай
3 из 5 конечно да это это тройбан такой да так давайте ладно давайте толстенький такой
с пузиком такой тройбан да вот это пропускаю способность вот уже ничего
так вот такая красота но правда тут действительно если считать что просто кто вы кто выезжает из
ангара то как бы замечаем что да то есть просто напрашивается какая-то коррупция потому что
выезжает по 3 но один тут еще коротким путем возвращается а еще один так стоп нет выезжает
3 вот этот тоже выехал а это не вы а два выезжает дай один быстренько возвращается и еще тут трава
это просто ездит без отдыха до такой да но вот то есть такая но то есть какая-то подозрительная
да то есть это как ну да это называется да то есть чиновник демонстративно сел на велосипед
значит проехал полметра значит заехал за угол сел в машину ехал дальше то есть это как бы вещь
такая вот но поэтому чтобы избавиться от этого мы все-таки себе скажем что у нас все-таки мы
вычитаем тех кто нам еще и к нам вернулся но заметим что справиться с этим нам помогает
конечно вот второе определение потому что второе во втором понятийном аппарате на самом деле мы
понимаем что здесь модуль fs можно просто написать сумма f от св и сказать и заметим что она учила
все но вот чем фишка вот опять же как бы как тут сразу взять почему я эту штуку пишу с индексом
s потому что может возникать наоборот как бы логично на самом деле чтобы как бы нам там если
мы перегоняем товары с ft то наверно пользует там наверно в городе t там нам будут платить
наверно за то что доехала не то что выехала правда кто сказал так сейчас доживем но вот ну скажи так
это надо сделать но давайте делать вот есть как бы что можно ввести абсолютно то же самое да
нет да пока у нас все дороги бесплатные как бы и более того мы им полностью владеем и перейдем
ой да кофе но вот то есть можно то есть на самом деле заметим что можно величину потока мерить и
таким вот образом модуль ft которая равен сумма в f это в это да можно так вот но возникает вопрос
как бы это да то есть это вообще совпадающий ли это вещь байдей на казалось буду сколько выехала
наверно столько и приехала а куда они могли деться ну вот ну как это сделать
ну да да да классика нам так классика нам говорить что
ну потому что но скажем так потому что вот в этом понятийном аппарате удобнее
доказывать утверждение а в этом понятийном аппарате удобно кодить вот так потому что нет
в принципе я мог бы на самом деле вот это не вводить и абсолютно те же утверждения которые
сейчас будем доказывать доказывать вот в этом аппарате но я потрачу просто но нет а это
программика шако да ну поша кодить будем именно так даже не столько удобно дело даже будет не
столько в удобстве сколько в том что как бы обычно у нас все-таки граф будет по ограничениям больше
чем матрица смежности но теперь там ситуация 100 тысяч вершин 200 тысяч ребрик для нас тоже на
самом деле шоком не будет вот но там про сочетание искать какие-нибудь вот соответственно поэтому
вот поэтому то есть это вот для программирования для математики конечно да и так значит мистическое
утверждение утверждение о том что модуль f с индексом s равно модуль f с индексом t
какое у нас доказательство да да потому что рассмотрим сумму чего рассмотрим сумму по всем
парам вершин значит ув значит f от ув с одной стороны это равно нулю просто по определению по
свойству номер два да мы сейчас второй прийти на парад берем да ну потому что каждый ребро мы
взяли и в ту и другую сторону они ангелировались с другой стороны теперь заметим что я вот так
напишу вот дай просто поставил скобочки да теперь заметим что по определению номер 3 на самом
деле я здесь беру просто то есть в качестве у меня имеет смысл рассматривать только с это
а это ну просто по определению и второму свойству это модуль f с минус модуль f
доказательство кончено да то есть я мог бы то же самое написать в первом там в первой
терминологии но это был бы расстрел ну то есть так просто было бы две строчки две более
гадостные точки которые в общем-то дополнительного смысла не дают то есть вывод очень простой то
есть оказывается это оба определения нормальные то есть оба это одинаковые и соответственно
вот это вот определение это мы будем называть величина потока
вот
соответственно то есть вот такая вот величина то есть фактически можно сказать сколько вытекает
то есть сколько можно сказать сколько вытекает и заско можно сказать что сколько втекает в т
можно на самом деле ввести еще два степени н-2 экзотических определений да вот что-то да у меня
сидит творческое настроение поэтому я это место обычно конечно говорю немножко там где-нибудь
через полчасика но вот но давайте сразу введем еще понятие можно ввести вообще понятие просто
какой-нибудь храницы и то есть ну можно так допустим вы ну я не знаю гоняете вы допустим
автомобили там я не знаю там я не знаю там изет там из дитройта в не давайте поближе сейчас
нет ладно там больше стран нет там стран слишком много там можно нет давайте нет более показать
добудемся все-таки в канаду будем гонять до вот точно реаль а то мне хотел сказать конь горы
кроме от того да вот давайте вон реаль нет из дитройта но давайте вспомним его это уважаемое
это прошлое когда там 4 это было автомобильной столице мира и все такое но вот то сейчас это
что-то грустное но вот например если почитать там скажем там книжки актера хейли то в какой-то
момент дитройта это был очень мощным городом с вообще с там классными фордовскими заводами вот
соответственно да но так вот представьте гоняете вы значит из дитройта в монреаль ну в принципе
как можно считать сколько машин пересечь сколько машин будет доезжать может сколько выезжает из
дитройта может считать сколько это приезжает монреаль а можно посчитать сколько приезжает
через границу да то есть можно про просто считать да хотя да то есть априон от формально
определение этой границы звучит так то есть определение то есть пусть у меня допустим пусть
значит g равно вот это вот vst это сеть это сеть тогда значит пары множество st это разрез если
во-первых значит s и t это под множество v и нет не будем путать и это не случайно так
во-первых так ладно правильно даже короче будет писать не просто ст потому что а с объединенное
ст это прямо есть множество v второе важное свойство что с пересеченное стоит пустое множество то
есть это разбиение да вообще вот эти два объединения говорят пишут что v равно s вот
эту вот t вообще ну такое еще обозначение есть так но нам еще потребуется третье важное
свойство что и сток должен лежать доли s а сток должен лежать в доле t да поэтому
буковки тут соответствующие вот так вот вот введем такой разрез в этом месте а теперь давайте
введем определение два определения пусть там опять там копипастим вот это g равно там сеть f поток
в ней а ст разрез тогда чистый поток через разрез
разрез который мы будем который мы будем означать f от st он будет равен просто сумме f от uv где
у лежит в доле s вылежит доля t то есть просто насколько машин пересекает границу все 1
но правда в первом понятийном аппарате мне конечно придется пошаманить ну то есть до какого-то
момента тут прям честная копипаста копипаста копипаста копипаста копипаста копипаста копипаста
но здесь придется подписать f от ст планировки паста g равно v c st вот так вот и тут вот уже
а что такое f от ст здесь здесь придется конечно считать сумма f от е минус сумма f от е потому
что тут надо посчитать чтобы значит сколько у нас машинок значит едут из сша в канадо
и вычесть машинки которые возвращаются обратно чем главное но обратно конечно тут понятие
относительное почему ну потому что в принципе может там какая-нибудь там особая горная
дорога есть которая формально говоря пересекает границу вообще много раз то есть может какая
может вот есть вот какая-нибудь граница а вот какая-нибудь машина едет вот так там вот
по такой экзотической трассе вот тогда надо чтобы машина учитывалась все-таки один условно
один раз они блога вот вот понятно да давай так да тут да тут да да спасибо да да да да
вот а вы говорите он на флифчактов писать а так вот так вот так вот на самом деле
мистическое утверждение ой что-то я даже мне что-то в лом стирать и писать нет
вот то есть на самом деле я утверждаю что чистый поток через развес тоже просто равен величине
потока вот понятно да вот
вот значит что смотреть как-то доказывать
да нету никакой да нету да нет ну как бы да вот нет ну на самом деле надо почти то же самое
нет совсем вот такое же не получится но в одну строчку мы уложимся то есть на самом деле имеет
смысл стартовать от следующей приятной штуки что такое машины выезжающие из городов доли с
шить такое вот вот такую вещь я хочу рассмотреть с одной стороны это ну с одной стороны можно
заметить что ну по свойству давайте вот опять же по свойству какому там два у нас заметим что
все рёбра которые ведут из доли с долю с пошлеп шлепаются правда поэтому получается f от
у с и вот в это f от ув а это прям по определению f от ст с другой стороны если я тут мысленно
поставлю скобочки то по свойству 3 я получу что что на самом деле в качестве вершины у я
могу рассказывать только вершину с ну ну на самом деле это но ты у меня здесь нет то есть получается
сумма от f в и в f от sv что равно модуль f с индексом с ура то есть в принципе да то есть с интуицией по
идее бьется да потому что логично да что если мы воду откуда-то куда-то перегоняем то как бы как
бы мы границу не ставили наверное через эту границу должна протекать ровно столько воды
вот но вот это вот оказывается очень удобно да то есть видим что а как кстати заметим что вот
это вот это f от ст то есть мы брали просто частные случаи разрезов ну просто есть разрез когда есть
исток и все остальные а есть разрез когда есть монреале все остальные вот соответственно а есть
просто вот сша канада есть такой разрез вот так же так как такая он сплотч да
не но мы дали ну если мы ну может там реаль конечная точка нет конечно если
монреаль находится монреаль вроде как не на границе сша но это уже дает но знаете это
уже напоминает что-то растил германии какой-то нет ну просто да типа шо такое фрг это такая
левая половина германии и полберлина вот вот да все вокруг остальной социалистическая часть там
это да да какая есть бы фрактальная не но это да но тут цена тут все относительно да так как бы
мы зала как нет понятно что есть теоретически они там могут и через мексику ездить принципе да
в чем некоторые так экзотически ездят до как это она кто-то поедет да как-то знаете эти вода ой
пойдем к отдохнем за границу приезжает и потом расскажет ой да ну и да преледу вот это называется
да преледа там привет амориген там пусти двух ринга которые хотят оставить много пес о твоей
стране а по границах спокойно окей добро пожаловать в канаду спрашивается когда какой звук издает водитель
все по характеру не не догадываетесь
то есть simpson восток уже не популярным ультик дам
а что-то есть вот ванда двое симптом что ли а у кошмар нет и да разрыв по колени конечно
на лицо да да да ой ой ой понятно да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да
кроется да ладно и так хорошо на чистый поток у нас вот такой нет это нас в общем-то даже кое к чему подводить да у нас значит цель найти максимальный поток
правда отсюда возникает вопрос вот особенно в преддверии там прошлых минус бесконечностей
а максимальный поток вообще существует нет да величина потока вещь ограничена там просто суммой простой способностей но из этого ничего не следует да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да да
почему
но поток это такой емерный вектор да ну да да заметим что множество векторов образующих корректный поток или там являются
каким-то замка да являются компактным но что короче но потому что до замка ограниченное вот это все да ну да а у него да как известно достигается супремум ура
да да да да на уровне функона можно сказать прям так но потому что если вот ну как сказать если у вас есть предел здесь у вас есть последовательность потоков
которые стремятся к чему-то то легко показать что это что-то тоже поток ну потому что потому что все суммы будут правильно стремиться например и
но ты и вот это вот но ты вот это вот неравенство тоже сохранится но если последствия не превосходит 5 то предел не происходит 5 вот
нет нет неприятного в емерном пространстве
да до этого мы ничего не доказали мы доказали что нет
замкнутая ограниченная до ограниченной доказали замкнутая трезвая значит это компакт значит радость
но очевидно это функция непрерывно да да все хорошо хорошо все ладно хорошо да это замкнутая это
ограниченный функция не при этом и функция непрерывно да хорошо все отлично все мы сказали все умные слова
которые надо было сказать да вот могли бы конечно их и не говорить потому что все равно мы доказывать это
конструктивным способом практически если мы рассмотрим функцию f то есть вот есть есть f это
доплыто это вот какая-нибудь функция от ребер да за но вот рассмотрим функцию модуль f которая равна
вот этой вот сумме вот я утверждаю что но вот но вот это я так чаю утверждаю я но вот я утверждаю
что фунта но то что функция модуль f непрерывно но то есть но f это как бы не функция но как бы
каждую каждую каждую разную функцию f можно задать как просто емерный вектор да утверждение но
вот я вот все могу все даже приватом отрицательные слишком большие там все что угодно да но я могу
для любого вектора ввести функцию аналогичную модуль f ну типа сумма нужных ребер но все да все
да отлично как приятно разговаривать на высоком уровне да вот шалк они всегда высокие означает
крутой но как бы да вот значит смотреть так значит что у нас тут получается значит жил было
значит модуль f такой но теперь выскакать вопрос как этот поток вообще искать
ну иногда крышка и текает ощущение чего-то жадного ну давайте вот какой-нибудь красивый
примерчик рассмотрен с пропускными способностями какими-нибудь
какими-нибудь там 1 2 1 там допустим там какой-нибудь тоже 1 1 2 там какой-нибудь 1 вот так выскакать
вопрос так вот сейчас у нас изначально поесть поток величины 0 можно ли сделать больше но есть
естественно жадный способ а давайте попробуем найти пути zft вдоль которого можно пустить
лишнюю машинку вот ну давайте какой-нибудь путь найдем ну например вот такой ну запустили
дфс он нам почему-то выдал вот это да так ну отлично так давайте продолжать давайте еще
найдем какой-нибудь жадного жадного пути еще увеличил правда проблема не находится скотина
чего погодите нет погодите значит смотрите вот если мысли так нет смотрите вот тут
чего тут надо аккуратно все вообще формально говоря если я просто рассмотрю вот это на
уровне сколько вешать в граммах то как бы самого по себе пути нету то есть так мы не
но заметим что поток очевидно максимальным не является потому что если бы пустили путь вот
так так было бы хорошо но у нас есть вариант модифицировать жадник как-то модифицировать
жаги модифицировать жаги можно так заметим что мы можем не только вводить новые машины но и
отменять их то есть смотрите вот мы же например вот можем захотеть отменить машину по этому
ребро а это ведь практически то же самое что пустить машинку обратно ну вот то есть такая
вот возникает идея но если мы себе разрешаем пускать машину обратно то тогда мы значит
вот то есть дфс опускается модифицированно он запускается не только по ребрам по которой
еще не насыщенные ну и по ребрам обратным к имеющимся дорогам по которым приедет хоть кто-то
если путь найдется то тогда появляется вот так как и такой путь в данном случае находится
обрати внимание вот пум пум пум пум и мы также что по нему проходимся и вот получается 11 тут
получается 0 потому что мы отменили тут получается один тут получается 1 так круто
Теперь считали пятные ситуации. Мы придумали жадник, он легко обвалился, мы додумали жадник так,
чтобы на этом тесте он работал. Значит ли это, что жадник работает всегда? Возможно,
за 30 секунд не удается найти какой-то пример. Нет, ну вот непонятно. Здесь как бы ничего не
сделать, потому что здесь понятно, что больше чем две машины в ТТ не въедут.
Вот, ну на самом деле, забегая вперед, конечно скажем, что это работает. И более
того, настолько хорошо работает, что индуцирует нам замечательное понятие «остаточная сеть».
Итак, новое определение. Ну, в смысле два. Как всегда, давайте будем вводить по-разному.
Значит, определение. Давайте начнем с простого. Определение. Пусть, как всегда, g это сеть,
g равно vcst. Это сеть, а f – поток в ней. Тогда у нас остаточная сеть. Остаточная сеть.
Это такая сеть gf, которая то же самое, только у меня c с индексом f. То есть относительно
исходной сети поменялся ток пропускной способности. Где cf от uv просто тупо равно
c от uv минус f от uv. Вот. То есть, видите, очень удобно. То есть, в этой интерпретации видим,
что когда у вас тут течет одна единица, то остаточная пропускная способность у этого
ребра 0, но зато у вас появляется обратный ребропуск на способности 1. То есть, для такой сетки,
давайте я нарисую нормально. Тогда оказывается, что остаточная пропускная способность на самом
деле выглядит вот так. Тут получается 1, тут получается 2, тут получается 1, тут получается 1.
И тут получается, ну вот, что еще получается? Тут получается 1, тут получается 1. А еще давайте
уже нарисуем, что получается 0, и тут получается 0, и тут получается 1. То есть, вот такая.
Чего? А, да, 2. Да, и тут, ну и тут на самом деле 0. Ну я везде тут нули должен рисовать, конечно,
потому что по-хорошему, в такой интерпретации между всеми парой вершины и стребра. Вот здесь
это определение писать сложнее. Потому что здесь мне, вот смотрите, вот тут вот мелкая техника
звучит так, то есть определение. Значит, здесь придется это звучит, значит, говорить так. То есть,
пусть значит g равно vz cst, cst сеть, а f поток в ней. Тогда, значит, остаточная сеть, вот в такой
интерпретации придется писать так. Остаточная сеть это g с индексом f равное там v, ef, cf, st. Где?
Значит, ef, e с индексом f это просто объединение таких ребер, значит, uv и vu. Там таких,
что, значит, uv это ребро. То есть, я для каждого ребра ввожу обратное. Ну вот, причем? Ну я так
вот напишу, c от uv равно, то есть c с индексом f равно c от uv минус f от uv, а cf от vu равно f от uv. Вот.
И то я немножко, и то я как-то не кузяло написал, конечно. То есть, не самая формальная идеаль. То есть,
я должен был прописать алгоритм, что переберем все ребра, и для каждого ребра из e добавим вот
такие ребра с вот такими пропускными способностями. Должно было я написать. Ну я не буду сейчас этого
делать, не будем заниматься совсем уже излишним буквоедством. Вот. А будет, ну вот, то есть как-то
вот здесь вот проще. Ну суть, в общем-то, остается. То есть, смотрите, остаток, то есть у нас есть
если мы запустили поток, то есть остаточная сеть, которая сигнализирует по каким ребрам,
в каких направлениях мы еще что-то можем пустить. Видно, да? Вот. И в принципе, становится достаточно
очевидно, что если в остаточной сети по ненасыщенным ребрам, точнее по ненулевым ребрам нашелся
путь от st, вот именно по ненулевым на этот раз, то поток можно увеличить. Видно, да?
Если у нас есть поток в остаточной сети, ну, мы взяли какой-то поток f,
для него взяли остаточную сеть gf, и есть какой-то поток f'. Тогда в начальной сети есть поток,
который будет равен условно f' потоку, и их величина тоже так же суммируется. Так,
ты точно, ты точно в потоке не знаешь, что такое? Логично, а, ну окей. Не, ну классно, просто должен
сказать, что, кстати, да, твоя логика полностью тогда совпадает с логикой Кормана, кстати. Да,
потому что вот если открыть Кормана, там вот начинает написано вот примерно, вот практически
то же самое в такой же терминологии. Да, окей. Не, хорошо, хорошо, ну вот значит, как всегда умные
люди мыслят одинаково. Да, отлично. Вот, соответственно, хорошо. Да, ну пользуясь случаем, да, напоминаю,
да, в Кормане, если что, по крайней мере, база вся есть. То есть нет, алгоритма Диница вы там,
к сожалению, не встретите, но там технология там push relabel, там до какого-то уровня описана. Вот,
так в чем замечательно описано, потому что вот, ну как я уже говорил, там Корман, это вообще там,
то есть это прям, то есть с точки зрения математической составляющей, просто один из лучших учебников по
алгоритмам, просто если не лучший. Ну, хотя нет, ну то есть так, с ним, конечно, там Бобенко-Левин,
конечно, с ним поконкурирует, потому что там, с точки зрения математики, там тоже все классно,
но Корман он, конечно, но Корман он фундаментальнее, что ли. Вот. Итак, далее, значит, что тогда это
был, значит, это f. Вот. И действительно у нас, как правильно было сказано. Более того,
кстати, эта логика у нас еще будет работать, потому что вообще говоря, вот это вот бывает
иногда нетривиально, что если вы вычтите максимальный поток и нашли какой-то поток f,
то у вас задача сводится к тому, чтобы рассмотреть остаточную сеть и найти в ней максимальный поток.
Иногда это будет называться оставшийся поток. Да, ну просто вот, ну ладно, это будет, конечно,
пригодится, видимо, на следующем занятии нам, да, у нас будет такое полномасштабное трехвекционное
занятие. Я прям большой соблазн сказать, а у нас нет возможности провести лишние три пары до
пятницы включитель, да. Полномасштаб. У вас сегодня C++, здрасте. Ну да. Ну, как сказать. Нет,
ну это нагло, как бы, да. Не, ну как сказать, тогда формально у кого-то на экзамене будет
сказаться, да, я понимаю, что я не пришел, но как бы на каких-то, но получил, что на эти занятия
у меня не было возможности прийти, поэтому я требую выкинуть их из экзамена, но там, то есть
формально это к сожалению может оказаться правдой, так что нет, то есть как бы по понятиям,
как бы все понятно, как бы хорошо, но формально придраться можно. Нет, ну ладно, на самом деле,
да. Нет, то есть если серьезно, то на самом деле я сильно не уверен, что нам как бы лишние занятия
реально потребуются, то есть просто отсутствие этих занятий приведет к тому, что ну значит,
ну ладно, если совсем честно говорить, то как бы это значит пройдем на пару укуренных структур
данных меньше. Вот. Ну так я так, ну укуренных, ну во-первых, укуренных, конечно, да, во-вторых,
в данном случае укуренных в том плане, что да, они как бы может быть сами по себе интересны,
но в общем-то не такие магистральные. Вот так скажем. Вот. Так что ничего страшного. Вот. Ну то есть
нет, может быть, конечно, ориентирован md-boss, а неплохо было бы изучить или там какие-нибудь это
xx-fast и xx-fast и так далее. Ну ладно, там специально ради этого забабахивать нет смысла. Так вот,
значит, остаточную сеть сказали. Так, ну ладно, нам на самом деле еще надо кое-что ввести. Потому
что, как мы уже сказали, то есть кто-то, конечно, скажет, что теорема Форда Фулкерсона как раз и
заключается в том, что фоток является максимальным тогда и только тогда, когда в остаточной сети
его нельзя улучшить. Ну вот. Но, как говорится, более продвинутые люди знают, что это не полная
теорема Форда Фулкерсона. И это важно, потому что если вы считаете, что теорема Форда Фулкерсона
заканчивается на том, что я сказал, то половину задач на потоке вы решать не умеете. К сожалению.
Да. Нет, вы это умеете. Я видел. Да. Вы-то да. Нет, вы там да. Вам там на одном контесте подсунули
знание одной стандартной задачи. Правда, вы там придумали походу что-то еще. Вот. Значит,
еще я кое-что должен. Раз уж мы тут про FOTST сказали, на самом деле нужно ввести еще одно понятие.
Понятие называется пропускная способность разреза. Ну и здесь я просто скажу. Это
общее определение. Пусть там G это сеть, там F поток в ней, ну в обеих интерпретациях неважно,
а ST разрез. Тогда, значит, пропускная способность разреза,
скная способность разреза, значит C от ST, это просто сумма C от UV. Вот, кстати, обратите
внимание. В отличие от чистого потока, мы здесь не вычитаем какие-то там пропускные способности
ребер, едущих почему-то обратно. Ой, ой, ой, так, что я сделал? Да, ой, ой, ой, да, вот так, конечно.
То есть обратно я ничего не учитываю. И возникает мелкое утверждение.
Я мог бы сказать, просто модулеф не превосходится от ST, но я написал просто вот этот промежуточный
шаг, который, по сути, делает доказательство. Ну, логично, да? Ну, потому что все это выполняется
просто вот по, ну, в этом понятии, во втором способе определения, вот просто по вот этому
свойству, а в этом, ну, по сути, тоже по нему и еще вот по этому требованию. Понимаете, да? Ну, то есть
как бы отрицательные ребра учитываются, но как бы пропускные способности мы не вычитаем. Нет,
это на самом деле очень важно, потому что, то есть это на самом деле дает нам какую-то связь между
еще одной задачей, уже чисто математической, казалось бы, задачей о поиске минимального разреза.
Вот представьте себе, такая есть абсолютно естественная задача. Жил-был граф, просто вот
неориентированный граф, может быть, или даже ориентированный, неважно, и у него в серебро
взвешены веса неотрицательные. Найдите, пожалуйста, минимальный разрез между ST. То есть разделите
на два множества так, чтобы вершина S была в одном множестве, вершина T в другом, а пропускная
способность была минимальна. То есть чисто математическая задача, вообще говоря,
ни с какой водой не связанная. Так, может быть, вы вот с такой задачей не сталкивались?
Ну вот, да. Ну вот. Ну, в принципе, да. Ну, в принципе, да. То есть, правда, это не я,
это теорема Форда Фолкерсона говорит нам вообще следующее. Вот теорема Форт Фолкерсон. Вот. То
есть в полном виде эта теорема формулируется так. То есть пусть, опять же, там G это сеть,
и F поток в ней. Тогда. Тогда следующие три утверждения эквивалентны. Эквивалентны.
Как они эквивалентны? Значит, ну как? Ну, вопрос какие? Во-первых, первое утверждение F максимальный
поток. То есть он обладает такой величиной, что не существует потока больше величины. Второе
утверждение. В остаточной сети вот GF нет пути из S в T по не нулевым ребрам. И третье утверждение,
оказывается, что модуль F равно пропускной способности какого-то разреза. Вот полная
теорема Форда Фолкерсона звучит вот так. Вот. Может быть вам ее доказывали, конечно,
без третьего пункта, хотя неявно вам пришлось бы его выковырить. Ну-ка, а так погибите вы,
кому теорему доказывали без третьего пункта? Так. А кому с третьим? Ух ты. Сначала 0, потом 4, да.
Так. А кому доказывали сразу с третьим пунктом? Нет, доказывали не у меня в смысле, а вообще
когда-нибудь. Вы же говорили, что вы же изучали потоки когда-то. Сразу с третьим пунктом. А ну
хорошо, это все правильно. О господи. Не забавно, да, когда вы там два взаимосключающих варианта,
вы все руки подымаете. Нет. Ну, когда доказывали без третьего пункта, а когда говорили сразу с
третьим пунктом. А то знаете, как-то классика бывает. Какой грех вы легче его прощаете?
Предательство, безответственность. Какой грех вы никогда не прощаете? Предательство, безответственность.
Интеллектуальные разговоры. Ну, если я не прощаю про вообще ничего никогда, то, конечно, да.
Ой, какой страшный человек Дворкович, оказывается. Так.
Нет, ну, но тогда да. Ух ты. Да, господин. Не знаю, как-то слишком,
слишком наивно для человека, который на момент задавания вопроса был заместителем
председателя правительства Российской Федерации. Ну, вот. Ну, то есть я не знаю, по каким-то причинам
он, правда, сейчас им не является. И по-моему, по-моему, кем он сейчас является? А, главой
международной шахматы Федерации, между прочим. Нет, ну вот. Ну ладно, впрочем. Впрочем, с другой
стороны вопрос. Вот. Впрочем, с другой стороны, так он отвечал только в нарезке, поэтому, да. Ладно.
Так вот. Ладно, давайте докажем теорию. Так. Ну, впрочем, если вам ее доказывали, вы так уже
догадываетесь. Ну, впрочем, на самом деле, в общем-то, из того, что сказано, в общем-то,
доказательства вывести почти все легко. Ну, я думаю, какие-то пункты уже просто очевидно следуют
друг из друга, правда? Ну, например, из первого-второго все следует очевидно. Да, в общем-то, из третьего-
первого тоже, потому что вот просто из того утверждения. То есть, в общем-то, самое интересное в этом
доказательстве оказывается, как из второго следует третье. А следует предельно. То есть, в общем, более
того, сейчас это будет конструктивный алгоритм. То есть, просто действительно алгоритм. То есть, как бы,
если вы нашли каким-то образом в сети максимальный поток, то вы за бесплатно находите еще и минимальный
разрез. Ну ладно, цена бесплатна. О от Е. Почему О от Е? Нет, ну это практически бесплатно, потому что
есть подозрение, что быстрее, чем за В плюс Е вы, там вы, наверное, поток не найдете. Причем, от слова
в принципе. Нет, собирая вперед, значит, говорю ставку. Значит, на текущий момент, в общем случае,
в самом общем случае, поток, по-моему, быстрее, чем за В и Е не находится. Ну или Википедия об этом
не знает. Так, вы уже настолько устали, что уже на автомате сейчас не идете это перепроверять.
Нет, 1 в квадрат Е. Нет, 1 в квадрат Е, значит, там всякие префлоу-пуши и прочие три индусы,
значит, это АВ куб. Значит, есть алгоритм ВЕ. Мы еще с вами увидим алгоритмы за ВЕ лог С и ВЕ лог В.
Ну либо Денис по штабируем, либо Денис с линкатом. Да, ну у нас есть линкат, в чем не воспользоваться.
Вот, но там сам по себе алгоритм ВЕ, это сильно более мощный алгоритм, может останется время,
даже его заботаем. Но для этого нам еще придется с вами пожить и поработать еще, потому что там,
да, но это очень красивая теория, тут она стоит того, чтобы ее хорошо изучать. А, нам еще надо
про сочетание изучить, кстати, да. Да, ну вот, но это отдельно смешно, да. Вот, значит, 3, 1, 2,
ну не совсем. Значит, смотрите, итак, 2, 3. Значит, доказательство звучит так. Значит, идея такая,
запустим ДФС, допустим, мы нашли максимальный поток, запустим ДФС, просто вот конструктивный
алгоритм из истока по не нулевым ребрам в остаточной сети. Ну, как мы уже предположили,
как мы уже предположили, до Т мы не дойдем, поэтому валидно определить разрез, то есть,
типа доля С это до чего дошли, доля Т до чего не дошли. Утверждение, все, это он. Доказательство. Ну,
раз тут ни по какими ребрам нельзя пройти, значит, наверное, там F равно С у них везде, значит,
получается, ну вот, по второму определению, да, вот можно так писать, да. То есть, во всех ребрах
получается, то есть, во всех вот этих идущихся ребрах получается F равно С, значит, F от СТ равно
С от СТ. Доказательство окончено. То есть, это реально конструктивный алгоритм поиска
минимального разреза. Понимаете, да? Вот, то есть, вот такая красота, которая позволяет нам решать
разные задачи, потому что задачи на самом деле, ну вот, задачи на самом деле, то есть, задачи на
поток на самом деле бывают разные. Но сводятся они обычно к двум задачам. Либо к задачам вида
построй сети, найди именно максимальный поток, и он тебе что-то даст. Классическим примером такой
задачи является задача сочетания в двудольном графе. Ну, вы уже догадываетесь, да? Вот, ну,
понятно, в чем задача? Что такое двудольный граф? Ну, что такое двудольный граф? Понятно, что такое
просочетание? Просочетание просто набор ребер, у которых нет общих вершин попарно. И задача дан
двудольный граф – найти максимальное просочетание, то есть, просочетание максимального размера. Как
такую задачу решать? Элементарно. Значит, грызем еще два маркера. Тут все продумано, как эффективно
грызть. О, точно. Чего? Господи, там грызут маркеры или что? О, господи, а почему именно в французской
школе, что в других школах этого не делают или что? Да, господи, и что, узнали, что у некоторых
людей нет косметики или что? Или, наоборот, у некоторых она есть. Я-то думал, это Босхо сделал там,
там вот в этой издевательской картине. Ну, значит, идея такая. Как сказать про
сочетание? Очень просто. Давайте построим вот такую сеть, то есть просто добавим исток, исток,
везде пропускная способность один. У этих всех ребер тоже будет пропускная способность один,
но строго направо. Вот так вот, вот так вот, вот так вот. Тоже один, один, один, один. Там один, один,
один, один, один. Чего? Вот. И запустим поток. Ну, очевидно, что любой поток здесь задает про
сочетание, любой про сочетание задает поток, поэтому максимальный поток, максимальное про
сочетание радость. Мы об этом поговорим чуть позже, сейчас мы не будем в это отвлекаться,
но, в принципе, алгоритм Куна, на самом деле, это просто вот этот алгоритм, просто более
оптимально по Константе написанный. То есть можно алгоритм Куна там, конечно, выводить это,
как там вас, то есть понятно, что обычно, скорее всего, когда вы изучали алгоритм Куна, то есть
просто говорили терриба про сочетание максимально тогда и только тогда, когда нет удлиняющей цепи.
Доказательства. Рассмотрим наше про сочетание, рассмотрим максимальное, там бла-бла-бла,
вот удлиняющая цепь, но на самом деле, если вы знаете вот эту теорию, то это ее простое следствие,
потому что любая удлиняющая цепь, как бы, любая удлиняющая цепь, это фактически вот такой путь
от S до T в остаточной сети здесь. Но остается только это правильно написать, там еще какие-нибудь
свойства, чуть позже, в какой-то момент мы этим займемся. Хотя, может, и сегодня займемся,
что-то у меня идеи, может, я сегодня даже вас, пожалуй, и позадерживаю, пользуясь тем, что в
следующий раз все равно ничего не будет. Не, не волнуйтесь, ничего мега сложного сегодня уже не
будет, но просто по объему какие-то вещи рассказать придется. Это вот пример такой задачи, когда поток
сам по себе что-то значит. Бывает задача, когда поток, когда, можно сказать, почти что-то такое,
бывает задача, когда, скажем, каждой вершине может соответствовать не одно ребро в про сочетании,
несколько. Ну, типичные задачи, знаменитые кубики. Ну, есть задача кубики. Значит, вам дано
N кубиков. На каждом кубике, понятно, у вас там на шестиграньях написаны какие-то буквы, записаны
какие, вправывается. Можно ли из этих кубиков сложить там какое-нибудь заданное слово? Ну,
задачу можно свести прям по сочетанию, да, то есть там, допустим, там как можно свести, то есть из
каждого кубика проводим ребра во все позиции слова, на которых можно поставить эту букву, да. Но
приятность в том, что в этой доле можно оставить всего 26 вершин, потому что здесь можно ставить
прописную способность не один, а сколько раз эта буква встречается в слове. Понимаете, да? То есть,
в общем-то, есть вариант карточки, когда у вас не кубики, а карточки там двухсторонние, и тогда
вообще там, оказывается, там, может быть, там любая длина слова, любое количество карточек,
а там сеть в итоге все равно, тут размер получается там 676 пополам, а тут 26. Вот, понимаете, да? Вот,
вот есть такой пример. То есть, ну, самый издевательский пример задачи на эту тему,
вот мне помнится такой, значит, там Петя Нумизмат. Так, ну, на всякий случай,
знаете, такой Нумизмат, да? А то мало ли, да. Вот, то есть, он действительно коллекционирует монетки,
значит, он хочет собрать, значит, всего есть там n монета, n типов монеток, ну вот, и, значит,
он хочет собрать как можно больше различных типов монет. Значит, как это происходит? Присходит
очень просто. Помимо Пети есть еще коллекционеры, и про каждого коллекционера, включая Петю,
известно, сколько монет, какого типа у него есть. Значит, Петя, значит, понял, что он может
часто ходить под коллекционером и меняться с ними монетку на монетку. Но при этом, оказывается,
что коллекционеры люди ушлые и меняются только, когда им выгодно. Что такое выгодно? Выгодно это,
когда они отдают монетку, которая у них еще есть, и взамен они получают монетку, которую у них
еще нет. Да, именно так. Вот. Но, соответственно, если у них пять таких монеток, то они, значит,
четыре из них могут выменить, но последние уже не отдадут. Вот. И у вас возникает такая задача.
Ну, ограничение там, как всегда, по соточке. Спрашивается, как, значит, как Пети действовать,
как Петя организовать обмены так, чтобы в итоге получить как можно большее число монеток,
различных монеток, различных типов. Вот. Спрашивается.
Нет. Нет. Ну, скажем так, теоретически мы можем это сделать, то практически непонятно зачем.
Если моя нота. Да. Ну, вот. Нет, на самом деле, да, есть подозрение, что просто в этом нет
необходимости, потому что легче. Но тут возникает вопрос, как построить адекватную сеть, чтобы она
что-то это притировала. Да, вот тут. Прямо до ли так? А влево еще?
Так, хорошо, давайте типы. Так, это типы монеток. Так, а тут коллекционеры. Так. Ну, проводим, да.
Так. Ну, проводим действительно. Сколько таких монеток? Так, то есть проводим один, если такой
монетки у коллекционера нет. Ну, сейчас, ну, смотрите, мысль правильная. Если монетки у коллекционера нет.
Вот. Хорошо. Обратно. Ну, да. То есть, потому что смысл будет в том, что прохождение по этому
и обозначает, что мы решили отдать этому коллекционеру вот такую монетку. А взамен мы
получаем какую-то другую монетку размера там СК-1. Ну, КЛ там точнее. Ну, типа какая монетка,
какой коллекционер, да? Это типа сколько у этого коллекционера таких лишних монеток? Нет,
правильно. Остается только, смотрите, добавить и сток, в котором мы в каждую монетку рисуем,
то есть, допустим, сколько у нас таких монеток есть? Нет, на этот раз стока, да. То есть АКТ,
да? Именно стока. Нет, потому что делаться это будет так. Вводим еще сток и ребра теперь вводим так.
И с каждой монетки отправляем, значит, в сток пропускную способность 1. То есть, это означает,
что мы решили, что это то, что мы отправили в Т, это означает, что такую монетку мы себе
сохранили. То есть, это будет означать, что если какая-то монетка у нас уже есть, то одну монетку
можно прямо через это ребро сразу в Т отправить. А можно не отправить. Но здесь заметим следующее,
да, что тогда оказывается, что если поток как бы разбит на пути, то каждый путь отполучает цепочку
обменов. Да, здесь, конечно, нужно отметить, да, что вообще, ну, во-первых, да, здесь, конечно,
интуитивно должно быть очевидно, что, действительно, что у потока есть такая вещь, как декомпозиция. То
есть, любой поток можно представить в виде набора путей, сумма которых представляет этот поток.
Да, но, да, утверждение, действительно, так особо не верно. То есть, на самом деле,
теория моей декомпозиции звучит так, что любой поток можно разбить на не более, чем модуль Е,
путей и циклов. Понятно, да? Да, только надо это аккуратно доказывать. Аккуратное доказательство
звучит так. Ну, допустим, у нас сейчас поток величины больше нуля. Тогда мы возьмем,
ну, это, кстати, реальный алгоритм, в принципе, так можно писать. Значит, берем S и просто говорим так,
раз поток величины больше нуля, значит, наверное, существует ребро, где тут течет что-то нетривиальное,
правда? Так, теперь берем вот эту вершину. Так, раз в нее что-то втекло, значит, из нее что-то вытекло.
Так, значит, из нее найдется ребро с больше нуля. Вот. И так далее. Просто жадно берем, берем,
и тогда у нас два варианта, чем может все закончиться. Либо мы придем в вершину T,
это значит, мы нашли путь. Давайте вычтем из этого пути поток так, чтобы какой-то из этих ребер
обнулилось. И будем повторять операцию. Или второй вариант. Мы неожиданно зациклились. Но если мы
зациклились, то значит, берем этот цикл и тоже вычитаем поток так, чтобы одно из этих ребер
обнулилось. То есть получается один путь или цикл. Получается, мы нашли за там сколько. Вот В плюс Е.
Повторяя операцию так Е раз, можно декомпозировать поток. Ну ладно, по модуле технического момента. На
самом деле это мы дойдем до ситуации, когда у нас величина потока, скажем так, меньше либо равна нуля,
а поток бывает отрицательный, кстати. Ну а что, собственно, что вам мешает сделать вот такой поток
интеллектуальный? Да, это поток величины минус один, поздравляю. Формально, да, это нормально. То есть,
если вычитать максимальный поток, то выгоднее было бы просто, чтобы у нас из Канады в США никто не
ездил. Вот, если мы из США в Канаду хотим побольше потока сделать, да. Вот, поэтому так. Ну вот,
но если у нас есть поток отрицательной стоимости, то мы можем декомпозицию запихнуть и пути от ТВС
логичным образом. Это приведет нас к тому, что у нас наконец в какой-то момент наступит поток
величины ноль. Но, к сожалению, это не значит, что никто никуда не ездит. К сожалению, да,
формально говоря, да, как мы уже поняли, у нас тут кто-то по кругу ездит. Да, кстати,
поток величины, кстати, определение. Слово такое умное, циркуляция. Что такое циркуляция? Нет,
циркуляция это поток величины ноль. Все, это прямо определение. Вот, то есть, да, то есть,
этот поток, да, теорема звучит там, что циркуляцию можно разбить на Е, не более чем Е циклов. Доказательство
абсолютно тоже. Рассмотрим ребро какое-нибудь, по которому течет что-то больше нуля, да. Заметим,
что раз у нас тут втекает больше нуля, значит, вытекает больше нуля. Заметьте, так как поток
величины ноль, то эта вершина может быть даже С или Т, это все равно работает. Тут больше нуля,
тут больше нуля, но идем-идем-идем, рано или поздно зацикливаемся. Не обязательно в этой
точке, но все, цикл нашли, вычли, повторили операцию. В принципе, да, то есть, там классическая задача
есть, найдите максимальный поток и декомпозируйте его, и там вот эта последняя фаза не обязательно,
потому что на величину потока циклы не оказывают влияния. Но в общем случае иметь
в виду надо, что циклы есть. Вот, начнете декомпозиция, то есть вот, то есть эта декомпозиция,
теперь если декомпозировать вот такой поток, то можно заметить, что каждой единицы потока
будет соответствовать просто путь обмена, то есть путь будет звучать так, мы взяли эту монетку,
обменяли ее у этого коллекционера на эту монетку, эту монетку мы в свою очередь понесли сюда,
ну и потом в конце дошли. То есть вот такая красота. То есть это вот такие классические задачи,
в которых поток нам нужен именно поток. Есть, конечно, классические задачи, в которых нужен
именно разрез. Так, внимание, вопрос, надо делать перерыв. Нет, нет, нет, мы же уже сказали,
что нет, если думать, что я сейчас отпущу на 10 там в 13.30, то нет. Значит, смотрите, план у меня такой,
по модуле того, что я хочу рассмотреть еще парочку задач, я сегодня хочу рассмотреть внезапно
минкост. Да, редкий случай, конечно, да, минкост обычно, конечно, рассказывается в самом, там,
после всех остальных потоков, но все-таки мне пришло в голову, что минкост можно рассказать
и сегодня, и он будет сегодня в тему. Потому что мы и Джонсона рассмотрели, собственно, технологию
форта Фулкерсона, а там мы, собственно, сильно далеко-то, в общем-то, и не уйдем. Вот, так же,
соответственно, но это будет означать, что там, насколько-то я вас задержу. Да, вот мне тоже так
кажется, поэтому давайте перерывчик. Значит, смотрите, итак, давайте, значит, еще одна задачка.
Теперь задачи на разрез. Ну, на самом деле, разные задачи на разрез есть, но, значит, я рассмотрю
такую. Она, может быть, немножко теоретическая, но, значит, такая веселая. Называться она у нас
будет яростью команды. Да, извините, кто слушал лекцию, да, ничего нового не будет. Ну, что поделать.
Значит, смотрите. Да, ладно. Значит, смотрите. Значит, задача такая. Значит, смотрите внимательно.
Представьте себе, что у вас есть стартап. Ну, для многих, на самом деле, это не такое уж умозрительное
заключение. Вот кто-то захочется бабахать в свою компанию. Вот. Ну, что такое стартап? Ну,
обычно поначалу это означает, что нас тут там три человека. Ну, вот, то есть, допустим, там,
то есть нас три человека, и мы все вместе все делаем. То есть, причем все делают фактически все. То есть,
типа, там все все знают. Фактически, мы там, наш офис представляет собой маленькую комнатку,
там, с одним столом вокруг которого мы сидим, и, собственно, работаем. Все. Ну, скажем так, более
точная отсылка будет на Сирал Жуки, на самом деле. Нет, там в команде есть такой главный, который там
просто командует. Есть дизайнер, который все дизайнирует. Есть программист, который все кодит.
Вот. Ну, там больше похоже на правду, хотя только у нас все все кодят, все работают. Ну, короче,
делаем продукт. Вот. Как это иногда случается, стартап оказался успешным. Да, такое тоже бывает.
Вот. А что происходит с компанией, когда она становится успешной? Да, логично она расширяется.
И вот у вас уже четыре человека, пять человек, шесть человек, десять человек, двадцать человек.
Не-не, ну, это не совсем. Нет, тут уже аналогия совсем неуместна, потому что, очевидно,
они не за одним компом работают. Да, это важно. Вот. Тем более, что, да, тем более, что, как бы,
еще одна разница, если серьезно, между, как бы, ICPC и, собственно, такими стартапом, тем,
что задачи, как бы, ставите вы себе сами и тестируете, кстати, тоже, а не вот ICPC.
Если вам дали ICPC, значит, как бы, жюри ее решили и хотят, чтобы вы ее решили не хуже. Ну, вот.
Соответственно. Вот. А тут немножко другое. Вот. Но тут не важно. Двадцать человек, ну, пока еще,
до какого-то момента, в принципе, все вместе, всей толпой работаем, все хорошо. Но когда уже человек
стало уже пятьдесят сто, вы уже понимаете, что, да, вы достигли такого уровня, когда надо что-то
с этим делать. То есть все-таки, когда совсем уже все все знают и все в одной толкучке, это уже
печально. Ну, поэтому решили. Давайте все пока постепенно. Давайте начнем. Решили вы начать
с малого. Решили вы разбить ваш отдел на два отдела. В одном у нас будут пражаромисты,
а в другом тестировщики. Вот. Так. Ну и вы стали думать. Интересно, как же разбить людей на
программистов и тестировщиков? А у вас же, как это часто бывает, у вас все люди хорошие, все могут
программировать, все могут тестировать. Вот. Поэтому, но с другой стороны, как бы понятно, что в такой
компажке обычно все всех любят и так далее. Но вы, по крайней мере, всех любите. И вот, все с вами
давать. Поэтому вы решили их спросить. И, значит, вы решили вопрос и привели следующее. Оказалось,
что некоторые люди хотят стать программистами. Что такое хотят? Это означает, вот какой-нибудь
человек говорит, я хочу быть программистом. А если ты будешь тестировщиком? Ну я могу стать
тестировщиком, но я буду плакать. Я буду плакать, и мой уровень плача, а В больше 0. Вот. Но там есть
слез в единицу времени. Но выяснилось, что некоторые люди, оказывается, хотят быть тестировщиками.
И оказывается, но вот. И они тоже будут плакать, если сделают программистами. Да некоторые будут
плакать и так, и так. Но это уже ладно. Не, казалось бы, да. Все просто. Давайте, кто хочет стать
программистом, будет программистом. Кто хочет стать тестировщиком, будет тестировщиком. Плакать
никто не будет. Да, все положительно. Нет, наоборот. Этот будет плакать, только если он станет
тестировщиком. Теоретически, да. Может быть и то, и то. Тогда он будет плакать всегда, потому что он
не любит, когда ему ограничивают его поле деятельности. Чего? На ваше усмотрение. Я узнал,
что кто-то будет плакать. В общем, я узнал, что кто-то не будет плакать. Пожалуйста, как нужно
компании, так я готов делать. Я нормальный футболист. Правильно. Если я нужен на правом
фланге полузащиты, значит я буду бегать на правом фланге полузащиты, не вопрос. Но выяснилось,
но если бы это было все, оказались еще маленькие спецэффекты. Оказывается, некоторые люди дружат
между собой, что нередко наблюдается в компаниях, да и некоторых ECPC-командах тоже. Да, случается
такое. Выясняется, что есть некоторые такие пары товарищей C и D, которые говорят,
мы хотим работать вместе. Если нас разнесут по разным отделам, мы будем плакать. С с индексом
CD. Нет, ладно, не так. Давайте это x, y. Мы будем вот так плакать. Вот так вот. Но и на этом мы
не остановились. Оказывается, вот совсем печально. Есть такие вот странные отношения. Я могу быть
программистом, я могу быть тестировщиком. В принципе, это нормально. Но если вот эта скотина меня
будет тестировать, я взвою. То есть вот какой-нибудь человек z заявляет, что я не хочу, чтобы меня
тестировал w. Вот если я окажусь программистом, а он будет тестировщиком, я взвою на уровне dzv.
Да, сами цифры разные. То есть у кого-то это будет Дениска типа, ну ладно. А кто-то будет
на 10, кто-то на 100, а кто-то прямо на плюс бесконечность. Я тут все разнесу вообще отсюда.
Просто я возьму это пулемет и разнесу весь ваш офис. Начиная с серваков,
на котором хранится весь код. Ну 10, 9. Хотя, кстати, нет. Лайфхак на самом деле такой,
действительно лайфхак, который помогает в задачах на потоке. Если вам иногда запрещается делить
вершины каким-то образом, то что такое запретить? Это объявить за это бесконечный штраф,
стандартный метод. Можно не только в потоках использовать, но вот так. Но как это использовать,
давайте сейчас смотреть. Вот такие запросы он собрал. Есть там сколько-то таких пар,
столько таких запросов. Ну и теперь задача. Как теперь разбить на два отдела так,
чтобы суммарный плач был как можно меньше. Да, могут быть люди, которым абсолютно все равно,
которые вообще ничего не касается, они готовы на все. Ну допустим. Хотя,
честно скажу, для нашего решения того, которого я предлагаю рассказать, это в общем-то не принципиально.
Ну на ваше усмотрение, пожалуйста. Да какая разница, господи.
Не, ну суть одна, хотя в данном случае может быть лучше каждый запрос отдельно
рассматривать. Просто меньше запросов, в итоге будет там меньше объема решения.
Потому что тут возникает вопрос, а с какой точки зрения вообще думать? Ну,
соточка, ну там 50-100, запросов, ну тоже какие-то мелкие. Ну ладно, в общем-то это неважно,
потому что мы пока вообще не знаем ни одного алгоритма поиска потока. И сегодня в общем-то
не узнаем. Нет, ну ладно, у нас есть один алгоритм. Нет, смотрите, алгоритм, а вот я забыл сказать,
алгоритм Форда, нет, вот теорема Форда Фалкерсона не дала нам еще ни одного алгоритма. Она нам дала
то, что мы будем называть метод Форда Фалкерсона. Значит, внимание, это вот важная терминология,
метод Форда Фалкерсона, то есть вот так, метод FF. То есть он будет заключаться как while в
остаточной сети есть путь по ненулевым ребрам, по ненулевым ребрам, там найти путь, пустить по нему
поток. Это почему я называю метод Форда Фалкерсона, а не алгоритм, потому что он вообще не говорит о том,
а как мы этот путь идем, то есть какие небеса и какой факт нам будут это обеспечивать. Потому что
если искать этот путь тупо ДФСом, то может так случиться, что этот while будет работать бесконечно
долго. Нет, если, конечно, для этого нужно, чтобы профессиональные способности были иррациональны.
Да, там просто я не буду сейчас на это представлять, там в Википедии есть короткий пример, который
действительно зацикливает алгоритм. Более того, сразу скажу, что добавив пару ребер, и оказывается,
что этот алгоритм не просто не будет находить, никогда не закончится, он еще и сходится к правильному
ответу не будет. То есть, конечно, была бы мечта, что давайте в какой-то момент остановимся и скажем,
что это почти правильный ответ. Нет, не работает. Нет, ну смотрите, просто допустим, у вас есть сеть,
на которой ответ сходится, а давайте в эту сеть еще рядышком там ребро найдем, и пусть этот ДФС
от ребра никогда не видит. Да, поэтому вот получается, что сходимости никогда не будет.
Это уже другой вопрос. Ну, в принципе, да, то есть, первый алгоритм, обычно который вас
вызывает реально алгоритм, это алгоритм Эдмонса Карпа, допустим, Эдмонса Карпа. Этот алгоритм у нас
работает, то есть, в этой терминологии это метод ФФ, СБФ, совершенно верно. То есть, мистическая
терминология заключается в том, что этот алгоритм работает за ВЕ квадрат. Сегодня мы не будем доказывать
эту теорему, мы ее докажем в следующий раз. Я думаю, когда мы будем обсуждать это вкупе
с алгоритмом Диница, это будет более к месту. То есть, пока просто можете считать, что вот работает
вот так. В этом смысле у Диница тоже самое. Формально он работает за В квадрат Е, но в
подавляющем большинстве случаев на самом деле он работает быстрее, причем на этот раз у нас
будет уже доказательство, потому что там две теории в виде просто двух теорий Корзанова,
на самом деле, которые будут говорить про целочисленные сети и так далее. Но я просто, скажем так,
почему Минкост хочу сегодня обсуждать? Потому что логика Минкоста, она близка к логике Хордафу
Фликсона, а логика Диница и Эдмонса Карпа, она тоже общая, но другая. То есть, там уже какие-то
слоистые сети надо выводить и так далее. Поэтому я хочу это вынести в следующий раз, чтобы тоже
объединить скоп. Но вернемся вот к этому. Допустим, у нас размер графа такой, что там, допустим,
поток зайдет. Спрашивается, как же нам теперь это сделать? Не линкат, а минкат. То есть, на самом
деле, это задача на поиск минимального разреза. Надо построить такую сеть, чтобы минимальный
разрез в ней был ответом. В данном случае это делается наиболее простым образом. Давайте построим
такую сеть, что пропускная способность любого разреза будет соответствовать разбиению на
программистов и тестировщиков. Вот пусть программисты у меня будут доля S, а тестировщики доля T. Вот я
специально заблагодарил их зелененьким, красненьким нарисовал. И вот теперь давайте думать, как бы
нам сделать так, что если вот эта вершина окажется в доле T, то в разрезе оказывались лишние АВ единиц
пропускной способности. А если нет, то нет. Да, абсолютно верно. Давайте из вершины S,
фиктивной вершины, ну не фиктивной, а отдельной вершины S, добавим ребро в эту вершину пропускной
способности АВ. А есть вот. А есть вот это. БУ. То есть это вот для стока, наоборот. То есть,
если она окажется в доле P, то как раз ребро пересчет разрез. Чего? Да. Что делать с друзьями?
Вот смотри, тут тонкая разница. Так, да, здесь нам придется пустить оба ребра пропускной способности
C и X. Тогда, смотрите, тогда если они окажутся в разных долях, то в разрезе окажется ровно одно
из этих ребр. Обратите внимание, ровно одно, потому что ребро из доли T в долю S в пропускной способности
не учитывается. И это вот тонкая разница. Потому что что мы делаем для вот ZV? Да, мы проводим ровно
одно ребро. Вот такое. Вот пропускной способности DZV. То есть видите, оно получается включается именно,
когда Z программиста W тестировщик. Если наоборот, Z тестировщик W программиста в разрез не
включается. Понимаете, да? Ну, если они в одной доле, то тем более. Вот такая получается,
получается вот таким простым образом вы построили сеть. В этой сети любой пропускной способность
любого разреза, это просто плач, который получится здесь разбить именно так, остается только найти
минимальный разрез. То есть задача, формально говоря, не совсем корректно даже говорить,
что это задача на поток. Это задача на разрез. Потому что поток, это задача на поток только лишь в том
плане, что вы ищете минимальный разрез через, там с помощью поиска максимального потока. То есть
если вы найдете, научитесь искать минимальный разрез каким-то другим способом, то в общем-то и
поток вам не понадобится. Вот. То есть таких вот задач на самом деле много. То есть есть там разные
технические задачи. Вот. Ну одна из таких задач, классическая задача, это знаменитая задача
про мотан, раз уж об этом зашла речь. А вот давайте, кстати, да. А ну-ка, кто сталкивался с задачей про мотан?
Да ладно. А как вы потоки изучали без задачи про мотан? Нет, задача мотан. По-моему,
задачу не переформулируют. Нет, она там во всех там, во всех Тинькоффах, там она тоже так-так
идет по длине. Там нет смысла переформулировать. Ну да, про профессора, который, собственно, у которого
там есть какие-то темы, которые зависят друг от друга, который хочет тоже какие-то включить. Да,
вот давайте вспоминать. Вот знаменитая задача про мотан. Ну она просто везде называется мотан.
Значит, задача звучит так. Жил-был профессор, который составляет курс по, ну допустим, мотану.
Значит, составляет курс по мотану. И он думает, значит, какие-то темы он, значит, думает, что есть у
него теоретически n тем, которые мог бы он рассказать. Вот. Но он не хочет рассказывать прям все. Почему?
Потому что у тем есть полезность. Полезность бывает как положительная, как так и отрицательная, а
бывает и нулевая. Он, конечно, хочет сделать так, чтобы курс был максимально полезен. Вот. Но маленькая
проблемка. Хотя, да, если бы я в терминах КВН и шутер, конечно, это было бы точнее. Да, ну ладно. Вот.
Ну ладно, пока в терминах мотанализа звучит так. Но выясняется, что иногда одно без другого не
работает. То есть выясняется, что для некоторых пар тем там z и w выясняется, что если ты хочешь
рассказать тему w, будь добр и рассказать тему z. То есть иначе просто нельзя. Но там нельзя
рассказать, действительно, что такое производная, не объяснившую, что такое функция, например. Да,
так себе пример, но соответственно. Вот. То есть вот что-то вот такое должно быть. То есть может
быть, конечно, эта тема прям будет тупая, но вот ее надо проговорить, потому что потом вот. Вот. И
вот. И у него есть таких несколько зависимостей. Ну там ограничения, там были что-то типа, по-моему,
200 вершин и тысяча зависимостей. Вот. И у каждой темы, например, есть полезность. Теперь задача,
как выбрать подмножество так, чтобы было хорошо. Нет, время вообще не причем. Просто, да, просто
набор тем. Он может рассказать, причем интересно, что он в курсе, может рассказать вообще про хоть
все темы, может рассказать ноль. То есть ограничения на количество тем у него нет. Ну потому что в
зависимости от этого от этого он там, видимо, пойдет в учебную часть и будет говорить, сколько там мне
парк неделю надо. Допустим, хотим максимизируем полезность. Такая техническая задача такая. Так,
а именно где то же самое. Так. Так, ну хорошо. Сейчас тут надо оговориться о том,
что мы считаем штрафом тогда. Мы же минимальный разрез еще максимальный. Да, то есть давайте сразу
это поговорим, потому что кажется, что задача простая, но как показывает практика предыдущих
поколений, то есть если вы не особо опытные в решении этих задач, то как бы эти технические
тонкости могут оказаться для вас страшным. Начнем со следующего. Давайте предположим,
что мы изначально взяли все полезные темы и не взяли все бесполезные. Ну вот, и начиная с
этого момента, теперь мы имеем право отказаться от уже взятой темы и заплатить за это штраф в виде
истории, либо наоборот взять бесполезную тему и наоборот получить и получить штраф уже за это.
Понимаете, да? То есть теперь наша задача найти под множество тем,
так чтобы суммарный штраф был как можно меньше. Понятно, да? Но как же нам этот штраф обеспечит
теперь? То есть вот смотрите, ну давайте думать, какие-то темы мы вот теперь взяли, да, а какие-то
темы не взяли. Вот да, у нас теперь будет значит откуда здесь берется разрез, то есть две доли это
типа взяли, не взяли. Ну и теперь, если я решил ее не взять, как и ранее, я просто вот провожу
ребро пропускной способности АВ. Это означает, что если я ее не возьму, я заплачу штраф АВ. Понятно,
да? А если я решил вот это, а не взять вот так вот в Т, ой, что-то цвета перепутал, да? Ну что
поделать? Ладно, ничего страшного. То здесь, наоборот, я получу БУ, так как у меня тут было
отрицательное, то как бы этот штраф тоже больше нуля и меня устраивает. А теперь есть какая-то
вопрос, как же мне запретить ситуацию для какого-нибудь ЗВ? То есть как мне запретить ситуацию,
когда W взята, а Z нет? Ну идея такая, да, что берем вот, если W взята, Z нет, мне такое надо
запретить. Я просто провожу между ними ребро в эту сторону пропускной способности плюс
бесконечность. То есть, ну понятно, как всегда, достаточно большое число. Достаточно большое,
чтобы как бы минимальный разрез заведомо обходился без этого. Да, напоминаю, конечно,
всегда можно обойтись без этого как минимум, потому что можно всегда все темы взять или все
темы не взять. Что? Мы взяли все. Ну как тебе сказать? А, ну это кому как. Нет, ну как сказать,
нет, мы помним, конечно, это да, ситуация, да, с конец второго курса, значит, ученые выбирают
курсы по выбору на следующий раз. Там кто-то сидит, это там Дин Томас, там вообще просто там,
брал палочку и просто тыкал рандом на список. Гермиона заморачиваться не
стала, просто записалась на все. Да, в следующей серии это привел к появлению муховика времени.
Чего? Некоторые буты были не нулевые. Некоторые что? Что такое буты? Ну да, нет, но там страда не
да. Во-первых, выяснилось, что да, как-то, скажем так, там как-то пыталось пока меня относительно
ее курс проялицания был скорее в минус, ну как минимум, чисто лишний отрата времени, но там такой
странный курс, конечно. В книжке это интересно подается, то есть там не отрицается сам факт
возможности вообще проялицания как такового, да, но при этом как бы, но при этом, называется,
обучение этому проялицанию было как-то сомнительно. То есть, скажем, там сама Гермиона,
как там называется человек, действительно просто, ну там просто плотный как человек,
просто с идеальным, абсолютно точным мышлением. То есть, называйте просто мышлением, в этом смысле,
два линии просто мужским. То есть, конечно, Гермионе не зашло, а какой-нибудь там ее одногруппница
из Индии, ну по имени Парвати Пател, ну можно предположить, наверное, Дашаной. Ну, по крайней
мере, по фильмам предполагается, что да, она, видимо, из Индии какие-нибудь. Там, наоборот,
там Парвати экзамены сдавал, наоборот, слушайте, я столько всего увидел, у меня вообще там профессор
все задатки ясновидящие вполне себе. Но какая-нибудь профессор МакГонагл, конечно,
с этому тоже относится, конечно, не очень, но профессор МакГонагл тоже, в общем,
называется человек, тоже известный именно, тоже своим умом. Нет, нет. Нет, тут нет, отдельно
мотан, это немножко не совсем то. То есть, конечно, тут более точно было бы это, потому что у вас,
вам было быть ближе шок, что есть математические предметы, есть программические. И возможно, вы
там, допустим, тащите математические предметы, а программические застреваешь, потому что там
не помогает именно мышление, что давайте, давайте все выведем, потому что там работает мышление,
типа вы должны выучить, как работает инструмент. Все. То есть, а кому-то, наоборот, вот это именно
вот, ручками пошупать, понять, как устроено этим пользоваться. Вот гораздо удобнее, чем выводить
все производные с интералами ну да вот то есть ближе так вот то есть конечно там всякие спецэффекты
ну окей вот значит поэтому там от полезность но там дробь еще гермен и там практически не там
просто до нервного срыва в итоге дошла чем-то хотя хит и до хит сезона до изучения моглов да это
да для нее это был шедевр нет то есть классно конечно наверно изучать именно как это выглядит
видят волшебники до этой тоже полезно наверное но вот слава богу обошлись хотя ладно нет
иронично что она при этом изучала такой курс как номерология нет то есть типа пролица не фуфло
номерология классно не притя да проблем то что номерология это не мотиватика как бы тоже то
есть номерология это практически как бы наука о том что как бы там про какие-то цифры и связанные
приметы вообще то есть как бы вещь такая вот поэтому то есть это не совсем то есть если там
на математике конечно реально изучали кинь производные интегралы прочую радость ладно ладно
но да да тригонометрия синус кассимус да нет ну теоретически нет иногда вообще можно
предположить что может быть на самом деле после прослушав курс или варенье вы что-нибудь о
химию узнаете в принципе то есть как бы да боже вот смотрите магия если поместить это то
начинается магический процесс ой они не тролли с летом а то есть приехали до дани какой магии просто
реакция да нет нет нет нет нет на эту тему на эту тему ладно заканчивай эту тему мы хотим
пообедать еще да ну как мы вот вот то и на самом деле на эту тему как раз можно снова
порекомендовать книжку по оригаторе каменный философ так что соответственно вот там его да
потому что там они собственно тоже к концу первого курса там пришли к тому что вообще неплохо было
в хорус вести вот такие там предметы как физика химия с новой компьютерной грамотности да цель
когда как там была цель курса цель курса каждый ученик должен владеть компьютером или хотя бы
клавиатурой да так что вот так что я рекомендую там там еще нет там прийти дальше еще еще две
книжки есть третья аж в двух частях так что рекомендую да там так и называть личное дело
маркион и 9 подвигов сцена если если что так вот и рекомендую там заменить кто-то там не менее
замечательно становится вот ладно значит идем дальше значит хорошо ладно тут мы значит с
полезностью определились но ладно господи вот должен был вот хоть хочется минкост но нет
потому что дело теперь вступает просто может быть уровень хард задача ха знаменитая задача
хак лайф да знаменитая задача задача знаменитая тем что 2008 там что на полуфинале cpc 2008 года
эту задачу никто не решил вот хотя казалось бы ее решение было за много несколько лет до этого
даже за приличное количество лет до этого описано статья хотя да сейчас как-то ну да ладно так что
готова но хотя это хотя на самом деле перед задачей хард лайф я пришла до еще одну мини-задачу
хоть хочется встать рационально хочется вставить задачу она не связана прям непосредственно с
темой но как бы знать ее тоже надо это знаменитая задача тоже называется циркуляция значит задача
такая дан граф то есть дана сеть найдите хоть какой-нибудь поток но есть нюанс не он заключается
в том что на каждом ребре есть не только ограничение сверху сколько воды может течь но и ограничение
снизу то есть вот бывает такая ситуация что у вас то есть на каждом ребре у вас написано что
поток должен быть не менее чем l и это и не более чем ци это скажите пожалуйста существует ли
такой поток если да желательно предъявите вот то есть вот такая какая-то сеть допустим там 2 5
там допустим 3 7 там я не знаю что-нибудь еще там да с и т на самом деле нету ладно то есть может
ну можете считать что можете считать что это ты нету мы ищем циркуляцию но циркуляцию вот с
такими вредными ограничениями но любую нас стоит любая циркуляцию вот этим ограничения нет если
тут везде 0 то как бы пустой поток нас устроит вот 5 какая-то такая вот гадость вот
да согласен предъявить там пози вот давайте
нафтов ты будешь чего чего хорошо давайте еще накидаем да везде проблему
но хочется привести пример когда существует или пока имели не очевидно
не настолько иногда но существует да например до только проблема в том да что иногда бывают
и более нет реальный случай так то вот задача да вот кстати надо надо и да ну вы знаете да недавно
тренировки была задача такая что если вы это знаете то решение становится очевидно ну как
недавно месяц назад вот но там это пойти у вас там был контест этот когда там 9 тупых задач
нет ну да вы да ну ну там задача такая если вы если вы вот это знаете то как бы там решение
возможно сильно проще придумывалось но я не помню сейчас задача на помешу вот решение был
такой там типа типа знаете вот этот баян вам было бы сильно проще без знания баян тоже
можно выкрутиться до ну шоу и сделали но ну может вы без поток в каши сдали хотя странно
нет а потоки откровенные были ну ладно ну теперь вот возникает вопрос как решать такую задачу
но вот
хороший начал
так ведем вели
так но для начала мы хотим к обычному потоку свести до
так вот неожиданно вот
ну то есть идея такая
да именно в этом порядке
вот такую махинацию предлагается сделать с каждым ребром а потом тупо проверить в полученной
сети существует ли максимальный то есть поток который насыщает прям все торчащий из вас то есть
да да нет нет потому что очевидно что потоки в этой сети циркуляции между собой связаны
то есть вот такой стандартный чего
ну да но по сути да
ну может так да
так что это вот задача это вот тоже задача про циркуляцию такая задача да классическая
а ну да вы еще сюда как-то да ну ладно вам-то тоже надо дать какой-нибудь контест потому что
потому что появилась она в культовом контесте называется эндрюс танкевич
contest one да который дан был зимой там зимой 2002 года в петрозаводстве
ну тем что он первый нет это это прям первый контест и там на самом деле уже многие задачи
там стали классикой именно там скажем впервые появилась знаменитая задача а значит симпатичных
узорах 6 на 10 сотый да да нет нет а тогда это была относительно новинка вы знаете потому что
там смотрите там где потому что задача просто симпатичных узорах появилась по моему но в кашпе
2000 года да тогда еще дпп профиль не являлась стандартной лекцией называется абсолютно там
всех курсов поэтому поэтому соответственно решила там ту задачу только одна команда там по моему
команда 57 школы в голове с петром митричевым вот соответственно вот причем более того эта
команда выиграла в космос отрывом там решився им задачи пристали ближайшие пристельцы решил
5 тогда тогда хорошее время на были на контест 8 задачи давали нет под
прекрасно заходит не не все заходит
нет какие какие это который n на м 400 а это сейчас на камеру сказал секретную разработку да
а ну да все равно даты без микрофона типа да ну хорошо хорошо ну вот ну да ой не ну
левосухи ладно это интересная задача которая да будет будет интересно посмотреть по решать
да пишите да пишите почитапу решаем собственно да это я видимо от лица от лица всего перка
вот так вот ладно с этим разобрались да это вот то есть такое маленькое ответвление но вот как бы
оно есть как бы тоже тоже лайфхак чек которого знает который знать надо сейчас я расскажу еще
один лайфхак чек которого знать на который знать надо потому что как бы задача тоже боянистая
в принципе вы cpс и уже встречались задачи которые на ней базируется это знаменитая задача а под
наибольшей плотности постановка задачи казалось бы вообще не предвещает никаких потоков ну как-то
часто бывает задачах на разрез то есть дан граф 100 тысяч вершин там пещеры какой-нибудь
ну да например ну кстати граф может быть забирать вперед и взвешенный в общем-то но
допустим в оригинальной постановке он был не взвешенный нет это я рисую планарность планарность
никто не требует так что нет мечтать о том что там ребер будет не более чем там 350 не получится
нет я сказал 100 вершин я сто тысяч сказал не не боже упаси нет 100 вершин тысячи ребер вот
что я сказал да вот так вот задача я хочу выбрать под граф
вот где модуль е штрих делить на модуль в штрих максимально возможно это вот допустим я выбрал
под граф в штрих е штрих вот ну да как я сказал ребра могут быть так вроде да максимальный не
минимальный да максимальный нет просто какой-то подножство связанности никто не требует
ну в принципе да ну да если вы взяли две компоненты связанности то выгодно взять
одну более плотную из них и тем самым не уменьшить плотность это конечно да это верное утверждение
но оно но как как всегда как-то часто бывает правильному решению это знание не поможет
но тут действительно такое решение конечно такое накрученное потому что начнем из того что мы
будем решать задачу бинарным поиском по ответу и мы будем решать такую задачу дано число
существует ли под граф у которого е штрих делить на в штрих строго больше чем ц вот не больше
либо равно именно больше ну значит смотрите и так вот значит делаем бин поиск в будущем
домножим и симпатику на логарифом ну кстати не так страшно потому что заметим что в общем-то
количество чисел которые у вас тут могут быть оно ограничено да то есть сколько там ну по суку
по сути там в квадрат чисел там у вас получается ладно нет ладно модуль е умножить на модуль
в знаменателе но самое главное что еще и знаменатели приятные поэтому в принципе вы можете найти
ответ абсолютно точно бинар по умолчанию да но в принципе вы могли бы сказать что
разных знаменателей бывает от одного до модуль в не такая уж и произвольность не скажи ты знаешь
если вы у тебя до сотки то у тебя различные два соседних числа это из такого что различаются ну
там на сколько там хотя бы на одну десяти тысячную так что нормально ну тем более что
существуют варианты как делать бин поиск чисто в рациональных числах давайте там дерево
штерна брока там кэша логарифом такой там будет лог квадрат конечно превращаться но но жить
можно вот ну ладно не будем сейчас в это копать хотя в какой-то момент может покопать интересно
действительно класс так сейчас не надо это обсуждать это замечательная вещь я вам просто
я вам скажу вот просто нагугление вот есть такая вещь дерево штерна брока просто отпаднейшая
штука там вы получите удовольствие на самом деле но вот вот но соответственно ось и тут как бы
нас сейчас не начали выгонять так это правда последние времена обычно не выгоняют поэтому
да ну можно но просто вот сегодня так у лады нет ну ладно его можно сказать конечно и в другой
раз но просто просто жалко он сегодня ложится потому что логика у него там очень простая она
так что не не знаю даже по возможности даже перенесся в другую аудиторию потому что вот как
бы потому что дело в том что мы сегодня обсудили и ее и потенциала джонсона поэтому минкос сейчас
вот алисиоги обсуждать прямо так что ладно так вот но пока хорлайф значит как вот это делать
но во первых начнем с того что это эквалентно тому что e штрих больше чем c модуль в штрих
нет или еще или еще круче нет но на самом деле у нас работает вот такое представление
потому что сейчас мы сделаем неожиданный лайфхак мы сейчас нарисуем сеть с отрицательными
ребрами будем не искать отрицательный разрез да давайте сразу себе представим вам может
показаться что отрицательные ребра это для потока фуфуфу и на первый взгляд это действительно так
потому что вот мы сейчас доказательств и форда фоллскер сона явно пользовались тем что у нас
способности не отрицательные да что значит ну то и значит то есть это означает что когда мы
делаем какой-нибудь разрез не но там навод это во первых это вводит какое-то требование что типа
поток в эту сторону обязан течь но вот но но вот но это общество но это как бы странно мы сейчас как
бы на эту странность будем смотреть по-другому мы считать что да это запрещено но но но фишка
так и такая предположим что у нас отрицательные ребра вот все отрицательные
ребра они связаны с истоком и cm ну то есть допустим у нас отрицательные все отрицательные
ребра ибо идут из истока в вершину либо из вершины в стол确 какие-то вот такие то есть либо вот так
либо вот так тогда у меня есть неожиданный н-д допустим тут минус 5
тогда у меня возникает неожиданный лайфхак вот перья вот в этой ситуации я скажу
следующее давайте-ка я убью это ребро вместо этого проведу из у ребро
пропускной способности 5
100
заметим что пропускные способности всех разрезов увеличились ровно на 5 от
этого правда логично да ну если у было слева то есть в эсе то было 0 стало 5
если у было здесь то было минус 5 стало 0 то есть просто плюс 5 ну понятно здесь
то же самое если тут было 7 то значит убиваем и получается и тут от сдв рисуем
7 ну тут минус 7 смысл да а тут ничего не рисуем то есть и получает витя то есть
если у нас ребра ведут из вершин сток отрицательные или из стока в отрицательные
то это не проблема для нас то есть такое мы себе разрешаем как же как же мы это
будем разрешать вот вот кстати вот действительно в эту сторону будем
разрешать или в другую но точно смотрите о чем вообще речь вот нам хочется чтобы
пропускать то есть допустим мы опять хотим чтобы у нас был разрез и у нас как
всегда в доле с было то что мы взяли множество а в доле тут не взяли и тут как
бы как всегда тут доля t там доля с к чему же тогда это нас приводит вот
нам очень хочется изобрести такую сеть что пропустая способность была вот такая
да ну во первых до логично конечно что из каждой вершины нам конечно из каждой взятой вершины
мы конечно проводим ребро пропускной способности какой да ровно ц вот а теперь нам надо научиться
конечно сделать так чтобы какой-нибудь ребро чтобы каждый ребро есть трех которая оказалась
вот в этой доле неожиданно вычитал идейку но на самом деле это я здесь возьму по-другому
что такое ребра но вот вот чего еще раз чем она поможет сделать то можно хоть 3 хоть 5 хоть 10
как бы ну то есть нет ну просто можно что да е штрих это все ребра которые оказались с
этой стороны мы конечно могли бы сказать что это просто написать минус е плюс все
ребра которые здесь не оказались но тогда у нас вот эти ребра придется как-то учитывать
поэтому логика на самом деле такая вот да да да то есть на самом деле для да вот то есть
хочется сделать так чтобы если мы хотим как бы учесть все ребра ну сделаем так во первых конечно
же если у нас вот тут тут надо аккуратнее правда то есть если мы видим что есть какое-то ребро то
мы как бы его добавим в обе стороны пропустой способности один чтобы он учитывал и да пока
но но на самом деле смотрите мысли будем так с от ве штрих вот минот но вот минус значит количество
связанных вот давайте так вот тут тут будет не вален вот связанных с ве штрих ребер вот в
идеале хотелось бы да плюс но вот но вот плюс количество ребер вот из этого разреза то есть
типа ст вот эти это должно быть меньше нуля да то есть вот это вот тогда получается в точности вот
это вот все эти ребра так учтены ну да вот именно сда но тут действительно да именно именно получается
степень пополам то есть это получается с модуль ве штрих ну хотя вот но количество связанных то
смотрите тут но тут потому что заметим что если просто суммировать степени да то есть как-то
нет можно в принципе и так да но это если бы на и мы адекватно учитывали связаны но заметим
что если суммировать там степени всех этих решим то каждый ребро внутри мы учтем по два
раза а каждый вот это ребро по одному вот поэтому на самом деле оказывается удобно написать так то
есть на самом деле прежде чем вот учитывать вот эту вот штуку оказывается может быть удобно это все
ну то есть можно было бы действительно сказать что там то есть давайте все распополамим
нет раз пополамим нет ну сейчас нет надо просто аккуратно понять потому что тут действительно
ну вот нет как учить но нет но как учесть вот это количество связанных в штрих ребер то
всех надо учитывать так чтобы они учились по одному разу но правда если все поделим пополам то
как бы вот эти будут учитываться как бы эти тоже поделить пополам а в чем тогда разница нет
просто нет они учат не но там просто все это вот надо аккуратно надо делать так чтобы
было общим случаем но при этом чтобы как бы там мы там как бы в сумме как бы да в сумме степеней
все учитывается два раза так то есть как бы и получается так что если мы если я бы тут
написал просто какую-нибудь там сумму действительно в лежит в штрих и дегат в штрих то как бы но вот
то тогда получил что каждый ребро из разреза училась один раз а каждый ребро здесь не из
разреза училась два раза вот спрашивается как это как этого избежать но вот но то есть опять
это вот это вот и это должно быть меньше нуля но это вот вот да но это не но я утверждаю что это
не но это не эквивалентно все вот это все вот это
то есть мы вот вот эта сумма мы это мы каждое ребро из е штрих они не есть но вот последние
просто два можно греть на ребер его левой части давайте поделим ну да то есть нет наоборот вот
это надо пополам поделить то есть взяли сумму выкинули эти то есть вот так вот так вот взяли
тоже это в скобку еще пополам поделим во вот так да но это эквивалентно тому что
действительно получалось 20 модуль в штрих минус значит сумма дегат в штрих там где готовы где
вы лежит в штрих плюс количество ребер пересекающих разрез оказалось меньше нуля но тогда
действительно оказывается ну вот то есть вот такой кайфец то есть на самом деле оказывается что
у каждой вершины взятой пропускная способность должна быть получается не ц а какой получается на
самом деле не ц а 20 минус дег от в да какие-то ребра получится отрицательными какие-то положительными
да парадокс парадокс том что из эса ребер не проводим вообще а вот так но а это компенсируется
тем что у тебя тут некоторые будут отрицательные и это означает что в итоге они пойдут и потом
будет нормально и потом мы ищем то есть да и потом фишка то ведь и в чем из этого следует что в этой
сети всегда есть поток величины 0 то есть его разрез величины 0 вот такой потому что из эса ребер нет
напоминаю да но нас же интересует а если меньше а потому что потому что меньше либо равно существует
всегда потому что есть ну а потому что дело в том что это разбиение соответствует тому что мы в
нашем множестве не взяли ничего да то есть в бенпольске как бы это утверждение будет верно
всегда при там допустим если тут 0 0 но теперь что но нам хочется взять чтобы было что-то не
тривиальное поэтому мы собственно и строгость тут и берем то есть вот такая красота то есть
принципе в оригинале рекомендуется на самом деле просто там проводит на самом деле тут проводить
что-нибудь типа там плюс двое допустим и тут провести сразу двое вот такая вот красота но
всем точка получается логарифом на за сколько вы там этот поток ищите ну вот то есть вот оказывается
да при тех на то есть вот то есть третий то есть техника крещет это мелкая техника тут конечно
такая не самое тривиальное но работает также потому что потому что оно заведомо делает ну
потому что если каждым если вы каждой вершине тут нарисовали двое и тут рисовали двое у вас
просто любую все разрезы увеличились на двое поэтому опять поэтому что чего где
разрез да да да да да да ну вот поэтому то есть там получится просто существует ли разрез у
которой пропсуальная способность меньше чем 2 е там 22 е в вот то есть там но получится такой
вот поток то есть там конечно в зависимости от того какой конкретно более того если вы там не
если вы используете какие-нибудь правильные алгоритмы потока и правильную технологию то можно
даже там от логарифма избавиться но конечно это это мы сейчас обсуждать конечно не готовы
для этого нужно изучить сами алгоритмы но вот но тем не но то пока вот на текущий момент вот
еще одна задача которая легко сводится к мин разрезу но она уже становится такой вот не тривиальный
да так сдвинулась куда-то так что вот так ну чего так есть ли тут какие-то вопросы так
ну ладно очень надел ну ладно если минкост убрать тогда очень пока прибрать учета очень
надеюсь что нам там каких-нибудь лишних лекций нет просто действительно подсчет такой что
допустим 15 числа у нас лекции не будет тогда допустим 22 но то 20 тогда у нас значит остаются
какие занятия 22 29 6 нет стоп ну да правильно 6 ну дай бог чтобы шестого были не выходные
шестого тринадцатого а 13 уже зачетная неделя а ну так так слушайте ну за 4 занятия мы потоки
покрыть должны но учитывая что каждый день по три пары ну как бы да у меня там не такое
количество теории нету то есть нет оно там приличное количество нету обычно это где-то месяц и
занимает так что нормально но а у нас сейчас что он а в смысле ну это да да да ну хорошо
ладно значит минкост значит минкост когда-нибудь следующие разы да ну хорошо
