Ну что ж, в прошлый раз мы начали изучать диаметрию и остановились на доказательстве мистического факта о том, как проверить, является ли угольник выпуклым.
Да, на поверх показалось, что доказательство этого факта не так просто, как кажется.
Но, тем не менее, сегодня мы попробуем...
Да, но сегодня у нас, наверное, будет попроще, настолько мы так глубоко...
Ну, то есть доказывать мы тоже будем, но как-то, наверное, совсем уж так глубоко копать там во все теории жардана и прочее нам не потребуется.
Так. Ну что, так, с чего бы из этого начать?
Так.
Ну, впрочем, ладно.
Ну, давайте вот тогда с чего начнем.
Ну, конечно, неплохо было бы, конечно, для начала хотя бы упомянуть о площади.
Да, но, правда, тогда возникает вопрос, а что такое площадь?
А что такое веро жардана?
Да, вот это, конечно, проблема, да.
То есть, можно хотя бы на более плюс-минус школьном уровне это, конечно, говорить, что что такое площадь вообще фигуры, да?
То есть, это такая целая... То есть, это такая там не отрицательная какая-то функция.
Может быть, даже положили там какая-то...
У которой там есть... Выполняются какие-то мистические свойства.
Какие у нее мистические свойства есть?
Может быть, сигнализация.
Ну да, что, во-первых, действительно, если у нас действительно А1 и А2 не пересекаются,
ну или они там только соприкасаются условно, да?
Вот так вот скажем. Внутренность.
Как там внутренность обозначается?
А, ИБН.
То есть, если вот внутренностями они там что-то не пересекаются, то тогда у нас площадь их объединения это типа сумма их площадей.
Была такая, но это так на уровне воспоминаний, да.
Так, что там еще?
А, еще, конечно, если фигуры равны как фигуры на плоскости, то из этого следует, что, конечно, их площади равны.
Так, и что нам еще не хватает?
Ну и заявить, конечно, что площадь квадрата со стороной А1...
... равно, соответственно, А2.
Ну, могли бы нарисовать 5, это, в общем-то, там, практически, в чем измерять, в сантиметрах или килограммах?
Вот, суть одна.
Вот, да. То есть, можно было бы хотя бы на таком уровне объявлять площадь.
И, в общем-то, для площади многоугольника, в общем-то, такого определения даже хватит.
Почему?
Ну, просто потому что, как минимум, действительно, улюблено.
Ну, хотя как хватит. На самом деле, не хватит.
Потому что непонятно будет, конечно, как вывести площадь прямоугольника со сторонами корень из трех на корень из двух.
Вот как из этого вывести?
Вот почему-то у меня жуткое ощущение, что из таких и все, как-то, видимо, не увидишь.
Вот.
То есть, нужно что-то еще.
Вот. Но, пожалуй, да.
Вот. Ну, пожалуй, действительно, наверное, копать уже совсем в определении, наверное, там, ягоджарданами, наверное, все-таки не будем.
А то там, действительно, эти пределы какие-то там и так далее.
Вот. Ладно, вместо этого отчета мы все-таки подумаем. Как там, все-таки, программистскими методами найти площадь многоугольника?
Вот.
Как ты это вообще сделал?
Ну, самое простое, что можно было бы, как вы видите, делать.
Это давайте попробуем так.
Ну, во-первых, давайте вот с чего начнем.
Как найти площадь прямоугольника?
Как найти площадь прямоугольника?
Векторное произведение.
Ну да. То есть, так и сказать, что это одна вторая векторного произведения.
Векторное произведение АВ на АС.
Тогда очень модно.
Да. Но, правда, соговорка, что модно.
Да, действительно. Потому что никто не сказал, что действительно АС относительно АВ это вот именно слева находится.
Да. Формально говоря.
Вот.
Но, с другой стороны, часто вводится еще понятие, конечно, ориентированная площадь.
И тогда сказать, что ориентированная площадь треугольника АВС, она будет равна все-таки векторному произведению без модуля.
То есть, в чем интересно?
Нам жутко интересно.
Но нам, условно говоря, жутко было бы интересно, чтобы, если у нас вершины идут в порядке против часовой стрелки, то тогда у нас площадь положительная.
Ну вот. А если по часовой стрелке, то отрицательная.
Вот что можно было бы...
Ну вот, иногда хотелось бы.
Действительно, ориентированную площадь будете искать вверх.
Ну, потому что, значит, следующий уровень. Следующий уровень говорит нам, а давайте как...
Попробуем другой черной макер.
И попробуем найти площадь выголовного.
Вот, давайте.
А0, А1, А2, А3 и так далее.
Вот.
Вот.
Тогда если вершины заданы против часовой стрелки, то площадь вообще очень легко найти.
Площадь и площадь ориентирована.
Соответственно.
И тогда она у нас к чему равна?
Просто сумме всех векторных произведений.
Вот.
Вот какая-то вот такая сумма получается.
Ну, допустим, вот.
Вот.
Ладно, давайте вот так вот сделаем, чтобы красиво было.
Значит, вектор, например, А0 на А. Соответственно, и минус первая.
А0, А1.
Ну, то есть, в переводе говоря, мы просто разбили вот на такие три угольники.
И у каждого три угольника взяли площадь.
Вот получилась такая красота, в том числе ориентированная.
Ладно.
Но, на самом деле, я тут сидел путался, называйте.
Что мне тут писать? 2, 1, 0 или что?
Но, на самом деле, обнаружим маленький интересный факт.
На самом деле, если я тут вместо 2 и тебе напишу 0, ничего не поменится.
Ну, ладно.
Как ничего не поменяется?
Поменяется только по модулю того, что у нас тут окажется А-1.
Но тут мы включим режим питанистов и скажем, что все в порядке.
Типа.
Вот.
И заметьте, в общем-то, ничего не поменяется особо.
Ну, то есть, просто мы добавим два векторных произведения, которые равны 0.
Так что добавляй и не добавляй, результат одинак.
Еще одна вторая.
Что?
Одну вторую забыли.
Да.
Ай-ай-ай.
Одну вторую забыли.
Да.
Ну, вот.
Ну, и здесь мы тут взяли 0.
Ну, вот.
Но с другой стороны, оказывается, что эта формула, в общем-то, не зацеплена за то, чтобы все вектора проводились из 0.
Потому что, вот, оказывается, такой мистический факт.
Что если бы вместо этого я взял бы какую-нибудь точку, давайте назовем ее O.
И у меня тут было бы A0, A1, A2, A3, A4 и так далее, AN-1.
То я все равно мог бы сказать, что S ориентированная равно 1 вторая, сумме по I равно от 0 до N-1, O I-1, O I.
Понимаете, да?
Действительно.
Вот.
Вот.
Действительно.
Да, на такой картинке это получается достаточно наглядно.
Да, но напоминаю, что, конечно, нам очень важно, да, то есть нам важно, что в многоугольник решины идут именно против часовой стрелки.
То есть, напоминаю, что означает против часовой стрелки?
Это означает, что когда вы двигаетесь по границе многоугольника, то у вас, как бы, фигура остается слева.
Ну, как бы, пока для мывшего многоугольника это вроде достаточно наглядно и понятно.
Вот.
Ну, а теперь мы такой, хорошо.
То есть, оказывается, если точка O окажется одной из вершин или внутри многоугольника, то, как ни странно, площадь находится.
Но, оказывается, еще будет, ну, вот, верен еще более мистический факт.
А если я возьму эту точку вне многоугольника, что будет?
Тоже самое.
Тоже самое?
Да ладно.
Как это?
Это какие-то векторные произведения, это что, константа, что ли?
Вот.
Да, вот если взять точку O вне.
Но, действительно, оказывается, что если мы прогуляемся, ну, допустим, начиная с этой точки, ну, там, неважно, какой у нас тут сумма так встроена, что неважно с какой прогуливаться.
То, действительно, мы тут сначала на прибавляем, то есть прибавим к ответу площади вот этих вот треугольников.
То есть площадью, то есть как бы все вот это прибавляет, то есть прибавляет площадь, то есть в ответ сейчас с плюсом войдет площадь всего этого многоугольника, а также вот эти фигурки.
Ну, ничего страшного, когда мы пойдем в другую сторону, мы обнаружим, что вот эти вот треугольники сейчас торжественно повыкидываются.
Ведь, обратите внимание, мы суммируем площади ориентированных треугольников, они будут входить не со знаком O.
Вот.
Да.
Так что получается такая красота.
Вот.
Вот, оказывается, такой мистический факт, что, действительно, для выпуклого многоугольника, оказывается, получается, площадь равна вот такой величине.
Причем более того, точку O можно выбрать буквально где угодно, от этого эта величина не поменяется от слова никак.
Причем очевидно, ну, достаточно очевидно, что если многоугольник идет против часовой стрелки, то это реально будет площадь со знаком плюс, ну а если будет по часовой стрелке, то будет площадь со знаком минус, очевидно.
Вот такой интересный факт.
Ну, более интересный факт.
Заключается в том, что, оказывается, что для не выпуклого многоугольника это тоже верно.
Оказывается.
Спрашивается, почему?
Ну, наиболее простым способом это доказать будет так.
Ну, начнем с того, что рассмотрим вот такую функцию.
Вот давайте так, давайте себе представим, что у нас есть очень-очень-очень невыпуклый многоугольник.
Ну, вот совсем не выпуклый, вот такая вот гадость там вот бывает.
Зачем я его рисую?
Вот такой многоугольник.
Назовем его многоугольник А.
Ну, у него там А0, А1 и так далее.
Правда, ладно, стоит оговориться сразу.
А вот для него даже уже интуитивно не так очевидно, а что такое для него обход против часовой стрелки вообще?
Вот как бы да. То есть как бы нет такой вот стрелки, потому что, да, если тут даже эту стрелку там в центр где-нибудь поставить, то...
То как бы да, то есть как бы стрелка будет сходить как-то вот так вот.
И не говоря уже о том, что тут я еще пока не знаю, это точка вообще внутри лежит многоугольника или вне?
Нет, ну если мы знаем что внутри, то понятно, что такое против часовой стрелки.
То же самое, что слева...
А что такое?
Ну, то что если мы проходим по стороне, то слева от нее...
Да, но вот для этого точка внутри не нужна.
Ну, тогда можно просто сказать, что когда идем многоугольник, то как бы многоугольник остается слева.
Правда, здесь единственное, то есть на что хочется обратить внимание, да?
Что вот, например, мы идем вот по этой стороне, да?
И вот что такое многоугольник слева?
Потому что раньше можно, то что, например, если я тут просто приведу прямую, и с одной полуплоскости многоугольника.
Но мы говорим здесь, имеем в виду следующее, что мы помним, что каждое ребро это граница, да?
И как бы, ну вот, и оно граница, то есть это означает...
Ну вот, и если взять любую точку внутри ребра, не на вершине,
ну вот, то если взять достаточно маленькую окрестность, то мы знаем, что в этой окрестности тогда будет вот этот вот отрезок этой границы.
И тогда с одной стороны все точки будут внутри многоугольника, а с другой вовне.
Это мы в прошлый раз активно обсуждали.
Так что там кто-то вот на видео записал.
Вот, конечно.
Вот, это мы помним.
И вот мы говорим, что обход у нас против часовой стрелки, если это окажется слева.
То есть когда мы идем, то вот как бы то, что внутри идет слева, но имейте в виду именно в локальной окрестности.
Вот.
Так, ну а теперь давайте введем.
Вот у нас есть обход против часовой стрелки такой, и мы можем вести мистическую функцию.
Давайте скажем, f от альфа равно, вот просто сумма по i равно от нуля до n минус один.
Там.
Точнее так, f с индексом альфа от точки о, вот это будет называться.
О.
Не-не-не-не, это, нет, смотрите, нет, именно она от о.
Почему?
Значит просто введем вот эту мистическую функцию, которая должна оказаться равна удвоенной площади.
Вот мы хотим доказать, что это удвоенная площадь этого многоугольника.
У нас там две квадратные скорости.
Ой, как вы говорите, от описки.
Вот, только из-за этого.
Вот, такая красота.
Вот как мы это будем доказывать?
Ну честно, доказывать можно, конечно, брать первую попавшуюся точку, но честно скажу, мне будет удобно рассматривать случаи, когда точка о находится вне многоугольника.
И не просто вне многоугольника, а желательно, ну вот, а желательно там подальше относительно, ну хотя бы интуитивно.
Вот.
Поэтому мне будет просто начать доказать, что будет удобно с того, что просто эта функция на самом деле от точки о не зависит от слова никак.
Понятно, да?
Как же мы это будем делать?
Ну элементарно.
Давайте рассмотрим две абсолютно произвольные точки, о и о штрих.
И, скажем, что вот, и рассмотрим вот f от o штрих минус f. Докажем, что это ноль.
Ну как мы это докажем? Давайте просто порасписываем.
Значит, рассуммируем, собственно, вектор произведения o штрих a и минус 1 o штрих a it минус o a и минус 1 o a it.
Вот.
Вот.
Вот.
Так, ну вот, замечательно.
Ну замечаем, что, ну вот, что можно заметить?
Можно заметить, что o штрих, там, допустим, a it это равно o штрих o плюс o a it.
Ну как-то так, да?
Что это значит?
Вот тогда, в принципе, можно это так и расписать.
Что, действительно, o штрих o плюс o a и минус первое, запятая там.
И здесь o штрих o плюс o a it.
Вот.
Ну и, соответственно, еще минус o a и минус первое o a it.
Так, замечательно, замечательно.
Так, ну теперь можно попробовать по линейности расписать вот эту штуку, правда?
Что получится?
Ну если вот по линейности раскрыть, то получится следующее.
Сначала получится сумма o штрих o на o штрих o, ну которая, в общем-то, шлеп-шлеп сама на себя.
Потому что это каждый вектор произведения равно 0, правда?
Плюс сумма по i равно 0 от n минус 1, значит, векторного произведения o a и минус первое на o штрих o.
Плюс сумма по i от 0 и n минус 1 получается o штрих o на o a it.
И мы, кстати, сразу обнаруживаем, что здесь уже шлеп-шлеп.
Ну, внезапно?
Внезапно.
Внезапно, да?
Ну, на самом деле, нет.
Потому что мы можем обнаружить, что, ну, во-первых, заметим, что вот это, вот это тоже самое, что o a it на o штрих o создано минус, правда?
То есть мы могли бы сказать, что это на самом деле равно минус, вот, похожая сумма, тут не o a и минус первое, а o a it.
Ну, напоминаю, индексация у нас идет по циклу, поэтому по факту это как бы дети швагают.
Вот.
Поэтому плюс, ну и что нам остается?
Здесь нам остается, значит, сумма, соответственно, o a и минус первое o a it, и нам тут говорят, минус o a и минус первое o a it.
Ну, все.
Все.
Это совсем шлеп, шлеп, это боль.
Вот.
То есть получается такое, просто чисто алгебрическая доказательство такое.
Вот.
Ну, в принципе, ничего удивительного.
Ну, вот.
То есть, в общем-то, да.
Здесь уже можно было, здесь можно было даже вовне на самом деле многоугольника это даже не смотреть.
Почему? Потому что на самом деле можно заметить, что эта функция явно линейна по координатам x и y.
С одной стороны, да.
А с другой стороны, что это за линейная функция, которая на какой-то не нулевой площади равна одной и той же величине.
Наверное, только константа может быть такой красивой линейной функцией.
Поэтому без вариантов.
Так.
Ну, вот. Ну, и здесь оказалось, что действительно выпуклость тут вообще ни при чем.
То есть, просто это функция константа.
Осталось только выяснить какое отношение эта функция имеет к площади.
Ну, для этого мы сделаем вот что.
Так, ну давайте тут я многоугольник попроще, наверное, нарисую.
Ну, хотя бы вот такой там.
Ладно, вот такой пойдет.
И вот давайте.
Что мы сделаем? Давайте вот возьмем какую-нибудь точку.
О, где-нибудь вот там.
Подальше.
Ну, что такое подальше?
Подальше мы возьмем точку в том плане, что, допустим, у нас будет, ну давайте для красоты, действительно, у нас весь многоугольник будет лежать в каком-то угле меньше 180 градусов.
Вот.
И так.
И дальше мы сделаем следующее.
То есть, давайте мысленно вот попробуем попроводить, действительно, вот, попроводить, скажем, все лучи вот через все вершины.
Тут даже вот так легло, ну допустим.
Так, тут еще вот.
Ну, давайте еще вот так вот.
Так вот.
Вот так вот, вот так вот, ну и так далее.
Вот.
И тогда давайте просто смотреть.
То есть, как это все будет выглядеть.
То есть, если идти так проще, что стрелка начинается, скажем, вот отсюда, то что мы будем видеть?
Ну, вот, то, на самом деле, в каждом угле, таком, внутри каждого угла мы будем видеть примерно следующую картину.
Значит, какие площади будут заметаться.
Ну, заметим, да, что если у нас тут вот есть несколько углов таких, да, и у нас там, скажем, какое-то ребро идет слева направо, то мы заметаем вот все вот эти треугольники.
Видим, да, причем полностью.
Понимаете, да?
Вот.
И теперь давайте посмотрим, какие треугольники.
Вот если у нас есть маленький вот один из этих уголочков, да, то как многоугольник работает с ними?
Ну, заметим, что все ребра, которые у нас вообще пересекают этот угол, они обязательно пересекают его целиком.
Ну, там понятно, могут быть, конечно, всякие вот такие ситуации там, конечно, да, но это уже локальность.
Вот.
Да, то есть мы специально выбрали угол, что тут внутри вершин нет.
Ну, что тогда можно сказать?
Ну, заметим тогда следующее, что если мы движемся внутри этого угла как-нибудь вот так вот, да, вдоль какого-нибудь луча, то замечаем, что изначально мы находимся вне одного угодника,
а потом, потом пересекаем, соответственно, какой-то отрезок, начинаем, то есть вот так сказать, тут вот аут, а тут начинаем находиться внутри.
Видим, да?
Потом начинаем находиться снаружи, тут начинаем находиться внутри, тут находиться снаружи, тут внутри и наконец снаружи.
Ну, так как мы начинаем снаружи и заканчиваем снаружи, то видим, что у нас этих отрезочек должно быть четное число.
Понимаете, да?
Ну, а как учитывается площадь?
Заметим следующее, вот когда мы так идем, рассмотрим первый отрезок.
Рассмотрим первый отрезок, что мы видим?
Как, ну вот, то есть если говорить против часовой стрелки, то этот отрезок, то по этому отрезочку мы явно двигаемся вот таким образом,
чтобы многоугольник оказывался слева, правда?
Ну, чтобы он оказывался слева, тогда получается, что когда мы будем проходить по этому отрезочку, площадь вот этого треугольника учтется со знаком минус.
Теперь, следующий отрезок.
Следующий отрезок.
В чем, заметьте, он не обязан вот именно вот в обходе многоугольника как-то следующим, потому что реально там многоугольник может вот так вот сходить как-то, да?
Вот.
Но в следующем, в таком порядке отрезок он точно должен идти против часовой стрелки.
Вот. И тогда получается, что вот эти две части будут с плюсом и с минусом.
То есть на текущий момент оказывается, что вот эта вот часть учтена правильно, а вот этот треугольник взаимоуничтожился.
Будет тебе здорово.
Дальше будет так же.
То есть следующий тоже будет против часовой стрелки.
То есть получается тут минус, минус, минус.
Потом здесь будет соответственно плюс, плюс, плюс, плюс.
Ну и так далее.
Вот.
Ну, то есть можно тут еще подобавлять.
Там допустим плюс.
Вот допустим.
Там плюс, минус.
Тут тоже давайте.
Тут везде надо минус, плюс нарисовать.
Ну, в общем, и по факту оказывается действительно, что те части, которые внутри многоугольника учтены, причем ровно один раз с нужным знаком,
а те, кто вне, оказывается, они там и все, они там учитывались несколько раз с плюсами и с минусами, они все взаимоуничтожились.
То есть ровно отсюда и следует, что, в общем-то, это и есть то, что нам надо, но с точностью дакарифсента 1 и 2.
То есть вот так можно действительно доказать, что это у нас такая площадь.
Что площадь вот действительно так оказывается.
Можно, кажется, еще проще.
Как?
Ну, если мы умеем проводить диагональ в многоугольнике так, чтобы она жала целиком внутри, то просто по индукции.
Ну, в принципе, да.
Да, на самом деле, конечно, да.
То есть если говорить о том, как провести какое-нибудь простое доказательство, то можно было доказать, что, во-первых, это работает для треугольника,
а во-вторых, там каждый многоугольник, также, если внутри андунировать.
Ну, потому что заметим, что если мы многоугольник разобьем какой-нибудь диагональю на два, да, и посчитаем их сумму,
то мы обнаружим, что вот этот диагональ учтется там со знаком плюс, со знаком минус и взаимоуничтожится.
Можно и так.
О.
А можно еще спросить, как мы добились того, что у нас в этом убедении нету вершин?
А мы провели...
А мы просто провели лучи через все вершины и рассмотрели два соседних.
А, вообще.
Да, то есть мы вот это вот суммируем по всем вот углам.
Да, то есть мы вот аккуратно.
Вот.
Так что можно вот так.
Ну, можно треугольник, но там, правда, отдельно еще придется доказывать, что любой многоугольник можно разбить на треугольнике.
Ну, это не очень сложно.
Да.
Да, фактически, да, задача только там доказать, что можно привести нетриоральный диагональ, да.
Вот, хорошо?
Вот.
Но, действительно, площадь определение, причем более того в качестве добивки.
Потому что вот еще возникет такая задачка.
Вот, посspecific, данного угольника, скажите, пожалуйста, вершины заодно и в порядке против часовой стрелки или с��чь часовой стрелки?
Сморчемurchi.
Ну, считаем площадь, смотрим на знак.
Да, ну, вот, оказывается, что наоборот.
Можно посчитать площадь и посмотреть на знак.
Потому что мы обнаружим, что, да, если у нас против часовой стрелки, то площадь положительная, если, то отрицательная.
Получилось такое вот даже.
Но, конечно же, если мы знаем, что неговик выплыл, это, конечно, делается сильно проще не за отm, а за от единиц.
То есть, просто возьмите три первые побавшиеся точки, и смотрите на векторное произведение.
Но это только один способ поиска многоугольника.
Но здесь нельзя не упомянуть еще об одном. То есть, конечно, о методе трапеции.
Вот. Ну, нельзя не упомянуть, тем более, что вообще встречаются задачи, где нужно искать площадь именно вместо этого трапеции.
Таким образом будет больновато.
Вот так. То есть, по самом деле...
То есть, альтернативный момент такой. Давайте две простоты приположим.
Ну, в общем-то, не сильно будет ограничивать нас предположение о том, что многоугольник находится выше оси Х.
Ну, то есть, все единицы у него положили.
Ну, давайте вот так.
Вот как.
Тогда оказывается, что площадь этого многоугольника можно найти следующим образом.
Давайте тоже идти по многоугольнику.
И пытаться прибавлять к ответу площадь вот такой прямоугольной трапеции.
То есть, будем брать две вершины, проецировать их и прибавлять площадь.
Но при этом, если мы идем как бы вправо, то есть, Х увеличивается, то мы трапецию будем учитывать со знаком минус.
Вот это вот со знаком минус, это со знаком минус.
А вот если наоборот влево, то есть, Х уменьшается, то наоборот, давайте вот это все брать со знаком плюс.
И если вот все проекции рисовать, то получится вот примерно такая ситуация.
Вот так вот.
И тогда говорим, что если мы идем сюда, то значит, здесь везде минус, минус, минус, минус, минус, минус, минус, минус, минус.
Вот, да, и здесь наоборот получается, всякие плюсики.
То есть получается, да, тут плюсик, плюсик, плюсик, плюсик и, конечно, плюсик, плюсик, плюсик.
Вот, идем назад, тут получается, вот видите, минусики, минусики, минусики.
А, я тут еще плюсик забыл. Ну и так далее.
То есть, в общем-то, смысл буквально тот же.
Кстати, как найти площадь трапеции?
Ну то есть, если у нас есть вот, ну там, фактически в данном случае s будет равна, то есть, ориентированная.
То есть, сум одна вторая, соответственно, сумма по всем и от нуля до и минус один, чего?
Вот. Ну и здесь, соответственно, к чему равна у нас площадь трапеции?
Это высота этой трапеции на полусумму основания, правда?
Поэтому так и пишем. Ну, одну вторую мы уже вынесли, поэтому y и минус один плюс y и t умножить на какую-то разность x.
Ну, по идее, нужен модуль, но у нас ориентированность.
Поэтому, чтобы у нас это было со знаком минус, мы будем писать, что x и минус один минус x.
Вот, можно вот так написать.
Вот.
Ну то есть, на самом деле, можно обнаружить, что это на самом деле, в общем-то, на самом деле, вот эта формула от вот той формулы не сильно далеко ушли.
Не будто просто точку на бесконечную.
По сути, да. Ну, там и отсекать что-то там. Понятно.
Не за бесконечность, но суть более-менее одна.
Так что, полезно, помни действительно, что площадь можно найти из таких.
А если у нас есть такая формула, правда, что уже неважно, что все x и больше 0, что это могло вернуться?
Ну, на самом деле, неважно, да.
Ну, потому что здесь уже, ну, скажем так, да, здесь, ну, как сказать.
Ну, смотрите.
Да. То есть, ну, во-первых, да, по этой формуле очевидно, что многоугольник можно спокойно двигать влево-вправо, как минимум.
И ничего не поменяется.
Но возникнет только маленькая проблема, действительно.
А если, ну, вот, а если я сейчас все игроки, вот, как-то вот сдвинуть многоугольник вверх, не изменится ли эта формула?
Ну, очевидно, что нет.
Да. Ну, на самом деле, да. Очевидно, что нет. Почему?
Потому что площадь увеличится на какую-то константу там 2c умножить на сумму разности x, а сумма разности x позацикловой.
Поэтому на самом деле, да, в этой, то есть мы здесь чисто для удобства доказательства, так, просто визуального, сказали, что многоугольник выше оси x, хотя на самом деле эта формула работает всегда.
То есть поэтому, конечно, сдвигать никуда ничего не надо, да.
Вот такая у нас красивая формула.
Вот.
Так. Ну, что еще хочется делать с многоугольником?
Понятно, что внутри него точка.
Да. Ну да, многоугольник нашли. Следующая логичная идея.
Это теперь хочется, вот теперь нам вот этот многоугольник понадобится.
Потому что, вот, действительно, мы в нем тыкнули какую-то точку, где-то там вот, да.
Вот, я не знаю, давайте вот, где там нам ее тыкнут.
И вот возникнет естественный вопрос.
А если точка вообще находится вне многоугольника или внутри многоугольника, это наша следующая задача.
Вот возникает вопрос, она находится вне многоугольника или внутри?
Как же это вообще понять?
То есть иногда он на некоторых картинках, это даже он с лету просто визуально не очевидно.
А тут надо еще этот тупому компьютеру объяснить.
Вот.
Ну, конечно, первое, что можно, это, конечно, сначала прибежаться по многоугольнику и спросить,
а он случайно точечко не на границе, там, не на каком-нибудь отрезке лежит.
Но это легко проверить.
Допустим, выяснилось, что нет.
Тогда какая возникает идея?
Возникает идея.
А давайте приведем какой-нибудь луч.
Просто вот луч из этой точки.
И просто посмотрим, сколько раз он пересекает многоугольник.
И действительно, смотрите.
Вот, допустим, заметим, что каждый раз, когда луч проходит через сторону,
то состояние на тему того, внутри или вовне, строго меняется.
Правда?
В идеале, по крайней мере, так, что когда проходим, то есть она действительно меняется.
И нам просто нужно посчитать, сколько раз меняется.
Если поменялось два раза, значит состояние осталось тем же.
Ну вот, если вот в нашем случае поменялось пять раз и ушло вовне.
И ушло бесконечно.
И ушло бесконечно.
Ушло бесконечно, значит, вот здесь, на бесконечности, точки вне многоугольника, правда?
Значит, тогда получается, раз поменялось пять раз, значит, вот эта точка была внутри.
То есть отсюда получается, казалось бы, вот такой простой алгоритм,
действительно, как за линию, для каждой точки, за линию понять она внутри многоугольника или вовне.
Хотелось бы сказать.
Но есть один маленький неприятный нюанс.
Который заключается в том, что, а что делать, если этот лучик,
если мы там как-то построили этот луч, и он возьми и просадить через вершину?
А еще круче, через ребро, в целом.
Ну всякое бывает.
Ну вероятность нормального ответа будет высока, если так.
Не, ну да, в чем подлянка, да.
Что если она проходит через вершину, ну как бы, в данном случае мы это учтем,
что она проходит через два ребра, и получится неправильный ответ.
Потому что состояние не поменялось.
Два ребра из нее не по одну сторону ушли?
Да, но тут вот надо думать.
Потому что, если уж брать луч, какие там состояния бывают.
Да, бывает вот такая ситуация.
Да, бывает вот такая ситуация.
Ну типа в другую сторону.
Бывает вот такая.
А бывает вот такая.
Еще бывает вот.
А бывает вообще вот так.
Ну и вот так вообще.
Ладно, дай бог, чтобы я все случаи перебрал.
А, ну и вот просто так бывает.
Так, вроде все случаи перебрал, да?
Так, и с этим надо как-то разбираться.
Но как?
Ну, для вершинки, типа когда пара стороны добавляем один, иначе может быть новый.
Да, да, да.
Садиться, расписывать луч, и бояться, что какой-нибудь забыть.
Пытаемся что сделать?
Учить реальную задачу или олигарную задачу?
Прямо или избавляй свою проблему, если изначально координаты целые.
Без проблем с точностью.
Так, ну сейчас дойдем.
Сейчас мы будем перебирать кучу способов.
Да, это обладает пассивой, это мы тоже обязательно учитаем.
Да, но пока скажем глобально.
Да, сейчас мы рассмотрим несколько способов, как решать эту проблему.
В общем, делятся они глобально на два глобальных кластера.
Кластер первый.
Да, у нас действительно проблемы из-за того, что луч проходит через вершину.
Все, давайте, фу-фу-фу, это плохой случай, давайте просто будем избавляться этого случая, просто пытаться проводить правильные лучи.
Как это можно делать?
Ну, первый тупой случай, конечно, давайте будем проводить рандомный луч.
Потому что, если честно, выбирать направление луча как по углу от нуля до двух пи.
Вероятность ноль.
Да.
Да, в идеальном мире вероятность ноль.
Да, минус этого, да, то есть вероятность ноль.
Поэтому можно даже надежный алгоритм написать в духе, что провели луч, если вы все-таки попали в вершину, значит проведите еще луч.
И там доказать, что там от ожидания времени работы будет какое-нибудь там маленькое, ну ладно, от ожидания количества итерации.
Но есть минус, идеально любое действительное число мы выбрать не можем, у компьютера даблы ограничены.
То есть мы там нарвемся на какие-то проблемы с точностью, это не очень хорошо.
Правда, но о чем тут можно думать?
Ну, можно думать по-разному.
Можно, конечно, говорить о том, что, ну скажем, часто бывает, что если, допустим, многоугольник задан целыми координатами, чаще всего так и бывает, в общем-то не только в Олимпиадах.
Ну или там часто говорят, что задан с какой-то ограниченной точностью, типа там дано же какую-нибудь тысячу и получить целые числа.
И если, то есть они соответственно, многоугольник, это целая координата и точка тоже в целых координатах, то, конечно, можно считерить очень простым способом.
Можно сказать, что если точка x и y, то давайте проводить луч в точку очень-очень-очень большой x.
И игрок плюс один.
И игрок плюс один, да.
Да, совершенно верно.
Ну ладно, здесь маленькая оговорочка на самом деле.
Этот метод надежно будет, ну хотя, ну не совсем, он должен быть больше многоугольника и больше x.
Ну потому что если ты тут просто поставишь x, а у тебя точка была здесь, то пересечения будут, может быть, и с вершиной.
То есть мелкую оговорку придется сделать.
Ну, в принципе, да, обычно там не знаю.
То есть можно, в принципе, просто сказать, что как был.
У многоугольника есть bounding box, который у него лежит.
Если точка заведомого вне bounding box, так давайте за лапки единицы там выбросимся с криком «нет».
Вот.
А так соответственно проводим луч и обнаруживаем, что ни одна вершина не может попасть на этот луч, потому что точка у него лежит.
А так соответственно проводим луч и обнаруживаем, что ни одна вершина не может попасть на этот луч, потому что между этой точкой и этой точкой ни одной целой точки на отрезке нет.
Вот.
Остается только научиться проверять пересекаются ли отрезки в целых числах, но это мы уже с вами учились сделать в прошлый раз.
Вот.
Да.
То есть конкретно в ценах можно сделать так.
Ну бывает, проще сказать, что ты просто поставишься в этот код.
Правда, пограничный случай, да.
Мы рассмотрели случаи, когда у нас всё в целых числах и когда у нас наоборот существуют произвольные добы.
Но бывают ещё вежь другими случаи.
То есть, когда у нас всё абсолютно точно, но не в целых числах.
Да, ну вот такое.
Это уже... Вы приближаетесь к тому, чтобы я там это...
Сначала показывают, что у меня там...
Но самое простое что можно привести.
А давайте себе представим, что все X и Y лежат, например, в рациональных числах.
А в принципе этого уже достаточно.
Они могут лежать ещё...
Так.
Я думаю, после ОКТЩ вам знакомо вот это значение, да?
Ну, конечно.
Да.
Чего вы вздыхаете?
Что там, что-то больно было?
Нет, не больно.
В этих числах решать было у вас самое лучшее, что можно ещё раз сказать.
Да.
Ну да, да. Ну не знаю.
Самое лучшее это в каких-то...
А как-то ещё от комплексных корней в седьмой степени за единицы.
Ну ладно, не важно.
Значит, смотрите.
То есть, здесь у нас мы обнаружим, что просто целые числа были приятны тем, что как бы у каждого числа есть следующее.
То есть, мы там тыкаем какое-то следующее число, и между ними ни одного целого нет.
Мы вот этим жёстко воспользовались, да?
Ну вот, скажем, уже в рациональных числах такого не получится.
Потому что между любыми двумя различными рациональными числами существует рациональное число.
Что ж делать?
Вот что делать в этом случае?
Ну и здесь идея, оказывается, тоже, в общем-то, не сильно сложная.
Ну, по крайней мере, одна есть.
То есть, тут, как всегда, можно придумать, видимо, 10 идей.
Слушайте, один стоит.
Вот.
Ну, как-нибудь вот так.
То есть, идея, в общем-то, такая.
Берём какую-нибудь точку.
И проводим, ну, допустим, горизонтальный луч.
Видите, да?
Ну, первое, что мы замечаем.
Если окажется, что выше этой точки ни одной, то есть, выше этой точки никакой вершины на гугольке нет, значит, мы просто пишем out.
Ну ладно, не out.
Там, на самом деле, первое, что мы делаем, это проверяем или лежит ли точка на границе, конечно же, да?
Ну, а если она точно либо внутри, либо вовне, значит, проверяем.
Если точка прямо заведомо окажется выше всех вершин, значит, до свидания.
Если не выше, то что делать?
Ну, если она оказалась, ну, вот, то дальше можно сделать следующее.
Ну, во-первых, если она оказалась выше или она оказалась правее, то тоже fail.
А в противном случае давайте рассмотрим все точки выше, допустим, да?
И вот проведем все вот эти лучи и выберем из них самый низкий.
Ну, просто по векторам мы произведение будем выбирать.
Понимаете, да?
То есть, как бы все лучи, которые смотрят вот в верхнюю полуплоскость, их можно сравнивать по векторам произведения, да?
Ну, в нашем случае мы будем говорить, кто правее.
Вот и будем это делать.
Ну, тогда идея такая.
Вот мы нашли самый правый луч, да?
Вот он.
Вот он самый правый луч, вот горизонтальный.
Ну, тогда идея такая.
А теперь давайте просто возьмем какой-нибудь луч между ними.
Как найти какой-нибудь луч между ними?
Ну, вот.
Ну, да, можно, да.
Первое, конечно, можно приходить в голову без секресса, но там начнутся деления в скроте.
А на самом деле самое тупое это действительно.
То есть на пополам, ну, можно просто взять в середину этих точек и провести луч через нее.
Или что то же самое, на самом деле, просто эти два вектора сложить.
Но это одно и то же на самом деле.
Кстати, в целых числах этот метод тоже применим.
Особенно если вы тут на 2,9 не будете.
А просто вот сложите эти два вектора.
То есть вот, например, так можно выкручиваться.
То есть вот, например, так можно выкручиваться.
Так, потому что что еще можно делать?
Ну, на самом деле там выкручиваться можно по-разному.
Можно еще говорить так.
Так, а давайте будем всегда проводить горизонтальный луч вправо.
Как говорится, какие у нас проблемы?
А, что на этом горизонтальном луче могут оказаться точки?
Так, а давайте, вот еще есть вариант.
А давайте применим такое финное преобразование.
Вот такое финное преобразование, чтоб заведомо на одной горизонтальной с ней никаких точек не лежало.
Ну там как-нибудь вот просто вместо вот этого базиса, типа, возьмем, что базис будет, ну я не знаю, вот какой-нибудь вот такой.
Видно, что я рисую?
Не видно.
Вот такой базис, типа, будем превращать в вот такой вот.
Перекосил у нас так, многоугольник будет.
То есть, чтоб там совсем уже там все точки куда-то там вниз ушли.
Чем заведомо, прям сделаем тут вот настолько это большое, чтоб тут все, что было вправо, ушло, стало ниже этой точки.
Линеофилная, линейная получается?
Ну, по факту линейная.
А чего вы?
А, я не могу.
Чего не может?
Ну, короче, точку нам главное не потерять, которую они про нас спрашивают.
Ну, к точке мы тоже это преобразование применяем.
Ну, конечно, мы их к точке применяем и к многоугольнику.
Ну, как бы, очевидно, что афинное преобразование оставляет то, что внутри многоугольника, внутри многоугольника.
Ну, правда, тут уже, конечно.
То есть, это можно тут в целых числах развлекаться, ну и так далее.
Ну, это, если уж рассматриваем, как можно выкрутиться в целых числах.
Можно и так.
Но, на самом деле, может быть, по константе, может, лучшим оказывается, если мы не будем игнорировать этот случай,
давайте внимательно на все эти случаи посмотрим и подумаем, вообще, а так ли страшен, черт, как его малюют вообще.
И вот, оказывается, что на самом деле не так страшен.
Смотрите.
Потому что есть вот, на самом деле, такой красивый, вот сейчас будет очень красивый алгоритм, на самом деле.
Значит, идея будет такая, на этот раз предлагается, берем многоугольник.
Так, берем многоугольник, вот он, вот он, вот он, какой-нибудь там, да.
И там какую-нибудь точечку берем.
Вот такую-то, вот такую.
И, внимание, проводим, ну, давайте там для удобства, считайте, давайте проведем луч строго влево.
Вот.
И теперь говорим.
Ну, опять, мы уже проверили, что точка не лежит на многоугольнике, да, то есть либо вне, либо внутри, да.
И теперь говорим.
А теперь дальше идея такая, что предположим, что у нас возник отрезок, вот этот вот, а и минус первое, а и т.
Там, допустим, пересекающий луч.
Вот, пусть у нас вот возникло, что вот этот отрезок пересекает луч.
Тогда мы, тогда мы его учитываем.
Ну, учитываем, в смысле, там, прибавляем единичку, вот эту вот, да.
Тогда и только тогда, когда, верно, следующее, что максимум из игр и минус первого игр и т больше, допустим, либо равен, чем х, чем игр.
Но игр, вот это у нас точка х игр, да.
А минимум строго меньше.
И вот оказывается, что, и оказывается, что, действительно, вот такой вот хитрый ивчик, вот именно с такими равенствами, видите, вот важно, что одно строгое, другое и нестрогое.
Оказывается, это то, что нам нужно.
Убедиться в этом можно следующим образом.
Вот давайте просто разберем, а каким образом многоугольник вообще может взаимодействовать с этим лучом.
Самый тупой способ, это, конечно, тупое пересечение.
Ну и здесь заметим, что все в порядке, оба неравенства строго выглядят.
Так, какие у нас еще случаи бывают?
Бывает случаи, когда мы, ну такие, из простых, мы проходим через вершину.
Мы проходим через вершину и многоугольник идет дальше.
Тогда как мы эти два отрезка обработаем?
Заметим, что, заметим, что у нас будет еще один отрезок.
У нас будет ещё один отрезок.
проходит через вершину и ногу угонит и идет дальше. Тогда как мы эти два отрезка обработаем? Заметим, что вот этот отрезок не сработает, потому что у него вот второй IF не сработает, видите, да? А вот этот внезапно сработает, потому что у него максимум больше либоралина игрока, а этот меньше. Это вот прям хорошо, это то, что нам нужно. Вот.
Что еще может быть? Ну из простых, в таких соприкосновениях еще бывают вот такие ситуации, что здесь. Здесь заметим, что вот эти две штуки, они обе не сработают, и этот случай будет проигнорирован. А здесь наоборот, обе сработают, поэтому суммарно это тоже будет проигнорировано. Неплохо тогда.
Ну что еще бывает? Ну бывают еще вот эти вот всемерские случаи, да? Вот это бывает, и вот это вот еще бывает. Ну давайте разбираться. Ну опять начнем с того, что сам по себе отрезок, проходящий через этот луч, он на самом деле сам по себе ничего не поменяет.
То есть он сам по себе не сработает, поэтому надо смотреть на двух соседей. Ну в принципе уже можно сказать, что эти два соседа на самом деле будут рассматриваться так же, как вот во всех вот этих случаях. То есть здесь сработает ровно один, здесь там оба не сработают, здесь оба сработают.
То есть поэтому получается вот такая вот неожиданная красота. Ну особенно если учесть, что проверять пересекается ли вот этот луч со фреском, может быть можно даже с меньшим количеством векторов произведений.
Вот. Соответственно. Ну вот. Ну вот то получается вот достаточно хорошо.
Это сейчас что? А как мы будем с точностью тут делать? А как? Ну это в зависимости от того, как вам выданы точки. Ничего не сломается. Нет смысле. Вот эти вот проверки они до никакой точности не требуют. Если вам игры киданы в целых числах, вы чисто в целых числах и проверяете.
То есть все что вам нужно это как и ранее. Проверять не лежит ли точка на ногу вольника и вообще проверить пересекает ли отрезок этот луч. Ну проверить это можно там. То есть все это в целых числах прекрасно делается.
Ну например в случае отрезка вы просто делаете там. Во-первых вы легко проверяете пересекает ли отрезок эту прямую вообще и как равно чего-то там. Да? Вот так же да? Да, но можно так и проверить. Во-первых проверяете прямую через то, что максимум больше либо равно нуля, минимум меньше либо разум, да? С одной стороны. А с другой стороны мы еще говорим, что если мы хотим проверить пересекает ли отрезок эту прямую с нужной нам стороны, то все что вам нужно это вот векторное произведение вот это на это должно быть больше нуля. Все.
Ну это уже какая-то арифметика и что-то может появиться. Какая? Векторное произведение не требует никакой арифметики.
Ну что опомним? Векторное произведение помните, да? У него там формула х1 игрок 2 минус х2 игрок 1. То есть что это означает? Это означает, что если у вас точки заданы в целых числах, все задано в целых числах, то и векторное произведение будет целых числах.
Целых числах то все понятно в слотах, доблах. Ну если в доблах да, но тогда это придется предполагать, что многоугольник вам задан в доблах.
Но тогда это проблемы заданы уже тем, что у вас тогда вершины заданы с погрешностью. Там придется разбираться.
Поэтому тут конечно да. Но это уже стандартная проблема диаметрии.
Придется везде думать. Чаще всего там точно не надо не в доблах мерить, а в каком-нибудь адекватном поле, поэтому и в этих адекватных полях проводить абсолютно точные вычисления.
То есть тогда все будет может быть чуть дольше из-за длинной арифметики, но зато железо-бетон, наверное.
То есть вот таким вот образом можно понимать лежит ли точка в ногуугольнике.
Понятно да?
Вот.
Но теперь это мы рассмотрели в случае не выклонного угольника.
Пока мы его оставим.
Хотя короче забираю вперед, скажу, что у вас в домашнем задании будет веселая задача, когда надо будет проверять лежит ли точка в невыклонном угольнике за логерью.
Ну вот. Досконлайны мы еще дойдем в свое время.
Ну вот. Персистентность вам там писать не потребуется.
Почему-то.
Хотя можно было бы отмечить все, наверное.
А точно. Персистентность у вас, да.
Вот.
Но сейчас мы будем плавно переходить к выпусти.
Потому что я думаю оставшееся время, включая там последующие две пары после обеда.
Так сколько у нас там?
Так сколько у нас там?
Да. Мы будем через...
Ну вот. То есть мы попробуем с вами...
Ну давайте будем мы говорить о выпусти.
Снова.
Ну начнем с простой задачи.
Предположим, что нам опять нужно проверить лежит ли точка внутри многоугольника или вне или на границе.
Но нам гарантируется, что многоугольник выпуклый.
Тогда очень хочется сделать это побыстрее, чем завод.
Получится ли у нас?
Ну вот. Да, действительно.
Простая задача.
Хотя вы так сидите, как будто да.
Геометрия такая простая вещь, все понятно.
Но впрочем, действительно, у геометрии есть такая подлянка, что вот, идея на вроде все понятна.
А как начнешь писать, там начнется случай.
Вот. Или нет.
Да.
Ладно. Кстати, для теста.
А кто когда-нибудь писал проверку лежит ли точка внутри выпуклого многоугольника?
Выпуклого?
Да.
А не выпуклого за N?
А выпуклый залог не писал?
Да.
Интересно.
Понятно.
Чего?
Не выпуклого залога слушал один раз.
А у нас с тобой задача.
Ну что, нет.
Ну я думаю, если...
Все персистентного красно-черного дерева за денью памяти.
Ой, ой, ой, ой.
Нет, ну боже мой, пожалуйста.
Вам будет разрешено пользоваться этой картейки.
Хотя ладно, самое надежное для вас будет это использовать то дерево, которое вы сдавали...
Которое вы...
А, хотелось сказать, сдавали на ревью в прошлом году.
Но вы его не сдавали на ревью в прошлом году, да.
Но вы его хотя бы писали, так что нормально.
Ладно.
Так, что уж делать?
Ой.
Ну, значит, давайте разбирать.
Как это самое надежное делать?
Ну, во-первых, давайте предполагать, во-первых.
Ну, то, смотрите, тут разные части.
Давайте предположим, что многоугольник задан в порядке против часовой стрелки.
Ну, потому что вы за 1 можете выяснить, в каком порядке он вам задан.
И в случае чего там какие-нибудь индексы инвертировать, да.
Ну, хотя тут по-разному можно избавляться от копипасты, на самом деле.
Но давайте сейчас пока рассмотрим идеи.
Пусть у нас многоугольник идет в порядке против часовой стрелки, да.
Тогда, если...
Тогда первое, что нужно проверить за 1.
Вот, допустим, вот это у нас А0, А1 и это А-1.
Надо проверить, а лежит ли вообще точка в этом угле.
Точка в этом угле.
Просто да или нет.
Потому что если она в этом угле не лежит, то, в общем-то, можно уже за 1 сразу сказать, что точка никакого отношения к этому многоугольнику не имеет.
Вот, великолепно, говорим мы.
Вот.
Но если так оказалось, что она в этом угле лежит, тогда у нас оказывается следующие приятные штуки.
То есть давайте проведем...
Просто лучи во все стороны.
Можно обнаружить, что все эти лучи будут идти строго справа налево, вот так.
Ну, там векторные произведения будут, так сказать, больше вряд ли.
Ну, у нас все прочитано соответственно, то есть доказать тоже не сложно.
Да, Боже, конечно, помню.
Вот.
И тогда идея такая.
Но так как, смотрите, как у нас очень приятно, мы находимся в угле меньше 180 градусов, и внутри этот угол поделен на какие-то вот углы.
Последовательств углов.
Тогда для любой точки мы можем просто сказать, она лежит ли она вот в этом угле, и если нет, то она лежит правее этого угла или левее этого угла.
В общем, делаем это банально с помощью векторных произведений.
Ведь действительно, заметим, что какую бы точку внутри этого угла мы не взяли, то оказывается, векторное произведение, вот там, скажем, вот это, вот на соответствующей луч будет до какого-то момента меньше нуля, а после этого момента оно будет больше нуля, логично, да?
Ну ладно, может еще быть так, что там точка, конечно, иногда будет равную нулю, да?
Но самый-то монотонный факт позволяет вам вот эти вот граничные лучи, где знак векторного произведения меняется, найти просто так.
Граничные лучи, где знак векторного произведения меняется, найти просто бинарным поиском.
Понимаете, да?
Прям буквально, то есть мы знаем, что, скажем, первый, он тут находится в зоне минус, а я минус один, находится в зоне плюс.
Все непонятно?
А, ну вот.
И тогда давайте бинарным поиском находим, между какими двумя лучами эта точка находится. Ну или если она попала на один луч, то ничего страшного.
Ну и все. В общем-то, все, что нам теперь осталось, то есть теперь говорить, что точка лежит в многоугольнике тогда и только тогда, когда она лежит вот в этом треугольнике.
То есть, в точки зрения математики, все, что вам осталось, это проверить, лежит ли точка в треугольнике.
Ну как-нибудь за от единицы это делать.
Ну вот. Если говорить о том, как это сделать побыстрее,
то, конечно, тут можно заметить, что прям полностью треугольник не надо проверять,
потому что надо по большому счету просто проверить, с какой стороны эта точка лежит от вот этого луча.
То есть фактически вам нужно проверить вектор наблюдения вот это, вот на это.
Если получится меньше нуля, значит точка вовне. Если больше нуля, значит точка внутри.
Если равно нулю, значит поздравляю вы на границе.
Вот.
Здесь вот, оказывается, действительно, очень удобно.
Да, получается очень удобно, очень приятно.
Вот. Ну и здесь, конечно, дальше там может начаться вопрос, как избавляться от копипасты на тему того,
что если многоугольник не против часовой, а почасовой,
потому что вызывать реверс, это что, там за уатеншком получится?
Ну там можно либо с индексами магию писать, либо изо.
У меня в коде вообще просто написано, что вместо того, чтобы проверять там какой знак,
я просто говорю, лежит ли точка, вот когда я проверяю в какой-нибудь случае, я говорю,
лежит ли точка вот в этом угле, я просто функцию вызываю просто, да или нет.
Ну как бы да, по константе получается, конечно, значительно хуже, чем могло бы быть.
Ну вот, но зато железобетонно.
Но дальше это все зависит от ваших целей.
То есть как понятно, на Олимпиаде, конечно, иногда там задача, там задача написать так,
чтобы работало побыстрее.
Ну вот, но хотя в большинстве случаев обычно прям на сток там ужимать все-таки не будет.
Ну в моем случае, точно, задача была в том, чтобы он железобетонно работал правильно.
А сколько часов он при этом будет работать, не так принципиально.
Так что, может быть, в какой-то момент надо заняться его оптимизацией, но, пожалуй, не стоит.
Не стоит.
Ну нет, ну ладно, можно там заняться, но вот.
Но аккуратно, да.
То есть, помните, да.
Ну, то есть, знаете, это классический программистский анекдот, да, что?
То есть, если когда ребенок подходит к папе программисту, из-за того, что он не может работать,
то есть, если когда ребенок подходит к папе программисту и спрашивает,
там что-то, папа, а почему солнце встает на востоке, а садится на западе?
Так папа вылезает из-за компакт.
Так, видимо, из глубокого дебага.
И так говорит.
Да? Это точно?
Точно.
Ты проверял?
Проверял.
Прям всегда работает.
Всегда работает.
Ради бога, ничего не трогай, ничего не меняй.
Да, да, вопрос не больше не ответил, но вот.
Вот тут примерно та же ситуация.
Вот.
Таким образом, можно действительно достаточно легко проверять.
Да, то есть, конечно, как уже было сказано, можно научиться, если вам данного угольника,
можно у него сделать красивый предподсчет, ну, хотя бы за это долго,
и после этого потом для каждой точки за логарифом проверять, где она там лежит.
Ну, пока мы не будем торопиться ругаться словосочетаниями типа персистентный сет.
Ну, там соответственно.
Вот, поэтому пока просто в это поедем.
А вместо этого, перед, вот, прежде чем мы пойдем пушить,
мы осмотрим еще одну такую, такую классическую, веселую задачу.
Жила, жил был выпуклый многоугольник.
Вот.
И жила была точка, заведомо вне его.
Задачка! Привести к многоугольнику касательное.
Ну, на какой первый вопрос надо ответить?
Сколько?
Что такое касательное?
Да, конечно. А что это вообще такое?
Вот мы знаем там, допустим, здесь вот понятие касательное к окружности, да?
Вроде. Хотя тоже вопрос, а что это такое?
Приделся кучей.
Чего?
Приделся кучей.
Ну вот, ну да, можно, конечно, и так сказать,
но вообще говоря, понятие касательное будет и не так.
Обычно говорят, что, допустим, хочется, что если точка лежит вот вне, допустим, какой-то выпуклой фигуры, да,
то что такое касательное?
То касательное, то касательное, это, ну, то правое касательное,
это такой луч, что, ну, во-первых, как бы весь многоугольник или вся фигура лежит слева от этой фигуры прямой.
Это во-первых.
А во-вторых, соответственно, она, эта луч проходит через границу этой фигуры.
Ну потому что понятно, просто лежит слева, как бы нам тут много лучей подошло бы.
Ну вот. Но нас вот интересует это.
Ну потому что если вдруг фигура выпуклая, но при этом открытая какая-нибудь, да, то через границу не придет.
Вот в этом случае тоже у нас по окружности вот на самом деле касательное так.
Ну и аналогичным образом можно привести левую касательную.
Ну заметим, да, она может проходить через вершину.
В принципе, если не повезет, она может их через ребро проходить.
И вот теперь задача.
Найти эти касательные.
Желательно за линию.
Этого и не делать.
Ну хотя можно для разминчатых понять, а как это вообще за линию сделать?
Пройтись.
Пройтись. Хорошо.
Вот дана вот эта вершина.
Как проверить? Вот это, вот залот единицы проверить.
Это касательное или нет?
Залот единицы.
Да. Но на самом деле, да, заметим и давайте это рассмотрим, это нам в любом случае поможет.
Что тут у нас бывают 4 принципиально разных, ну там, бывают принципиально разные случаи какие.
Ну пусть у нас многоугольник идет против часовой стрелки.
Тогда у вас оказывается, если вы могли, то есть у вас есть вот две касательные, есть две части угольника.
Ближняя, идущая вот так вот вправо относительно этой точки.
И, идущая влево, другая часть, дальняя.
Если вы попали в точку на ближней части, то тогда это означает, что у вас следующая точка правее, а предыдущая левее.
Понимаете, да?
Если вы попали на точку, лежащую строго на дальней части, то наоборот, следующая точка левее, предыдущая правее.
Да, ну с помощью векторного произведения, кто левее, кто правее, мы легко проверяем, правда?
А что происходит с касателем?
Что происходит с касателем?
Ну с касателем все просто, если у нас есть точка касания вот такого, то у нас обе точки находятся слева.
А если это точка правая, то точка левая, обе точки, предыдущая и следующая, справа.
Ну ладно, по модулю еще, конечно, вот этого мерзкого случая, когда прям ребро.
Но тогда оказывается, что если, ну заметим, что у нас, мы считаем, что трех точек подряд у нас нет.
Поэтому, если оказалось, обе точки не левее, значит это точка или ребро правого касания, левого касания.
Ну то есть вот так, вот эти вот две вы рассмотрели, или вот эти две рассмотрели, в суть одна.
Вот, ну и с другой стороны тоже самое.
Вот, да, отлично, за линию, теперь остается нам только приближаться к тому уголеньку и вот эти вот павранцы отставы найти.
Ну теперь внимание, вопрос.
А как же нам теперь сделать это не за линию, а побыстрее?
Сделать это не за линию, а побыстрее?
Ну понятно, как делать это, в смысле, кое-как.
Ну вот, ну например?
Ну вот, у нас есть какая-нибудь точка А0, да?
Ну вот допустим.
Вот допустим, она лежит, мы очевидно можем понять, она как бы в ближней стороне или в дальней.
Да.
Нужно пойти о А0, он там уже пересет уголеньку или только пересечет?
Ну или сразу можно пойти, если она вообще посадится.
Ну да.
Давайте в простой случай рассмотрим.
Мы взяли первую попавшуюся точку и выяснили, что она является точкой правого касания.
Как найти теперь точку левого касания?
Бинпоиском.
Тогда заметим следствие, бинпоиском почему?
По вершинам просто, мы хотим найти первую А0.
Ну да, да, по большому счету, смотрите, то есть можно найти, действительно.
То есть, действительно, у нас сначала идут, вот начинается этой точка, у нас сначала идут точки в дальней части.
А потом, после погран-заставы, точки в ближней части.
Понимаете, да?
И для каждой точки мы за вот единицы уже умеем понимать, они дальние, ближние или вот касательные.
И поэтому мы теперь можем искать ее просто бинпоиском.
Понимаете, да?
Но правда, тут, видите, есть еще вот эти всякие случаи, поэтому есть еще такая оригинальная вещь.
Можно делать бинпоиск не по вершинам, а по репам.
Потому что, смотрите, у нас есть ребра, которые идут влево, а есть ребра, которые идут вправо.
И нам по большому счету надо найти момент, когда заканчиваются ребра, идущие влево, и начинаются ребра, идущие вправо.
То есть, мне кажется, что по константе это будет даже лучше, потому что на каждой итерации бинпоиска вы будете делать одно векторное произведение, а не два, когда будете брать вершины.
Понятно, да?
Но это был простой случай.
Ну там, я еще отвергаю, говорю то, что может быть, а ноль это еще не единственная вершина, может тут вот такое ребро или вот такое ребро там.
Вот это вся мерзость.
Ну, честно скажу, у меня нет способа, который прям все мерзости прям единым образом красиво обойдет, увы.
Но тем не менее.
А теперь что делать, если точка попала, ну, например, на ближнюю часть?
Ну, мы тоже будем делать бинпоиск, например, вообще только по ребрам, которые лежат справа от О0, и там мы тоже сможем найти.
Да, но тогда вам придется сначала бинпоиском найти, а где заканчиваются вот эти ребра.
Но можно это в одном том же бинпоиске, если ребро у слева, то это уже точно правее, чем правая граница.
Ну, в общем-то, да. А, ну можно и так, действительно.
Да, то есть если ребро целиком.
Да, да, да.
Да, то есть если начальная вершина такая, ну можно и так, да.
Да, но я сейчас скажу свой альтернативный способ, но мне кажется, он примерно идентичен.
То есть, смотрите, можно действительно тоже искать бинпоиском, потому что, смотри, ну вот, хотя формулевка будет одна и та же, то есть можно искать следующее.
Можно говорить, что у нас, если рассматривать только ребра, которые находятся справа от этого луча, да,
то мы понимаем, что у нас сначала идут ребра вправо, потом идут влево, а потом в конце начинаются ребра, которые вообще слева от этого луча находятся, и нам они уже не интересны.
Поэтому можно искать бинпоиском говорить, что если, действительно, ребро находится слева от этого луча, то нам просто оно неинтересно, да?
А тогда, если оно идёт слева, то это как бы оно дальше чем нужно, если так, то ближе.
То есть вот таким бинпоиском по ребрам можно искать.
Это мы сказали, что если А0 находится вот здесь, оказалось, что оно на ближней части, то вот таким бинпоиском мы нашли точку правого касания.
Ну, у меня был немножко альтернативный способ, но он примерно, ну, на самом деле он примерно такой же.
Мне вот удобно говорить, что у меня ребра бывают трёх типов.
То есть, смотрите, сначала, если я вот иду по полногоугольнику, то сначала у меня тип один, мы просто идём вправо до точки правого касания.
После этой точки правого касания идут ребра второго типа, то есть мы идём влево, влево, влево, влево.
А после этого мы идём опять вправо, это уже будет третий тип.
Теперь, как отличить ребра первого типа, второго типа и третьего?
Второго типа ребра определить очень просто, они просто идут влево.
Остается только отличить ребра третьего типа от ребра первого типа.
Как их отличить?
Ну, очень просто.
Ребра первого типа находятся правее этого луча, ребра третьего типа – левее.
Всё.
Вот такая идёт.
Вот, понятно?
Ну, вот так.
Вот так.
Вот так.
Вот так.
Вот так.
Вот.
То есть более того, то есть некоторая идентичность здесь есть.
Потому что замечаем, что если у нас есть типизация ребра, то получается точка, это погран заставы между первым и вторым и между вторым и третьим.
Ну, на самом деле, то есть, там, идейно, там, может быть, плюс-минус то же самое.
Возможно, когда и бинпольского будут примерно одинаковые на самом деле.
Ну ладно, не совсем одинаковые, но вот суть более-менее такая.
То есть вот такую красоту здесь удастся на месте.
Вот.
То есть вот оказывается чисто то же.
Кстати, а эту задачу кто-нибудь писал когда-нибудь?
Уф ты, классно.
Да.
Это уже пишут всё меньше и меньше.
Но принято, что больше нуля.
Но незбитая задача есть, она красивая.
Так, ну, что у нас тут ещё есть?
Так, ну давайте, то есть последний раз уже упомянули,
ну надо уже просто упомянуть как минимум, чтоб просто не сказать, что у нас этого не было.
Давайте упомянем.
А как вообще искать, кстати, касательную какручность?
Ну, здесь-то, в общем-то, очень просто.
Да, у нас есть центр, есть радиус.
И мы знаем, что у, конечно, касательной есть приятное свойство.
Если мы приведём в него радиус, то он будет перпендикулярен касательно.
Правда?
Ну тогда что это вам даст?
Ну, по большому счёту, смотрите, да, длину вы знаете, радиус вы знаете.
И тогда если рассмотреть вот этот угол альфа, то вы знаете, что синус альфа равен r поделить на a.
В общем-то всё.
Ну всё в том плане, что после этого вы находите косинус,
и этот луч тупо поворачиваете в одну и в другую сторону.
Если хотите найти точку касания, то, ну, конечно, вы просто там нормируете этот луч на нужную длину, там потеряете репорт.
Так, ну думаю, это...
Так, это я сейчас не наговорил, там эта чёрная подъемка.
Нет?
Да.
Да, как говорится, да, давайте, да, поднимите руки, кто знает, что такое теремоприфагора.
Так, Тихон не знает, да.
А, понял, ручка слабая.
Ну да, хорошо.
Да, там было бы интересно, да, кто умеет доказывать теремоприфагора.
А, тоже все умеют, классно.
Нет, дальше теста, кто умеет доказывать её более чем одним способом.
О, а я не умею из чего.
А теремокосинусу ты как накололи будешь?
Да?
О, что-то интересно.
Мне кажется, там вся вон теремоприфагора с полю открыта.
Я надеюсь нет.
Ну, ладно, не будем в это копать.
А вместо этого мы и последнее, что мы сейчас перед обедом сделаем.
Это решим ещё одну важную, тоже важную задачу.
Общей касательной двухногугольник.
Что?
Общей касательной двухногугольник.
Слушай, хорошо, что наполнил.
Слушай, общей касательной двухногугольник.
Самая важная задача, которая вообще есть.
Да, слушай, надо подумать, да.
Но давайте, ладно, пока мы для простоты, давайте скажем просто.
Мы нарисуем общие касательные двум окружностями.
Желательно не пересекающиеся.
Ну вот.
Но заметить есть следующее.
Ну, расстояние между ними, эй.
Но что нам нужно?
Ну, рисуется, на самом деле, она примерно так.
Вот.
Значит, r1, r2.
Р2.
Р2.
Вот, действительно.
Если мы хотим, но здесь заметим, что на самом деле есть четыре, четыре на самом деле касательные.
Да?
То есть мы помним, есть вот такая касательная, есть вот такая касательная.
А есть на самом деле вот такие внутренние.
Вот.
Понимаете, да?
Своится предыдущая задача.
Что ж там?
Своится предыдущая задача.
Ну вот.
Ну вот.
Ну, как сводится?
Ну, не совсем.
Ну, в некотором смысле сводится.
Ну, ладно.
Ну, я имею в виду, что касательные, вот эти общие пересекаются с линией центров.
Либо в центре внешних, либо в центре внутренних.
Вот эти, которые легко находятся.
Например.
Ну, не знаю.
Я бы сказал, конечно, наверное, не надо.
Может, не надо так делать, потому что есть тогда...
Ну, потому что бывают случаи, когда радиусы раунды.
Ну, будет.
Ну, конечно, мой способ, собственно, даст вам возможность как-то без этого обойтись.
Смотрите.
Ну, просто идея будет такая.
То есть, заметим, что если мы тут проведем прямую параллельную этой потенциальной касательной, то получится прямоугольник.
Ну, хотя, да, случаи r1 равно r2, видимо, все равно придется рассматривать отдельно.
Ну, да, хотя, да, выведенный...
Да, просто прямоугольный треугольник со сторонами вот...
X, X и 0.
Да, расстояние, да.
Это расстояние, и вот противоположный качественный 2-r1, который может быть равен 0.
Ну, ничего страшного.
Тогда получается вот это вот.
Тогда, смотрите, тогда, чтобы найти, так сказать, вот эту внешнюю касательную, которая находится справа, что вы делаете?
Вы находите вот этот угол айфа, поворачиваете в нужную сторону.
То есть, находите точку.
И теперь остается их только перпендикулярно сдвинуть на расстояние r1.
Ну, как бы, повернуть на 90 градусов по часовой стрелке мы уже умеем.
Да, помним, да, что это просто x, y так жественно превращается во что там?
Y и минус x.
Да, как проверить, что это в нужную сторону?
Векторное произведение, минус x квадрат, минус y квадрат, меньше уля то, что надо.
Вот.
Так что там повернули, нормировали, сдвинули, возрадовались.
Вот. Ну и в другую сторону симметрично, соответственно.
Да, там еще.
Тоже вот так.
Вот.
А что делать с внутренними касательными?
Так, а вот сейчас.
Что делать с внутренними касательными?
Ну здесь, в общем-то, ничего страшного уже.
Там скажем, вот с такой касательными можно сделать следующее.
Так, что у нас тут мы видим?
Тут у нас перпендикулярность вот такая, тут у нас перпендикулярность вот такая.
Тогда идея такая, а давайте-ка...
Тоже тут перпендикулярную прямую просто через вот центр первой окружности проведем.
Тогда мы обнаружим, что здесь получится просто вот это вот расстояние.
Это окажется R2 плюс R1.
И тогда просто окажется, что вам нужно построить вот эту сторону.
Ну и в этом в общем-то тоже прямоугольный треугольник со сторонами L и противоположным качеством R2 плюс R1.
Вот ровно так же делается.
Тогда построили, и вот на этом отрезке, тогда вот тут нашли вот эту точку.
Ну и вот эту, ну и соответственно вот эту точку.
Просто прибавляем этот вектор сюда и получим.
Ну и вот эту.
Понятная идея?
Да, так что вот так.
Так что это тоже было важно упомянуть.
Да, вот теперь мы 4 общие касательные нарисовать умеем.
Ну там конечно начнутся всякие мелочи в духе, что допустим нам известно, что окружности касаются.
Оно-то дайте нам пожалуйста вот эту вот одну общую.
Ну ладно, их три назад.
Или там всякие вот эти мерзости типа окружности внутри, но там это уже.
Ладно, я не знаю была ли задача, даны две окружности, дайте пожалуйста все их общие касательные.
Бывало такое?
Что-то я не помню такую задачу, если честно.
А, ну хотя можно и сделать.
А чего уж так?
Кстати да, хорошее домашнее задание, соревнование.
Не просто сделать что-то, да, каждый делает свой тест, да и соответственно.
Да, выигрывает тот, кто завалит больше хрюша, чем остальные.
Ну а чего бы нет на самом деле?
Ладно.
Так, ну ладно, на этом мы тогда пока остановимся.
Ну вот, ну в следующий раз, который будет у нас через полтора часа.
Да, чуть больше.
Соответственно мы тогда продолжим проводить обыкновение.
