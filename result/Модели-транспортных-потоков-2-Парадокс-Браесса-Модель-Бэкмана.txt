Ну хорошо, а теперь сделаем вид, что ничего не было, и начнем лекцию как бы сначала.
Тема сегодняшней лекции это продолжение изучения модели равновесного распределения потока по
путям, модели прежде всего Бекмана, но не только. Мы сегодня поговорим еще о модели стабильной
динамики, попробуем вывести модель Бекмана, вывести немножко по-другому, не так как это было
сделано на прошлой лекции. Поскольку прошлая лекция не снималась, я, наверное, напомню,
напомню вывод на прошлой лекции. Это прямой вывод, то есть задача, то есть поиск равновесия
сводится к задаче оптимизации. А сегодня мы тоже получим, что равновесие в той же самой модели
сводится к задаче оптимизации, но это будет двойственный вывод, то есть другая задача оптимизации
получается, естественно, связанная с исходной, но другая. Но прежде чем переходить к моделям
равновесного распределения потока по путям и их выводу, давайте закрепим материал примером,
который я в общем-то только что рассказывал, но поскольку запись началась только что, я его повторю,
пример называется paradox bryce, вот он нарисован, давайте лишние числа сотру, которые будут вас
сбивать, то есть я не буду здесь писать, и тут тоже не буду писать. Предположим, что есть город,
в котором есть старт, район, из которого автомобили стартуют, район finish, есть две
вспомогательные вершины, которые не порождают никакой корреспонденции, не являются стоками,
ну и изначально есть только четыре дороги, соединяющие старт с up-down и с finish. Дороги имеют
характеристики такие, какие нарисованы, то есть затраты на проезд этого ребра, есть поток на
ребре в размерности автомобилей в час и делить на 100, это будут затраты в минутах, но здесь затраты
постоянные 45 минут, здесь симметрично 45 минут, здесь тоже самое симметрично f на 100. У нас мы считаем две
полосы, точнее вот здесь входят в систему две полосы, ну или если хотите из домов, которые в этом
районе выезжают, сток автомобилей, сколько вот характерно для максимальной пропускной способности
двухполос. Эти четыре тысячи автомобилей должны как-то распределиться, как они распределятся,
если ситуация равновесная, то легко понять за счет симметричности картинки, что половина
потока 2000 автомобилей пойдет по верхнем пути, половина потока по нижнем пути, значит в равновесии
получается будет 65 минут, потому что половина потока от 4000, точнее половина потока от 4000
это 2000 автомобилей, ну и соответственно 2000 автомобилей вот 2000 автомобилей поделить
на 100 будет двадцать минут, ну и здесь 45 минут. Итого первые конфигурации 65 минут
Первая конфигурация 65 минут. Вторая конфигурация. Вторая конфигурация это когда строится дополнительное
ребро. Давайте его пожирнее нарисую. И это ребро имеет нулевые затраты. Постойте телепортация. То есть
можно понимать так что эти две вершины были близки, расстояние между ними маленькое и не было дороги
которые их соединяют. Ну вот построили река текла. Сейчас построили мостик и можно переезжать
через этот реку и можно сразу оказаться из UpDown. Как поменяется конфигурация? Ну предлагается такое
решение пустить 4 тысячи автомобилей сразу на вот это вот направление. Почему это решение предлагается?
Потому что понятно что в начальный момент вот этот путь он будет иметь затраты 40 минут. Вот если
один только водитель захочет что-то менять он поменяет и он может сделать себе 40 минут затраты на
перемещение. Естественно все такие умные все начнут перетекать. Перетекать с вот этих верхних и
нижних путей вот на этот путь. Но вот оказывается что они будут перетекать, вплоть до конца перетекут.
Потому что смотрите здесь затраты будут вот если брать этот путь и брать 4 тысячи автомобилей то
получится здесь 40 минут здесь 40 минут и здесь 40 минут и здесь 40 минут. Итого будет 80 минут.
Альтернативные маршруты при такой конфигурации если весь поток идет здесь то будет ли у кого-то
желание поехать как-то по-другому. Но поскольку одна корреспонденция то мы говорим как бы по сути
о всех водителях. Произвольно выбранном водителе будет у него желание ехать по-другому. Но давайте
смотреть 40 минут 45 минут 85 минут вряд ли. 45 минут 40 минут с 85 не будет. То есть получается
что в данном случае равновесие так называется неэффективно папарето. То есть мы получаем
ситуацию когда в общем-то как сказать можно водителям сказать как двигаться и всем станет
лучше. И как бы равновесие которое возникает оно плохое. То есть если например сказать что 1750
автомобилей вот так должны ехать 1750 автомобилей вот так а 500 автомобилей вот так то каждый
автомобилист будет тратить меньше чем 65 минут. А тут у нас получается в этом равновесие 80 то есть
это какое-то очень плохое равновесие. То есть вообще как бы ну то есть не знаю непонятно зачем
оно такое вот нужно такое равновесие. Проблема социальным оптимум вот в чем. То есть казалось бы
вот я только что рассказал стратегию как надо двигаться чтобы всем стало лучше. Но вот представьте
себе ситуацию что вы оказались среди тех водителей которые двигаются ну быстрее чем там вот вот это
вот 80 минут там ну то есть быстро но кто-то быстрее вас. Вот в чем проблема. И поменяв свою стратегию
можете еще быстрее двигаться. То есть как бы получается такая ситуация что все всем выгоднее
чем в равновесии. Но кто-то себя ощущает обделенным потому что у кого-то еще лучше. Вот когда равновесие
то у всех одинаково. То есть одинаково в том смысле что если есть что-то лучше каждый может по
правилам игры туда переключиться. И поэтому что-то лучше быть не может. А когда это не равновесие
социальный оптимум то у вас есть стратегии вообще говоря могут быть стратегии которые если вы на них
переключитесь у вас будет лучше. И у кого-то кто использует те стратегии так оно и есть у них
лучше. И вы задаете с резонным вопросом а почему это должен быть я. Почему я должен как бы ехать по
вот вот такому маршруту а кто-то другой по более короткому. Но если все будут этой логике
придерживаться и все перейдут на самый короткий уже как бы перестанет быть социальным оптимум. Вот
и задача вообще говоря государство центра она заключается в том чтобы равновесие которое
возникает в игре оно более менее соответствовало социальному оптимуму. Для этого что делают. Для этого
стараются пенализировать как-то ну так сказать штрафовать те дороги на которых образуются
наибольшие пробки чтобы было меньше желания двигаться по таким дорогам. Это могут быть реально
платные дороги. Могут быть какие-то привилегии для отдельных категорий автомобилистов например
выдлинной полосы. Но таким образом пропадает полоса. Ну то есть как-то влиять на ситуацию это
называется мета игровой синтез. То есть пытаться менять правила игры так чтобы равновесие в новой
игре было близко к социальному оптимуму. Ну в общем это мы будем отдельно говорить возможно даже в
конце сегодняшней лекции. Итак парадокс Брайса он о том что построили новую дорогу а стало всем
хуже. То есть равновесие имеет хуже характеристику чем чем оно было до того как эту дорогу построили
оказалось бы строить дороги это делать лучше. То есть большего про штрафы будем но для этого мне
нужно будет выписать более общие формулы потому что не хочется сейчас частности. Ну то есть штрафы
это хорошо. Ну в смысле это правильное с точки зрения математики вообще по делу решение. Но
давайте напомним что такое модель Бекмана и поговорим про штраф именно в контексте более
общей модели чтобы у вас был общая схема. Не вот не этот пример но хотя пример тоже можно потом
к нему вернуться. Общая схема. Итак что такое модель Бекмана модель равновесного распределения
потока по путям. Мне придется это напомнить потому что первая лекция прошу прощения кто был и слушал
первую лекцию. Ну что делать. В общем я так понимаю что курс хочет слушать довольно много людей издавать
его. И вот проекты которые будут предложены они вокруг всяких тонкостей. Ну не только тонкости
вокруг вот некой математики связаны с небольшим числом модели буквально с тремя. И об этом вот эта
модель Бекмана это одна из них. Поэтому если я сейчас как-то замну это будет нехорошо. Это значит
надо нам сейчас максимально разобраться в деталях. Итак что такое модель Бекмана. Сейчас просто
определение. Ничего особо такого умного я говорить не буду. Просто повторить определение. У нас
есть В. Набор вершин графа. Набор вершин. Набор вершин. Е. Набор ребер. Набор ребер. Обычно для
транспортного графа характерно что вершины ребер одного порядка. Но ребер где-то раза в три больше.
То есть мощность числа ребер это где-то три на мощность числа вершин. Вот мы сейчас моделируем
Москву и у нас число вершин может достигать 10 в пятой степени. Но это за счет вот некого
раздутия графа. Ну вообще число, извините, число ребер. 10 в пятый где-то может достигать. Ну просто
вы понимали масштаб графа на котором мы работаем. Значит вершины обычно соответствуют каким-то
фрагментам. Например ну застройка. Жилой район. Ребра это это даже не дорога. А участок дороги
где-то метров 500. Ну на котором можно говорить о каких-то одинаковых характеристиках. Говорить о
характеристиках одинаковых в масштабе километров можно конечно для шоссе. Но это в общем для городской
дороги не характерно. Проезжаешь 500 метр километр и там уже просто меняется конфигурация сети. И
каждое такое изменение, каждый перекресток он в каком-то смысле вершинка. Просто эта вершинка не
порождает корреспонденции. Ну то есть бывают вершинки такие вот, которые ничего не порождают,
ничего не поглощают. Это нормально. Значит граф более-менее планарный, но мы понимаем что Москва
конечно ну не совсем планарная. И развязки на МКАДе например они точно не планарные. Вот эти всякие
бабочки. Но это не критично. Это нигде планарность особо не используется. Граф естественно ориентированный,
но в этом смысле как бы это тоже не критично. Потому что в большинстве случаев дороги все-таки
двухсторонние. Хотя конечно одностороннее движение тоже много где есть. Но так вот если рисовать,
то в основном это вот какие-то такие дороги. Вот этого практически нет. Ну оно бессмысленно
в нашей модели. Значит граф характеризуется чем? Что у него есть пути. Ну то есть в принципе есть
информация о том какие пути в графе разрешены. То есть потому что вообще говоря вот например может
быть такая ситуация. И в принципе если ничего не говорю про возможные пути, то можно и вот так
поехать и вот так поехать. Ну например вот я знаю перекрестки где в принципе вот так вот ехать нельзя.
Вот так вот ехать можно. То есть просто вот это вот ну это редкость. Но бывает так что за счет неких
каких-то особенностей, что вот этот вот поворот он просто запрещен. Вот нельзя отсюда сюда сворачивать.
Под стоп-знак. Точнее не под стоп-знак, а под кирпич. Вот ехать и получается что надо все-таки
прописывать пути которые есть набор ребер. То есть путь это какой-то набор Е. Давайте как-то так
сказать ЕП1 ЕП. Не знаю как это обозначить. Сейчас ЕП1 да ЕП не знаю какой-нибудь М. Вот сколько
входит ребер в этот путь. И вводим корреспонденции. Корреспонденции вершинки проиндексированы.
Каждая вершинка имеет индекс. И вообще говоря для каких-то пар вершин ИЖи, принадлежащих
множество ОД, мы можем вводить понятие корреспонденции. Д и Ж. Матрица корреспонденции мы
считаем сейчас заданная. Д и Ж это принадлежит ОД. Вот это заданная матрица. То есть по каким-то
парам источник сток. У нас есть, ну что это источник, это сток, у нас есть информация. Это вот
столько людей из источников сток в единицу времени хочет двигаться. Дальше значит эти люди уже как-то
должны распределяться. И мы собственно вводим пути и множество пути отвечающих заданной корреспонденции.
По ИЖи множество путей, множество путей отвечающих, отвечающих заданной корреспонденции. Заданной
корреспонденции ИЖи. То есть это все такие пути допустимые, которые вот соединяют И с Жи. Вот сколько
их тут, ну вот как получится. Вообще говоря, удобно характеризовать вот эти пути вот таким вот,
таким вот индексом. 1 если Е принадлежит П и 0 если Е не принадлежит П. Для всех П, принадлежащих П
большое множество путей, где П большое есть просто объединение П и Жи. По всем ИЖи прямое объединение
П и Жи. По ИЖи принадлежит ОД. То есть вот у нас соответственно есть описание множества путей. Дальше
мы говорим, что задача-то собственно заключается в том, чтобы найти вектор Х, который есть вектор
распределения потоков по путям. ХП, П принадлежит П большое. Вектор распределения потоков. Сейчас,
вектор. Распределение потоков по путям. Распределение потоков по путям. По путям.
Значит, этот вектор должен удовлетворять вот таким соотношением. ХП должно равняться Д и Жи,
если П принадлежит соответственно П и Жи. И это должно быть верно для любой пары ИЖи,
принадлежащего Д. То есть это набор таких симплексов. Но почему симплексов? Потому что
естественно ХП не может быть отрицательный. И вот все это множество называется Х большое. Вообще говоря,
это множество зависит от Д. Вектора Д, ну точнее матрицы Д, корреспонденции. Но мы ее фиксируем сейчас.
Она фиксирована. Поэтому нам сейчас не обязательно учитывать, что есть зависимость от Д. Д замороженная
матрица здесь. Она задана. Собственно, задача заключается в том, чтобы найти равновесие. То есть
найти такой вектор Х, который описывает, как люди распределятся по этой сети, выполняя условия
корреспонденции. Но я пока не описал цель людей. Что они хотят? Они хотят добраться из дома на
работу или вот точнее удовлетворить эту корреспонденцию с наименьшими затратами. Чтобы
количестве написать эти затраты, мы каждому ребру Е, так обозначается ребро. И естественно Е это
из множества вот этого. Мы ставим в соответствии функцию Тау Е от Ф Е. Эти функции по определению
считаются монотонно, точнее не убывающими. Не монотонно возрастающими, а монотонно не
убывающими. Вот такие функции Тау Е, Ф Е, как функции потока на ребре. Ф Е, поток на ребре Е.
Ф Е, поток на ребре Е. На ребре Е. Еще раз повторю, что я уже это говорил на прошлой лекции. Мне как бы
неловко, что я это вынужден повторять. Но другого варианта нет, потому что, если я это сейчас не
повторю, то у нас получится курс. Начнется с того, что я с места в карьер. Поэтому, что лучше я
повторю, ничего криминального в этом не вижу. Может быть, лучше даже как-то это усвоится. Так,
что такой поток? Поток на ребре Е. Это просто есть сумма потоков по всем путям, проходящих через
заданное ребро. Значит, я должен суммировать потоки ХП по всем путям, которые проходят
через заданное ребро. Теперь мы можем вести понятие затрат на пути. Затраты на пути П. Это
есть сумма тех затрат на ребрах, входящих в этот путь. То есть, я беру символ кронекера и беру
вот затраты, которые сюда входят. Ф Е. Ну, вообще говоря, конечно, если я пишу функцию ТП, то это все
таки функция. И мне надо поставить в ней аргумент. Но, чтобы это сделать, мне тогда надо, в общем,
понять, от какого аргумента я хочу эту зависимость. И вот мне понадобится эта зависимость от аргумента Х.
И, соответственно, ТП от Х будет иметь вот такой вот вид. Ну, посредством того, что Ф Е зависит
от Х. Ну, значит, так же, как и раньше, вектор Ф потоков по путям мы обозначаем просто Ф. Ну,
и наряду с Х, конечно, важно найти F. Вот. В общем-то, это все, что надо сказать про определение. То есть,
в общем, это есть описание задачи. Теперь, собственно, математическая такая сердцевина,
теоретика игровая. А что водители-то делают? Они убирают кратчайший путь. Ну, то есть,
это формализуется таким образом, что надо найти. Ну, двумя способами можно описать. Первый способ.
Значит, водители выбирают кратчайший путь. Это означает, что если ХП для любого П,
значит, условия, дополняющие нежесткости. Нежесткости еще иногда его называют нелинейной
комплементарностью. Нелинейной комплементарностью. Вот. Оно выглядит таким образом. Для любого П,
точнее так, для любой корреспонденции ИЖи, принадлежащей множеству корреспонденций ОД,
Origin Destination. Это просто какой-то набор пар. Потенциальные это могут быть вообще все возможные,
значит, это из множества В и это из множества В. То есть, на прямом произведении В, на самого
себя мы задаем какой-то набор пар. И вообще говоря, он может быть сильно разрежен, потому что далеко
не из каждого перекрестка в каждой есть какая-то корреспонденция. Потому что корреспонденции
порождены все-таки жилыми районами. Вот. Так вот, для любой корреспонденции и любого пути,
отвечающий этому набору этой корреспонденции, должно выполняться следующее, что xp умножить на
tp от x минус минимум по q из всех путей, отвечающих вот этому tq от x должно равняться ную. И это вот
x будет тогда равновесием. То есть, xp от x равновесие x с звездой равновесие. Вот если это выполняется,
равновесие. То есть, если выполняется вот такое условие, то есть, что либо по этому пути никто
не едет xp 0, либо этот путь, если по нему кто-то едет, он обязан быть кратчайшим. Почему? Потому
что если эта штука 0, если эта штука 0, это что означает? Это означает, что p находится, то есть,
он один из минимайзеров. То есть, он один из тех путей, на котором достигается кратчайший путь. И
тогда по этому пути кто-то может ехать. А если этот путь не кратчайший, то есть, это больше нуля,
то поскольку это должно равняться нулю, то это неизбежно равняется нулю. То есть, по этому пути
никто ехать не должен. И вот мы с вами на прошлой лекции занимались тем, что думали,
как эту задачу переписать по-человечески. Потому что найти решение вот этой задачи
нелинейной комплементарности, в которой, собственно, и сидит поиск равновесия. То есть,
если мы найдем x со звездой, удовлетворяющий системе нелинейных уравнений и уравнений здесь
стока, сколько путей, то как бы мы найдем все эти потоки на путях. Но это как бы так никто не
делает. Это невозможно сделать в любой такой практичной ситуации. И не только потому,
что число путей экспоненциально большое типично. То есть, вот возьмите какую-нибудь Манхэттенскую
сеть. Я уже про это говорил на прошлой лекции, но это несложно повторить. Возьмите точку старта,
точку финиша. И все. Ограничитесь одним источником с током, то есть одной корреспонденцией. И
посчитайте число путей, которые ведут вот отсюда, вот сюда. И по числу ребер это будет как бы
экспоненциально с точностью до излечения корня в показатель экспонента и величина. То есть,
число путей есть экспонента от линейного размера вот этого квадрата. Ну и с точностью
некоторого полиномиального фактора. То есть для нас интересен экспоненциальный фактор. И
естественно это экспоненциально растет от линейного размера вот этого квадрата. Ну то есть,
число путей может быть экспоненциально больше числа ребер. И нереально решать задачу в таких
размерностях. Но даже нет проблемы. Это как бы можно довольствоваться, например, как-то пытаться
найти чисто f. И тогда это будет разумная задача в размерности 10 в пятый. Это уже такие задачи
можно решать, если бы эта задача была хорошая. Но в таком виде эта задача просто найти решение
системы нелинейных уравнений. Это нехорошая задача в общем случае. Не очень понятно как ее решать.
И как следствие вот стали думать, ну поскольку это важная задача, надо решать. Стали думать о том,
как такие задачи решать. И вот удалось обнаружить, что на самом деле эта задача сводится к задаче
выпуклой оптимизации. За счет того, что функция tp от x, вот векторное поле, если даже точнее говорить,
tp от x, это потенциальное векторное поле. То есть существует такая функция скалярного аргумента,
которая есть сумма стигма e значит fe от x. Сейчас я напишу, что это такое. Где sigma e fe от x,
sigma e от f просто напишу. Это есть интеграл от нуля до f, tau e от z dz. То есть существует вот функция.
Градиент мы это в прошлый раз делали, ну в данном случае производная, который порождает вот tp от x,
dx dx dp dx p по x равняется tp от x. Вот. И мы с вами в прошлый раз,
пользуясь потенциальностью векторного поля, а это вообще является следствием того,
что это игра. Вот это игра, потенциальная игра загрузки. То есть что затраты на ребре определяются
потоком, чисто на этом ребре. И например, не зависит от потока на пересекающем его
а вообще, говоря, в жизни все сложнее. Если это нерегулируемый перекресток и вы хотите его пересечь,
для того, чтобы это сделать, надо, я не знаю, давайте вот в эту сторону стрелку нарисую и вот туда поехать,
то вам надо повернуть налево, но для этого вы должны пропустить, у вас не главная дорога,
ну по умолчанию, как бы, помеха, то есть это вот главная дорога, вам надо все это пропускать и
только когда образуется коридор, вы поворачиваете. Ясно, что от интенсивности движения по вот этому
направлению зависит пропускная способность вашей дороги, поэтому все сложнее, но в большинстве моделей
все-таки-то такие вещи стараются не учитывать, уж это довольно сложно уже как бы решать такие
задачи. Вот, в целом, в простейшем предположении, что затраты на ребре определяются потоком
непосредственно только на этом ребре, мы можем найти такую функцию, это проверяется просто из
определения, из определения я должен подставить fe от x вот сюда, вот сюда, ну и продеференцировать,
и просто в одну строчку это делается. И вот оказывается, что условие дополняющей нежедкости,
которое я выписал, вот оно, равносильно условию, что функция psi от x достигает минимума на множестве
вот так вот. То есть это просто условие минимума этой функции. Вот на этом множестве я тут д
писать не буду. Ну и чтобы это показать, мы взяли какую-то точку, просто решение x со звездой,
вот, и стали рассуждать от противного. Здесь значит xp, здесь xq, и пускай они принадлежат одной
xp больше нуля, и пускай они принадлежат одной корреспонденции, принадлежат, точнее пути
p и q, p и q принадлежат одной как бы корреспонденции, это важно. И дальше предположив, что вообще говоря,
вот эти задачи, ну там две стороны надо делать, я рассказывал одну сторону, что эти задачи не одно
и то же. Мы давайте придем к противоречию. Итак, вот пускай xp больше нуля, xp больше нуля,
и соответственно, значит, покажем, что да, и выполняется вот это условие. Ну и мы что сделали,
мы попробуем прийти к противоречию, что значит, сейчас я забыл, там мы говорили, что если то условие
не выполняется, вот так мы говорили, да, то есть допустим, что вот то условие не выполняется,
то есть вот это неверно. Мы напишем, что значит, что это неверно. И значит, существует такое p,
для которого там вот нарушается. Вот мы это p взяли, и дальше мы для этого p, значит, просто
перебросили, если это xp больше нуля, вот в этом определении, мы можем перебросить с него на xq немножко,
то есть сохраняя условия корреспонденции, потому что они на одной корреспонденции. Мы чуть-чуть
взяли от xp и перебросили сюда. Из-за того, что мы взяли чуть-чуть, у нас приращение функции
определяется первыми производными, то есть нам нет необходимости использовать ряд tlora там до второго,
до третьего порядка включить, но мы как бы берем приращение функции, если два аргумента поменяются,
аргумент xp и xq. Причем меняются они соразмерно, то есть так, что xp плюс xq в сумме константа,
то есть столько, насколько уменьшили xp, настолько увеличилась xq. Вот дальше показывается, что если это
не выполняется, то мы можем найти лучшую точку минимума, чем x звездой, то есть уменьшить еще
значение функции по сравнению с тем, что было в этой точке. Поэтому мы приходим к противоречию с тем,
что xp больше нуля, то есть если p не кратчайший путь, то xp должно быть больше нуля. Вот о чем эта
формула, что если xp больше нуля, то это кратчайший путь, если это не кратчайший путь, то xp ноль. Допустим не так,
вот xp значит больше нуля, но это не кратчайший путь, xq кратчайший путь. Ну так давайте перекинем с
этого пути на кратчайший путь и поймем, что с точки зрения этого функционала станет лучше. Эта игра идет
за счет того, что когда мы будем считать проращение функционала, мы будем как раз пользоваться вот этой
вот формулой, и вот поэтому и возникает понятие связь кратчайшего пути и вот, так сказать,
прощение этой функции. Это то, что было в прошлый раз, я прошу прощения, что скороговоркой, потому что в
принципе те, кто присутствует в аудитории, все это уже слышали. А теперь сегодня мне хотелось бы
другой путь показать, я надеюсь, что я все-таки успею еще и про платные дороги вам рассказать.
Другой путь, я собственно независимо сейчас еще раз выведу ту самую постановку задачи, вот эту,
точнее ну как задачи оптимизации, но двойственным образом. То есть я как бы не буду строить двойственную
задачу вот к этой, а выпишу готовый ответ, но выведу его содержательно. Вот чтобы вывести его
содержательно, мне понадобится немного другое описание того, что такое путь кратчайший. Для этого
давайте сделаем следующее. Для этого мы ведем затраты ТЕ на прохождение ребра Е. Какие-то затраты
будут, но очень просто, по определению. У нас же введены функции ТАУЕ, были где-то вот ТАУЕ от
ФЕ. Ну значит ТЕ это равняется ТАУЕ от ФЕ. Вот и все. Замечательно. Ну можно даже написать,
вот поскольку мы ввели функции СИГМАЕ, можно даже написать так, что это есть СИГМАЕ штрих от ФЕ.
Ну вот что нам известно. То есть нам известно, что затраты на прохождение того или иного ребра,
но это есть какие-то функции, временные затраты, это есть какие-то функции от потоков. Это как бы
с одной стороны. Это просто вот я записал одно из условий модели. Вообще то, что рассказываю,
это как методология. Вот полезно ее применять вообще не только в этом контексте. И почему я сейчас
про это говорю? Потому что эта же методология позволит нам в будущем более сложную задачу решить,
которая связана с поиском рановесия многостадийной модели. Обратите внимание на методологию. Так вот,
это как бы формализовали просто одну связь. Давайте вторую связь формализуем. Условия
рациональности кратчайших путей. Эта связь выглядит таким образом, что поток по тому
или иному ребру определяется чем? Он определяется соответственно потоками. То есть вектор потока
по ребру. Это есть сумма deltaEP на xp. Вот это мы с вами выше писали. Ну и можно написать,
что этот вектор должен принадлежать супер дифференциалу, ну или по сути дифференциалу из
точки гладкости. Вот такой вот штуке. Сумма Dежитых на Tежитая от T. Я сейчас должен пояснить,
что такое Tежитая от T. Иначе это будет непонятно. Что это такая формула? Откуда она возникла?
Значит сумма по всем EG принадлежащим ОД. Вот то, что я написал сейчас, это как бы синонимично тому,
что водители рациональные. Значит вот эта штука, это есть минимум по всем путям P
принадлежащим P и G от соответственно затрат, которые мы несем проходя тот или иной путь. А какие
затраты мы несем проходя тот или иной путь? Ну понятно, что это вот такие затраты. По всем E,
принадлежащим. Да нет, просто по всем E. Мы суммируем затраты, которые входят в данный путь.
Вот и соответственно эта функция, она минимум из функций двух. Вот у меня одна функция линейная,
вот у меня другая функция линейная. Смотрите, одна линияная функция, другая линияная
функция. Минимум из этих функций, это что такое будет? Это будет вот такая функция. Это вогнутая
функция. То есть минимум в данном случае из линейных фунций, это вогнутая функция. Ну понятно,
что на самом деле, в общем случае, если я беру вогнутую функцию и беру еще одну вогнутую функцию,
беру из них минимум, то я тоже получу вогнутую функцию. Поэтому я могу обобщить, сказать, что
минимум вогнутой функции вогнутая функция. Но для вогнутой функции, которая негладкая, понятие
градиент обобщается на понятие не sup-дифференциал, а super-дифференциал. Поэтому этот значок надо
понимать как super-дифференциал, но по сути это то же самое, что с модулем x. То есть модуль x в нуле
имеет как бы вот производные, непонятно какие, да, то есть что это за производное будет. Вот от
минуса единицы до единицы все меняется. Но этот отрезок минуса один-один, он называется
sub-градиентом. И почему именно этот отрезок выбирается? Да потому что это любая прямая с
таким наклоном от минуса единицы до единицы будет опорной гиперплоскостью, так называемой. То есть
график функции будет лежать по одну сторону от этой прямой. Это очень важное свойство, которое
в анализе используется. И, собственно, аналогично можно картинку на 180 градусов повернуть и говорить
о super-дифференциалах. То есть, по сути, о тех же векторах, которые обладают свойством вот этих
построений, касающихся гиперплоскостей к этому нот графику. Ладно, это сейчас технический момент,
это просто некий элемент выпуклого анализа. Вот, собственно, дальше мы как бы говорим следующее,
что если у нас есть, ну давайте для простоты, только одна корреспонденция, только одна
корреспонденция, то этот поток, ну просто, вот корочайший путь, вот у вас граф и вот какой-то
корочайший путь. Есть много других путей, ну а по ним никто не едет. У нас вот одна корреспонденция,
ну так сказать для простоты, вот я сейчас считаю, что одна корреспонденция и живет, как правило,
настигается на каком-то одном пути, не обязательно, но может на нескольких путях, сейчас это не очень
принципиально, но давайте вот конкретно на каком-то пути достигается. Дальше вопрос, а как посчитать,
соответственно, как посчитать, ну соответствующий вектор потоков? Ну очень просто, давайте просто
посмотрим, а на каких ребрах достигается, если есть одна корреспонденция, на каких ребрах
корочайший путь реализуется? Если ребро ТЕ входит в этот корочайший путь, значит соответствующая
производная по ТЕ будет равняться единице, и поскольку у меня корреспонденция ДЕЖ, то есть у меня весь
поток, вот он так идет, то я, то я соответственно должен просто сказать, что поток через это ребро,
если производная не ноль, то есть это ребро входит в корочайший путь, значит тут будет единичка, и
вся эта единичка умножается на ДЕЖ, то есть весь поток ДЕЖ, который хочет ехать, он просто пойдет по
вот этим ребрам, и действительно поток на этих ребрах, которые входят в корочайший путь, и по
которым производная не ноль, будет равняться ДЕЖ. Ну понятно, что ситуация, когда у вас несколько
корочайших путей, вот два корочайших пути, она сложнее, потому что у вас как бы получается,
что вы можете, как объяснить, то есть у вас два корочайших пути для заданного вектора затрат,
и вы можете в принципе, как бы это объяснить, потоки распределить так, что соответственно все поедет
здесь, все поедет здесь, или какая-то выпуклая комбинация, но вот это и есть, вот это отражается
вот в этом вот, что супер дифференциал, это на самом деле есть какие-то вот, так сказать,
крайние точки, дальше любая выпуклая комбинация, вот как в случае модуля х, вы имеете вот этот
вектор, вот этот вектор, ну и любой вектор из этого суб дифференциала, он есть выпуклая комбинация
вот этих двух крайних, вот, и вот роли этих крайних векторов будут играть, собственно, вот эти маршруты,
сколько этих векторов будет? Ну, вот определяет сколько этих корочайших маршрутов, на которых
одинаковые затраты, но как бы понять этот результат, я думаю, можно проще всего, если вы будете
считать, что у нас один корочайший маршрут, и тогда понятно, что те ребра, и только те, которые входят
в этот корочайший маршрут, они будут входить в этот вектор, то есть он будет состоять, вектор
производных будут состоять просто можно дж вынести и нолики единички единички будут стоять только на тех местах
ну которые отвечают к кратчайшему пути вот а если у вас их много корреспонденции то
соответствующая корреспонденция будут вот так они распределяться и дальше суммироваться и вносить общий вклад ну а если в свою очередь
у вас еще для задной корреспонденции
несколько кратчайших путей то внутри вот этих кратчайших путей
поток в принципе
ну во всяком случае
то сказать чисто формально вот можно брать
любой элемент
суб дифференциала то есть это условие будет выполняться потому что
сейчас это то есть я понимаю вы можете сказать что ну так не работает то есть если все поедут по одному пути
затраты поменяются на эту же вопрос другому месту это вопрос состыковки этих двух моделей то есть
формально вот в этом месте т зафиксированы и я не учитываю обратную связь
если я весь поток пущу по одному ребру по одному пути то это поменяет и да это вот поменяет и это вот в этом месте
сидит но меня то сейчас я изучаю только этот переход и в этом переходе т заморожено то есть
проще говоря у меня есть как бы два
два таких то сказать перехода что т
порождает f
согласно формуле
значит
т е равняется
стигма е штрихов е да а с другой стороны с другой стороны
f порождает t
правильно вот смотри час будет очень красиво
как говорила говорит о огородский учиться катарсис ну должен случиться катарсис а
это формула вот такая f точнее
ну я неправильно и писала это не фе и я кстати вот плохо что никто не поправил f вектор
потому что а как бы ей это значит был здесь эту компоненту написать вот тут просто вектор потому что это тоже вектор а
е-тоя компонента
она как бы ну я проводила рассуждение говоря что вот соответственно если теста ходит то значит здесь будет стоять
Ну, соответственно, при взятии супер дифференциала будет стоять единичка, потому что зависит от ТЕ.
Ну, то есть, минимум, что такое минимум? Просто подставляется кратчайший путь. Вот и все,
а это зачеркивается. Вот что такое минимум. Подставляется кратчайший путь. Если в кратчайшем
пути это единичка, то понятно, что он будет входить. Все остальное я забываю. То есть,
как бы объяснить. Вы берете минимум. Если минимум достигается только при одном П со звездой,
я этот минимум зачеркиваю и просто его дифференцирую. Вот у меня и получается
производная по ТЕ. Там будут векторы из нулей единички, единички будут только там, где вот это вот.
Если минимум достигается на нескольких П, то как бы я могу дифференцировать и то, и другое,
и вот так же, как с модулем Х. То есть, одна линейная функция пересекается с другой.
Минимум из них. Модуль Х это минимум из х-х. Вот аналогичная ситуация здесь. То есть,
если минимум достигается на нескольких, то я как бы должен брать и отсюда производную,
отсюда и уже комбинировать. Ну что делать. Ладно, это просто полезно. Вот зачем вы
поклонались, нужен в жизни. А сейчас самое красивое. Итак, я по Т порождаю F согласно
модели вот этой вот. А потом по F порождаю T согласно модели второму переходу. Значит,
это условие, это значит физика процесса, физика, а это экономика. Экономика. Это принцип Нэша.
Принцип Нэша вардропа. То есть, физика заключается в том, что у нас есть некоторая зависимость.
Но помните безопасное расстояние, там вот это все. Вот эта физика определяет, что водители,
вообще говоря, ну как бы сказать, стараются держать безопасное расстояние, если скорость
высокая, они стараются его держать побольше. Ну и вот тут это отражено в этой зависимости. А вот это
просто рациональности участников движения, что кратчайший путь каждый выбирает. И вот как это
отражается на связи вектора потока с T. Но проблема в том, что T не понятно, что такое здесь. То есть,
T заморожен. Но зато понятно, что такое T здесь. T выражается через F. Итак, нам надо найти неподвижную
точку, где F, соответственно, есть ну вот элемент супер дифференциала вот этой вот штуки.
D, J, T. D, J, T от T. Вот. И J принадлежит от D. Такая оптимизация в действии. Вот что бы вы делали,
чтобы найти эту неподвижную точку? Вот что бы вы делали? Да, да, да, да. А если вы знаете,
выпукла анализ, что бы вы делали? Это если вы знаете анализ данных, вы бы так делали. А я говорю
именно оптимизацию. Если вы знаете оптимизацию, вы бы подумали, вот, наверное, о чем. А можно
придумать такую задачу, такую задачу, которая бы как бы давала вам вот это вот как условия
минимума. То есть можно ли придумать задачу, например, по T так, чтобы вот эти два условия,
они как бы были связаны с этой задачей. Решение этой задачи оптимизации давало бы неподвижную
точку вот этого перехода. Давайте пофантазируем. Вот давайте просто возьмем задачу вот такую.
Стума D, J, T. D, J, T от T. Ну то есть я просто пишу то, что здесь написано. То есть просто обратите
внимание, здесь дифференциал и здесь дифференциал. Совпадение, не думаю, это не совпадение. Это так
специально подбиралось. И мы сейчас это с вами, значит, поймем. И давайте здесь введем функцию
sigma e со звездой te. Что это такое за функция? Ну, чтобы понять, что это такое за функция, надо
инвертировать зависимость. Вот эту зависимость хочется инвертировать. Ее можно инвертировать.
Написать, что f e равняется, ну давайте просто так введем такое обозначение sigma e со звездой
от te. Вот так. На самом деле это действительно сопряженная функция, но просто я сейчас написал,
что f e равняется, вот как бы инвертировал эту зависимость. Ну сейчас я немножко неаккуратно
сказал, мне надо это будет как бы... Вот я думаю, я сейчас это просто поясню немножко более аккуратно,
так будет понятнее. То есть сейчас тороплюсь, потому что у меня времени немного остается, хочу успеть.
Ладно, не будем торопиться, а то запутаюсь и вас запутаю. Значит, давайте я такую задачу напишу,
которую написал. Е принадлежит вот так. Ну задача на максимум. На максимум по te. Ну как
будет выглядеть условие максимума в этой задаче, если просто на тему ничего не накладываем. Ну
значит надо взять производную и просто приравнять нулю, правильно? То есть не производная, а суп
дифференциал, супер дифференциал. Значит d от суммы значит d изжитая, t изжитая от t. То есть
вот уже что-то знакомое. Изжитая значит od. Ну и здесь равняется сумма фигма e со звездой штрих
на te. Ну e принадлежит e. Давайте как бы посмотрим, что нам предписывают два условия, которые написаны,
которые написаны были ниже. Эти два условия предписывают, что вот f должно равняться вот этому.
Ну значит я могу сказать, что вот этой f, какой это f. С другой стороны, с другой стороны вот эта вот
штука. Она, значит, как бы можно так написать. Можно написать, что fe, давайте вот последовательно,
это есть стигма e штрих в минус 1 как бы от te. Вот так да? Стигма e штрих в минус 1 от te. Ну обратная
функция, я не знаю как это красиво написать. Вот сейчас она как-то. И тогда я могу тут написать,
что если вот вот эта функция, вот эта функция. Сигма e со звездой штрих от te равняется, если
равняется вот тому, что там написано. Сигма e штрих минус первое от te. Вот если это верно, то
решение вот этой задачи, решение-свездочка, то решение-задача-звездочка, решение-звездочка
совпадает с неподвижной точкой. Совпадает, совпадает, совпадает с неподвижной точкой. Это,
вообще говоря, вот так задумываться очень-очень интересная конструкция. То есть я пока еще не
решил проблему. Я как бы сказал, что давайте придумаем такую задачу выпуклой оптимизации,
вогнутой максимизации, которая бы вот эти два условия на неподвижную точку. То есть как бы
ясно, что это два уравнения на две группы переменных. И как-то их надо разрешать. И вот
хочется придумать такую задачу, пользуясь некой потенциальностью этих уравнений, что вот тут te
равняется градиенту некоторого поля, а тут f равняется ну не градиенту, но суб дифференциалу
некоторого скалярного поля. То есть хочется, здесь тоже скалярное можно написать, то есть как бы
t есть градиент значит вот этой вот функции сумма sigma e. Так вот, как бы если нам удастся подобрать,
если нам удастся подобрать такую функцию, что вот это верно sigma со звездой, то, ну так собственно
можно так и делать. Такую функцию можно sigma e со звездой так и взять. Просто это неудобно,
то есть неудобно так работать, что такое sigma с штрих минус первое. Вот, ну то есть это как бы,
ну это tau минус первое по сути, да, то есть это вот обратная функция от tau, она монотонная. Но
хотелось бы как-то более изящно эту функцию выписать. И тогда проблема решится, то есть тогда мы
действительно получим задачу вогнутой оптимизации в пространстве t. Решение t задачи порождает t,
t порождает f, ну и как оказывается, когда мы порождаем f по этой формуле, мы автоматически находим
кратчайшие пути, потому что значит знание f однозначно определяет, вообще говорят, что тут как бы,
как оно получается, какие пути, то есть просто сама процедура. Сама процедура решения этой задачи
предполагает вычисления субградиента вот этой штуки. Ну и там, где этот субградиент каждого
отдельного слагаемого по ежи имеет 0 единицы, вот это и будет ребра входящие в кратчайший путь. То есть
мы кратчайший путь автоматически вытаскиваем вот отсюда. Нам не надо решать задачу в пространстве
всех путей, мы решаем задачу в пространстве числа ребер. И вот за счет того, что все сидит,
вся экспоненциальность сидит вот здесь, а здесь работает дейкстра, а дейкстра умнее действует,
он не перебирает вот этот минимум по экспоненциальному числу вариантов. Дейкстра не
перебирает экспоненциальное число маршрутов, он находит кратчайший маршрут как бы хитро,
это называется линейный минимизационный аракул. То есть решить задачу скалярное произведение
набора вектора какой-то дельта, давайте назовем его p на t, вот эта задача, казалось бы, она
очень большая, потому что надо искать минимум по всем путям и просто надо реально читать скалярные
произведения, если вы на это смотрели как оптимизатор, но если вы специалист по компьютеру
science, вы не будете так на эту задачу смотреть, вы будете смотреть на нее с помощью дейкстра,
и это дает возможность убить эту колоссальную размерность, но осталось понять, что все-таки это
за функция такая, потому что sigma штрих e-1 это как-то некрасиво. Для этого я вожу вот такую
функцию sigma со звездой от e, которая определяется как сопряженная функция ко f e, то есть эта
функция есть максимум от t e f e минус sigma e f e, вот такая вот функция. И давайте поймем, что
действительно эта функция удовлетворяет нужному свойству, то есть это сопряженная функция к функции
sigma e f e, то есть я обозначение не случайно выбрал. Давайте найдем производную этой функции по t e,
значит sigma штрих sigma e с звездой штрих от t e, значит это формула Демьянова-Данскина,
я сейчас ее приведу. Как дифференцировать максимум? Вот у вас есть максимум, максимум по t
от некой функции f большое от f, давайте не f большое, g большое от t f, по аргументу вот,
максимум по t я хочу взять производную по, нет, максимум по f, максимум по f, а производную я
хочу взять так вот, g маленькая от t равняется максимум по f от g большое, а я хочу найти g
штрих от t, как я это буду делать? Градиент, хорошо, градиент g от t, я это делаю таким образом,
я говорю, что пускай максимум достигается на некой функции f, то есть это есть g от t от f со
звездой от t, f со звездой от t удовлетворяет условию, градиент по f от функции g от t f
со звездой от t тождественно равняется 0, это условие, соответственно, принцип фирма,
то есть это условие у меня находится f со звездой от t, ну и когда я пишу градиент g от t,
это есть, соответственно, градиент по t функции g большое от t от f, и я дальше использую формулу,
ну f от t, f со звездой от t, и дальше я использую формулу дифференцирования сложной функции,
то есть я пишу, что это есть градиент по t g, ну то есть давайте так сразу напишем gt от t f со
звездой от t, вот штрих, плюс, соответственно, плюс что? Плюс градиент g по f, ну там на самом деле
конечно надо писать в обратном порядке, но это неважно, значит, вот по-хорошему надо писать так,
градиент f со звездой, значит, но это то, что векторное поле это будет на самом деле матрица,
потому что это вектор, вот так вот напишу, но это матрица, то есть векторное поле дифференцируется,
эта матрица умножается на вектор, который есть градиент f на g, ну и там аргумент вот такой,
значит, t f со звездой от t, так, вот это формула дифференцирования сложной функции, ну и что вы
можете теперь сказать относительно того, что в итоге получается, а в итоге получается, что это
то 0, тождественный, поэтому это просто есть g, ну давайте я все-таки буду использовать
единое обозначение, градиент частная производная этой штуки по t, то есть это просто есть dg по dt от
t, от f, где f равняется f со звездой от t, вот так, если аккуратнее говорить, ну естественно,
я это все делаю в случае, когда все дифференцируемо, здесь у меня как бы это предположение выполняется,
потому что у меня эта функция есть интеграл, а то и, в общем, вот эти всякие субдифференциальные
оговорки, они здесь не нужны, вот поэтому я могу написать, что sigma со звездой te равняется,
равняется просто fe, просто fe, где fe есть решение уравнения, где fe получается из условия вот
этого условия, из условия, что, ну соответственно, по fe приравниваю производную нулю и получаю te
равняется sigma штрих, sigma штрих e от fe, но это есть не что иное, это есть не что иное, как,
как просто te от fe, то есть, то есть, смотрите, что получается, если я хочу инвертировать уравнения
te равняется tau e от fe и просто написать, что fe это есть tau e минус 1 от te, то я как раз могу написать так,
что fe это есть sigma со звездой e от te, вот как, здесь sigma со звездой определяется вот таким образом,
и тогда, тогда все схлопывается, то есть, я действительно понимаю под звездой буквально
преобразование фенхеля или жандра, то есть, сопряженная функция, и мы получаем альтернативную
форму записи модели, как так получилось прям, что со звонком, мы получаем альтернативную форму
записи модели Бэтмена в варианте, в варианте, который вот называется вариантом стабильной динамики,
точнее нестрады пальма, и вот почему он так называется, мы будем в следующий раз говорить,
потому что на самом деле, ну это как бы одна и та же задача, но вот уже с этой задачей намного
удобней бывает работать, почему, потому что обратите внимание, что эта задача в пространстве столько,
сколько ребер, а эта задача в пространстве числа путей, это первый момент, второй момент,
в этой задаче я могу делать всякие трюки, которые в той делать сложно, а именно, я могу переходить
к пределу по свойствам функции тау-е-фе, то есть, в частности, я могу ее вырождать и делать вот
просто такую вот константа, потом бесконечность, оказывается, это очень даже имеет смысл делать,
вот здесь так не пройдет, если я здесь буду делать, у меня будет взрывающийся потенциал, и,
точнее, так формально делать можно, но обосновывать проще через двойственную задачу, ну и анонс тоже
такого как говорится вкусного, вот в следующий раз, пользуясь вот этой вот постановкой, я поясню
вообще вот этот вот механизм платных дорог, как правильно выбирать платные дороги, я сегодня
хотел это сделать, у меня не хватило времени, вот, но сегодня успел сделать важную вещь, вот посмотрите
в итоге, что здесь получилось, это реально и красиво, и поучительно, потому что изначальная задача,
она вообще вот такая, она вообще как бы, причем тут оптимизация, причем потом она оказалась задачей
оптимизации, а в конечном итоге, она оказалась еще задачей оптимизации в пространстве существенно
меньшей размерности, и вся сложность схлопнулась в кратчайшие пути, оно и понятно, кратчайшие пути
должны были где-то всплыть, потому что, ну как бы рациональность, что означает, что все выбирают кратчайшие
пути, и странно, что здесь этого не было, а вот здесь уже двойственная задача, это явно всплыло и
убило размерность, размерность теперь адекватная, и чтобы найти вектор х, нам просто надо по походу
вычислений, правильно, вот когда мы оцениваем супер дифференциал, восстанавливать вот эту
информацию, это делается, у меня в принципе все, если вопросы, вообще я быстро, да, сейчас уже во второй
половине, ну по понятным причинам, все-таки хочу, чтобы на лекциях мы что-то новое узнавали, они
каждый раз одни и те же формулы писали, но поскольку это все есть на youtube, там есть такая опция, вы
можете помедленнее включить, и я буду говорить вот так вот, но зато вы будете успевать, ну я надеюсь
субградиентным, но там есть хитрости некоторые, то есть да, грубо говоря, ответ да, вот эту задачу уже
можно решать в некотором смысле неким градиентным спуском, точнее подъемом, потому что задача на
максимум, ну да, да, то есть надо решать определенным прямодвойственным методом, оказывается, что, ну мы чуть-чуть
про это будем говорить, тут есть варианты, когда можно даже ускоренные методы использовать, но это все в
будущем, да, то есть вот уже здесь, да, градиентные методы, как говорят, рулят, то есть они здесь уже
прям полезны, здесь есть некая проблема с их использованием за счет того, что множество x какое-то
хитрое, там-там-там-там его нет, а тут оно хитрое, и здесь не любой метод работы, здесь фрэнк вульф
используется, я об этом буду отдельно говорить, то есть все это просто отдельная история, хорошо,
коллеги, у меня все, да, спасибо.
