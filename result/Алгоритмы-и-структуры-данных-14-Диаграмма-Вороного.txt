Сегодня всерьез поговорим про диаграмму Воронова.
Задача называется обычно post-office problem.
Представьте, что мы живем на плоскости.
Город – это плоскость.
В городе есть n почтовых отделений, которые в каких-то точках плоскости расположены.
П1, П2, и так далее по n.
Да, земля плоская у нас, живем на плоскости, и вот есть всего n почтовых отделений.
Ну и нам надо понять, для каждого человека, если он хочет сходить на почту, то какое для него ближайшее почтовое отделение?
То есть мы хотим в каком-то смысле разбить всю плоскость на n кусочков,
так чтобы каждый кусочек говорил, что здесь ближе всего ходить сюда, на вытое отделение, для каждого i.
Люди – это все точки.
Люди – это все точки, да, типа мы живем на плоскости, но в какой-то точке человек прикреплен,
и надо выбрать ближайшее почтовое отделение из этих n.
Давайте картинку какую-нибудь нарисуем конкретную.
Такое, если будет, тогда картинка будет какая-то вот такая.
Значит, вот 5 почтовых отделений.
Ну и соответственно, грани вот этого вот плоского разбиения, плоскости на какие-то куски,
вот первая, вторая, третья, четвертая, пятая – это, собственно, те ячейки, которым предписано ходить в такое-то отделение.
Здесь всем товарищам выгоднее всего приходить в первое, здесь во второе и так далее.
Чувакам на границе одинаково выгодно ходить в те почтовые отделения, на границе которых они лежат.
Скажем, вот этим чувакам одинаково близко идут по 1 и по 2,
а вот этому чуваку, например, одинаково выгодно и по 2, и по 3, и по 5.
Ну, все, соответственно, определение, что пусть у нас P – это набор каких-то точек на плоскости,
по 1 и так далее Pn, для каждого I мы определяем ячейку диаграммы Варанова V от Pi,
как множество таких точек плоскости, для которых расстояние до этой точки меньше, чем до всех остальных.
Дист, купе итое, меньше ли обравно, дист, купе житое, для любого жи.
Вот это ячейка диаграммы Варанова.
Итое. Ну, соответственно, вся диаграмма Варанова – это набор ячеек просто.
Ну, давайте напишу, что это P и набор ячеек V от P1 и так далее V от Pn.
Вот, собственно, наша задача по P, по набору почтовых отделений, описать структуру всех ячеек.
Вот, значит, для тех, кто только присоединился, я напоминаю задачу, которую мы уже когда-то видели,
что у нас есть на плоскости n точек P1, P2 и так далее Pn.
Мне нужно для каждого I определить те точки плоскости,
которые ближе всего к итое точке, чем ко всем остальным.
Что расстояние DUP и меньше ли обравно расстояние DUP и жи.
Вот, поскольку здесь я уже много раз сказал слово «точка»,
давайте разделим, давайте вот эти вот P-шки будем называть сайтами.
Ну, от английского «сайт», просто «место» какое-то.
Ну, не обязательно «сайт», который вы на интернете, просто какая-то локация.
«Место». Вот.
Ну, все остальные точки будем называть точками на плоскости,
чтобы вот отличать точки, которые деление, которые P-шки.
Вот просто точек.
Я веду отдельное слово для точек измножения, на которые мы устроим диаграмму.
Ну, вот.
Значит, давайте докажем следующее простое утверждение про устройство нашей диаграммы.
Кстати, мне нужна лемма.
Давайте так попробуем в этот раз.
Ну, мы с вами понимаем, что...
Мы с вами уже видели, что каждый ящик из диаграмм Вороноу
это пересечение на институтной полуплоскости,
поэтому там это выпуклые фигуры,
каждая из которых либо какой-то многоугольник, либо полоса, в худшем случае.
Если две вот такие полуплоскости пересекаем, то полоса получается.
Значит, ну вот, лемма.
Я утверждаю, что в многоугольных фиграх на институте
в ней не есть intensive function.
Я утверждаю, что в диаграмме Воронова соседние многоугольники
стыкуются ребро в ребро.
Это значит, что если два многоугольника пересекаются, то они пересекаются по ребру или по точке.
То есть, грубо говоря, не бывает вот таких вот картинок.
Давайте что-нибудь вот такое нарисую.
Один многоугольник, другой многоугольник.
И третий выглядит как-то вот так вот, например.
То есть, не может быть такого, что пересекающиеся многоугольники пересекаются по...
Ну, не полностью по ребру.
То есть, скажем, вот этот и этот пересекаются по части ребра.
Вот. Я утверждаю, такого не бывает, что любые многоугольники, если пересекаются,
то либо полностью по ребру обоих многоугольников, либо по точке.
Значит, давайте это пропишем, что пересечение двух многоугольников
это либо ребро обоих, либо вершина обоих. Вот так.
Ну, доказательство простое.
Давайте посмотрим, что такое пересечение двух ячеек, двух многоугольников.
Вот оно пересечение.
То есть, я утверждаю, что они пересекаются обязательно по куску серпера между ними.
Между сайтами, которые их задают.
Кусок серединного перпендикуляра.
ПИ и ПЖ.
Ну, понятно почему.
Потому что точки здесь лежат равноудаленно от ПИ и ПЖ,
поскольку они лежат в обоих многоугольниках, значит, они равноудалены,
поэтому они не на серпере.
Если я нарисую такую прямую, разделяющую ПИ и ПЖ на два равных кусочка,
на отрезок, пересекающий пополам, то как раз вот граница разделения как раз на серпере лежит.
Ну и все, а дальше давайте скажем следующее.
Пусть, например, давайте выделим пересечение, относящееся к ПИ.
Давайте рассмотрим любую другую точку.
Ну, окей, давайте предположим...
Сейчас.
Значит, давайте скажем, что пусть АВ – это их пересечение.
Давайте рассмотрим какую-то другую точку С вне этого отрезка
и докажем, что она должна одновременно принадлежать обоим многоугольникам или не принадлежать.
То есть как раз вот такой плохой ситуации не бывает, потому что что здесь плохо?
Вот если я эти два пересеку, у меня границы пересечения будут АВ,
а есть такая другая точка на этой прямой, лежащая в одном, но не в другом.
Вот я уже такого не бывает.
Ну а что?
Если я возьму точку на этой прямой, то она одновременно либо лежит, либо не лежит в обоих.
Вот давайте пойдем от противного.
Пусть есть такая точка, ну или не обязательно от противного.
Вот возьмем точку вне этого отрезка.
Значит, она с одной стороны равна удалена от ПИ и ПЖ.
С другой стороны, да, давайте пойдем от противного.
Пусть она лежит в одном из них.
Значит, пусть С не на отрезке АВ, пусть С, ну скажем, лежит в житой ячейке диаграммы Воронова.
Значит, тогда это значит, что расстояние от С до ПЖ меньше всех остальных расстояний.
Значит, расстояние от С до ПЖ меньше либо равно расстояние от С до ПК для любого К.
Ну раз она лежит в такой-то ячейке, то значит ПЖ-то самое близкое.
С одной стороны, с другой стороны, эта штука очевидно равна расстоянию от С до ПИ,
потому что С на серпере.
Ну раз она на серпере, то равна расстояние одинаковое вот эти вот.
Ну значит, для ПИ тоже верно.
Значит, для вот этой штуки верно то же самое.
Ну раз эти две штуки равны, а эта штука меньше всех остальных расстояний,
то эти два минимума, они всех остальных меньше либо равны.
Ну значит, С обязана лежать в и-то ячейке тоже,
потому что расстояние до нее меньше, чем до всех остальных,
поэтому она лежит и там и там одновременно.
Вот, значит, если есть какая-то точка, лежащая в одном из них,
то она обязательно и в другом.
Поэтому пересечение, пересечение на этой прямой может быть только вдоль какого-то отрезка,
который и там и там лежит, но это, собственно, ребро.
То есть не бывает вот таких вот продолжений в одну из двух сторон, у одного из них.
Вот, хорошо.
Ну отсюда, собственно, следует, что у нас не бывает вершин на ребрах.
То есть, собственно, вот таких картинок не бывает, что вот у меня здесь была вершина,
которая одновременно как бы является вершиной двух многоугольников,
а вот здесь это не вершина.
Такого в нормальном случае не бывает.
В нормальном случае картинка какая-то такая,
что если какая-то точка является вершиной кого-то,
какого тут многоугольника, какой-то ячейки,
то она также является вершиной всех остальных смежных с ней многоугольников.
То есть картинка какая-то вот такая только, может быть.
Вот эта точка, она граничная точка...
Ну, граничная вершина всех многоугольников, которые ее содержит.
содержит. Вот, ну отсюда можно такое утверждение
сформулировать. Во-первых, если все точки P лежат на
одной прямой, то, значит, диаграмма Воронова это
просто N-1 параллельных прямых. Во-вторых, иначе, ну тут
давайте так сформулируем. Во-первых, не бывает, короче,
все ребра, они либо отрезки, либо лучи, то есть не бывает
полностью бесконечных ребер в виде прямых, все ребра
отрезки или лучи. Во-вторых, диаграмма связана. В-третьих,
количество вершин в диаграмме не больше, чем 2N-5, а ребер
не больше, чем 3N-6. Ну связано, это значит, что, ну как
раз, да, типа если мы рассматриваем вот все, все граничные точки
всех многоугольников, то можно от любой добраться
до другой, вот, двигаясь по точкам, по точкам границ.
Ну, первое вроде очевидно, если есть какая-то прямая,
давайте ее для удобства нарисуем горизонтальной,
на которой лежат все наши точки, то что такое диаграмма?
Ну понятно, надо просто между соседями провести серперы.
Между соседями проводим серперы, это и будет разбиение
на ячейке диаграмма Воронова. Там, потому что не нужно
между всеми провести середину критикуляра, чтобы построить
ячейки, но понятно, что ближайшие серперы к данной, это вот
два соседних. Здесь как раз будет N, у нас одна
параллельная прямая, она разделяет плоскость на
N кусков, в каждом куске ближайшая, это вот одна из точек,
это одна из сайтов. Теперь интересный случай, пусть не
так, пусть не все точки на одной прямой, давайте
покажем, что у меня не бывает ребер вот в виде таких прямых,
то есть здесь проблема, ну не проблема, а выраженный
случай скорее, что в качестве ребра выступает прямая
полностью, прямая целиком, весь серпер целиком между
двумя сайтами. Давайте покажем, что такого не бывает в случае,
если не все на одной прямой. Давайте предположим, что
есть какие-то P и Pg, что серпер между ними полностью является
куском границы вот обеих ячеек, то есть они пересекаются
по прямой, не то что там два многоугольника, а вот
именно разделяющая их прямая, это граница обоих ячеек,
обеих ячеек, и для P и для Pg. То есть вот эта вот вся
бесконечная прямая одновременно лежит в ячейке P и в ячейке
Pg. Ну тогда давайте возьмем любую другую точку, не лежащую
на прямой P и Pg. Вот здесь я нарисую. Пусть Pk не лежит,
ну давайте так нарисуем на прямой P и Pg. Вот давайте
нарисуем какой-нибудь серпер, ну например между P и Pk.
Вот давайте я к этому отрезку нарисую в середине
препендикуляра. Вот как-то он так пройдет, наверное.
Значит это значит, что у меня вот это вот, ну во-первых
у меня точно пересекутся эти два середины препендикуляра,
потому что я провожу прямые, перпендикулярные к непараллельным
прямым. То есть я взял P и Pg, P и Pk они не параллельны,
потому что Pk не на прямой, значит я провел серпер, они
точно пересекутся. Ну вот, и тогда понятно, что у
меня вот эта вот вертикальная прямая разбилась на два
куска сверху снизу, условно говоря. Понятно, что хотя
бы один из кусков не может лежать, скажем, в ячейке
Pi, потому что все эти точки ближе к Pk, чем к Pi. То есть все
вот эти точки, которые по предположению лежат одновременно
в обеих этих ячейках, они должны лежать вот здесь вот,
ну то есть они должны прихрепляться к ячейке V от Pk. Должны быть
V от Pk. Ну противоречие, а мы сказали, что эти штуки
лежат на границе между Pi и Pg, значит больше другим
ячейкам не принадлежат. Похоже? Хорошо, значит у меня прямых
не бывает. Бывает у меня только соответственно отрезки
и полубесконечные ребра, ну то есть лучи. Если у меня
грубо говоря, если я нарисую какой-нибудь треугольник
в качестве сайтов, то у меня как раз диаграмма будет
примерно вот такой вот. У меня будет одна вершина,
и здесь три полубесконечных луча, разделяющие соседние
пары точек, соседние пары сайтов. Так, теперь давайте
докажем связность. Значит это был пункт A, пункт B, значит
про связность. Давайте сначала докажем связность
границы каждой ячейки по отдельности. Связанность
границы каждой ячейки по отдельности. Ну вроде тоже
понятно, потому что мы знаем, как у нас тогда устроены
ячейки. Мы знаем, что в ячейках у нас нет бесконечных
ребер, ну бесконечных прямых точнее, значит любая ячейка
как раз не полоса. Если бы она была полоса, у нее как
раз была несвязанная граница, потому что с одной прямой
я на другую перейти не могу. А иначе, значит у меня
каждая ячейка, это многоугольник, ну или какой-то там обобщенный
многоугольник, да, такой полубесконечный вот куда-то
в одну сторону. Ну понятно тогда, что он связан. Любая
ячейка это обобщенный многоугольник. Понятно, что его граница
связана, можно из любой точки границы многоугольника
дойти до любой другой. Нет? Почему связана? Ну смотрите,
мы рисовали все возможные ситуации, как может выглядеть
пересечение полуплоскостей. Это там либо полуплоскость,
либо это полоса, либо многоугольник, либо такой обобщенный многоугольник,
как бы задающийся по факту вот этими вот двумя полуплоскостями
пересекающимися. Вот. Как-то еще ограниченный вот на
какую-то подобность. Почему это связано, вы спрашиваете?
Можно мы поверим, пожалуйста, в это? Ну типа, ну надо понять,
что такое обобщенный многоугольник. Значит, вот именно, что есть
вот эти вот две полубесконечные прямые, которые на самом
деле где-то пересекаются, но они еще могут быть параллельны,
да. Ну короче, ну блин. Ну по картинке понятно. Вот.
Ну и наконец третья. А, пардон, это мы доказали связанность
границы, да, только? Ну, показали, окей, показали связанность
границы каждой конкретной ячейки. Теперь давайте докажем
связанность полностью графа. Вот если у меня есть какой-то,
так как это выглядит, ну что-то такое, наверное. То есть у
меня есть вот такая диаграмма. Вроде более-менее похоже,
что это диаграмма Воронова. Значит, как доказать, что
она связана, ну вот как граф, да, то есть что я с точки любого
ребра могу добраться до любой другой точки любого
другого ребра. Ну давайте просто возьмем две точки,
А и Б. Давайте проведем отрезок между ними. Вот. Понятно
тогда, что этот отрезок подразбивается на какие-то
куски, ну как бы он пересекается с какими-то ячейками. Давайте
рассмотрим пересечение этого отрезка с каждой ячейкой.
Мы сначала находимся в одной ячейке, потом переходим
в другую, потом заканчиваем в третьей. Ну понятно, потому
что каждая точка плоскости лежит хотя бы в одной ячейке,
значит наш отрезок как раз подразобьется на конечное
количество таких кусочков. Ну и дальше внутри каждой
ячейки мы знаем, что граница связана. Я могу дойти отсюда
до сюда с помощью, скажем, вот такого пути, потом отсюда
до сюда по границе вот этой ячейки могу дойти по такому
пути, ну и здесь отсюда до сюда могу дойти по границе
вот такого вот, по вот этому куску. Что? Доказать. Нет,
это легко формализовать при чем, типа ну то есть пусть
у меня есть две точки A и B на границе каких-то многоугольников.
Пройдем отрезок. Это отрезок конечной длины, пересечем
со всеми ячейками. Будет конечное количество отрезков
пересечения, потому что мы пересекаем отрезок и многоугольник,
это выпуклая фигура, значит мы получим под разбиение
отрезка на выпуклая фигура, на отрезке. Каждый отрезок
полностью служит в какой-то ячейке. Еще раз? Ну я пересекаю,
вот я взял отрезок A-B, давайте его пересечем там вот с этой
ячейкой. Получишь или пустой множество, либо отрезок. Да,
ну все, и как бы тогда я могу срезать вот этот путь по
границе. Ну как бы вот эти две точки связаны, грубо
говоря. Потом пересекаю это там вот с этим, вот эти две
точки связаны, ну и все. Вот, значит давайте напишем,
что если A-B лежат на границе каких-то многоугольников,
на границе каких-то ячеек, то отрезок A-B разбивается
на отрезке целиком лежащего в одной из ячеек. Ну значит
есть путь. Нормально? Вот, значит остался пункт про
линейность количества вершин и количества ребер. Вот,
но если мы доказали связанность, то мы можем пользоваться
формулой Эйлера. А формула Эйлера существенно важна
связанность. То есть пункт В, формула Эйлера, значит она
говорит нам, давайте словами напишу, что количество вершин
плюс, пардон, минус количество ребер плюс количество
граний в плоском связанном графе это два. Что вы орете?
Ладно, значит вроде правда. Вот, значит с этим надо
разобраться, потому что там, ну как бы здесь ребро
это что-то полубесконечное не очень хорошо. Да, именно
так. Значит давайте мы наш граф просто как-нибудь
ограничим. Давайте возьмем достаточно большой квадрат,
который содержится внутри себя все вершины и все конечные
ребра. Соответственно, который пересекает только полубесконечные
ребра, уходящие куда-то в пространство. Возьмем достаточно
большую коробочку, поместим нашу диаграмму, которая там
бог знает как выглядит, что-то вот такое. Вот. И соответственно
сделаем так, что она пересекается только с вот этими лучами,
с полубесконечными лучами. Вот. Значит, что тогда? Давайте
сделаем следующее. Давайте я, то есть смотрите, я знаю,
что у меня вершинами этого графа выступают как раз-таки
вершины диаграммы, не сайты, а вот именно вершины
многоугольников, которые получаются как ячейки. То есть
вот этой вершины, давайте я введу еще одну новую вершину
где-нибудь далеко и соединю как бы вот эти вот все
полубесконечные ребра, доведу до этой точки. Вот я сделаю
вот так. С сохранением планарности графа. Вот я тоже
думаю, что это можно сделать, формально не буду расписывать,
но идея очень простая. Вот у вас есть квадратик, есть там
какая-то точка. Мне хотелось бы, чтобы все вот эти вот
лучи, пересекающие границу квадратика, можно было бы
замкнуть на вот эту точку. Ну в общем случае это можно
сделать как-то так. То есть каждую вот эту точку можно
просто отрезком соединить. Здесь явным образом написать
какую-нибудь формулу окружности или параболы, которые вот
так вот расширяются и друг с другом не пересекаются.
При этом как-нибудь ограниченные какой-нибудь вот такой
функции. Здесь то же самое. Ну и тут сверху тоже как-нибудь
явно очевидно можно прописать вот такие функции, которые
расширяются и не пересекаются друг с дружкой. Ну типа если
картинка есть, то можно какую-нибудь явную форму
нарисовать. Неважно. Вот. Вот, значит это я сотру, чтоб не
позориться. Вот. Теперь давайте с этим графом работать.
Все, это уже хороший, нормальный конечный граф на плоскости.
Для него можно применять формулейдера. Значит сколько
здесь вершин? Вершин видимо в плюс одна. То есть если здесь
было в вершин, то я добавил еще одну, стало в плюс одна.
Значит ребер. Видимо сколько было, столько и осталось,
потому что я просто до продолжил безконечные ребра, до
вот этой вот внешней вершинки с ребрами все сохранилось.
Ну и грани, я утверждаю, осталось столько же, а именно
n по количеству сайтов. Вот. Ну вот здесь, например,
на картинке у меня конечные грани остались конечными,
вот эти вот три. Дальше. Вот у нас были такие бесконечные
грани, я между ними еще вот эти разделители довел
и замкнул. Соответственно у меня там все грани, кроме
одной, стали конечными, осталась одна внешняя
грань, которая всю плоскость содержит. Их было изначально
n, потому что такое грань. Это ячейка по факту. Нет,
ровно. Ну если точки, если сайты все изначально различны,
то их ровно n. Ну да. Вот. Поэтому здесь как бы все грани
сохранятся, одна останется внешней, ну и хорошо. Вот.
Поэтому здесь можно писать формулейжера вот уже к такому
графу, ну и написать, что v плюс 1 плюс e, что такое,
минус e, плюс n, равно 2. То есть e равно, ой, v плюс n минус
1. Проверяйте. Вот нет, ровно n будет. Да, да, да, да,
одна из старых ячеек, вот в этом случае, вот эта вот
была ячейка, она стала внешней гранью всего графа.
Ровно n будет. Да, показали. Вот. Ничего, ничего, нормально.
Так, хорошо. Мне нужно еще показать следующий факт.
Мне нужно границу какую-то, ну в смысле верхнюю оценку
на них предъявить. Давайте я покажу следующее. Давайте
я скажу, что в этом графе, в этом графе, степень всех
машин хотя бы 3. Степень всех машин хотя бы 3. Вот.
Ну типа того, да, для внутренних, то есть для старых
вершин это почти тривиально, потому что мы знаем, что
вершина является вершиной всех вот стыкующихся в ней
многоугольников, да, поэтому если у меня есть какая-то
вершина, ну вот одна из этих старых, значит, к ней
примыкает несколько многоугольников, все углы этих
многоугольников при этой вершине меньше, чем p, ну
потому что это выпуклые многоугольники, да, имеющие
эту вершинку, поэтому здесь угол меньше, чем p. Ну значит,
нужно хотя бы 3 угла, чтобы покрыть все 360 градусов.
Вот. Поэтому с внутренними вершинами понятно, что здесь
хотя бы 3 должна быть степень. Для внешней вершины, ну
тоже мне нужно показать, что здесь есть хотя бы 3 ребра
вот в этой вершинке. Вот. Почему? Значит, мне нужно
показать, что bounding box пересекает хотя бы 3 вот эти
полубесконечных луча, потому что у меня степень этой
вершинки ровно такая, сколько было лучей, сколько было
ребер лучей. Вот. Почему таких лучей хотя бы 3? Ну давайте
скажем, что их пусть 2. Какие-нибудь вот такие вот 2
луча были всего лишь у нас в диаграмме. Значит, тогда
я утверждаю, что можно нарисовать полуплоскость, лежащую
вне bounding box и не пересекающие эти 2 луча. Вот эта вот
полуплоскость лежит вне bounding box и не пересекает
эти 2 луча. Почему можно? Ну, потому что раз их 2, то
между ними угол не больше 180 градусов. Ну, типа того,
да. Значит, угол между, то есть там можно их продолжить
до пересечения. Где-то здесь пересекутся. Здесь будет
какой-то конкретный угол. Значит, это все вложено в
какой-то угол. Надо взять, просто надо как бы, понятно,
нам надо ступить и взять вот другой кусок. Вот. То
есть получается, смотрите, есть какая-то полуплоскость,
которая ничего не пересекает, не пересекает никакое ребро
нашей исходной, нашей диаграммы. Значит, эта
полуплоскость, соответственно, целиком вложена в какую-то
ячейку. В какой-то VODPE. Ну, потому что как бы она ничего
не пересекает. Все эти точки где-то лежат в какой-то
ячейке. И если мы здесь не видим никакой граничной
точки ни одного многоугольника, значит, это все элементы
одной ячейки. Ну вот, и дальше осталось понять, что такого
не бывает. То есть у нас не бывает ячеек, которые содержат
целиком полуплоскость. Давайте это запишем, что не
бывает ячеек, ячеек, целиком содержащих какую-то
полуплоскость. Ну, у меня не все точки на одной прямой.
Как же они обсуждали. Почему? Ну опять, потому что у
меня каждая ячейка это обобщенный многоугольник.
Либо вообще конечный многоугольник. Понятно тогда, что он
полуплоскость, конечная, а полуплоскость бесконечная.
Конечность в смысле ограничена. Да, извиняюсь. Вот. Ну а
если есть какой-то обобщенный многоугольник вот такого
типа, то ну опять давайте вот эти вот две граничные его
стороны продлим до какой-то точки пересечения. Значит,
в частности, все это вложено в такой угол. Понятно, что
угол не содержит полуплоскостей. Да, то есть я как бы ну я
упростил задачу, говорю, что я рассматриваю немногоугольники,
такие углы бесконечные. Понятно, что здесь полуплоскостей
нет. Ну потому что чтобы полуплоскость лежала в угле,
ее прямая задающая как минимум должна не пересекать
обе эти прямые, потому что если пересечение, то есть
какая-то внешность угла. Ну а нет прямой, которая была
одновременно параллельна этим двум. Вот. Сойдет? Ну
типа порисовать на самом деле просто, да. Вот. И наконец
отсюда я могу сделать следующий вывод, что 2e больше
собрано, чем 3 на v плюс 1. Это я просто написал сумму
степеней всех вершин. 2e, потому что каждый ребро будет
учтено дважды, но это сумма степеней всех вершин.
Сумма степеней всех вершин. Она в точности равна 2e,
потому что каждый ребро учтется дважды от обоих своих
концов. И с другой стороны, эта сумма степеней хотя
бы 3 на v плюс 1, потому что мы показали, что каждый ребро
имеет, каждый вершин имеет степень хотя бы 3. Поэтому
верно вот это. Ну и все. Дальше мы знаем, что такое e.
И можно наконец написать, что 2v плюс n минус 1 больше
собрано 3v плюс 1. И отсюда уже получится нужная оценка.
Вот. Немедленно получили, что v не больше, чем 2n минус 5.
Ну и дальше, поскольку мы знаем, что e это v плюс n
минус 1, значит это не больше, чем 3n минус 6. Ура.
Так, хорошо. Значит у меня вся диаграмма линейная.
Вершин и ребер там максимум o от n. И можно как-то с этим
жить. Ну то есть в частности можно ожидать, что поскольку
у меня для хранения диаграммы достаточно линейной памяти,
потому что у меня линейное количество всего, то значит
есть надежда, что алгоритм будет какой-то близкий к
линейному. У нас будет n лог n. Да. Значит дальше, чтобы
переходить уже непосредственно к алгоритму, надо еще
вспомогательную одну штуку доказать. Значит определение.
Пусть у меня, как обычно, p это набор сайтов. Пусть q
точка плоскости. Тогда c от q, значит это максимальный
круг максимального радиуса с центром в q, с центром
в q, который внутри себя не содержит сайтов. Внутри
которого нет точек p. Вот это также называется пустой
круг с центром в q. Здесь какая-то точка плоскости. Мы
ставим сюда круг, раздуваем, раздуваем его, дожидаемся
момента, когда на границу попадает хотя бы одна точка
из p. Вот раздували кружок, дождались момента, когда
сюда попала p и вполне возможно одновременно с p и сюда
попала какая-то пж. Скажем, если q лежит на серпере
между двумя, то одновременно попадают эти две точки.
Вот этот круг называется максимальным пустым кругом
с центром в q. Вот и дальше в терминах этих пустых
кругов можно сформулировать следующий факт. Во-первых,
q это вершина диаграммы Воронова, то есть является
вершиной одного из многоугольников. Если и только если
q содержит на своей границе хотя бы три точки, хотя
бы три сайта, я имею в виду, ну понятно, внутри себя
он никого не содержит, потому что я беру максимальный,
внутри которого никого нет. Значит, если и содержит,
то только на границе. Поэтому я не прописываю, что на
границе можно только на границе содержать. Вот.
И во-вторых, кусок серединного перпендикуляра к P и P g участвует
в диаграмме. Ну, то есть хотя бы какой-то его кусок является
ребром хоть какого-то многоугольника. Ну да, то есть если это
серпер не бесполезен, на нем реально лежит какой-то
кусок границы. Вот. Если и только если существует
точка q на этом серпере, ну давайте, на этом серпере,
такая, что c от q содержит только P i и P g. Больше никого.
Да, да. Даже на границе никого больше нет. Да, это жестко.
Значит, ну давайте по шагам. Первое, слева направо.
Почему, если кувершина, то обязательно ее пустой круг
содержит хотя бы три сайта. Вот. Ну мы знаем, что кувершина
диаграммы Воронова, это вершина многоугольников.
Более того, мы знаем, что если вершина одного многоугольника,
то хотя бы трех сразу. То есть если q, это чья-то вершина вот
такого многоугольника, то обязательно все остальные
многоугольники, которые точку содержат, тоже для них
q – это вершина. Это мы доказывали, что у нас тык ребра в ребро,
поэтому q – вершина всех остальных, которые здесь есть.
Ну, и мы знаем, что их тогда должно быть хотя бы три.
тогда должно быть хотя бы 3. Ну а мы доказывали, что, типа, ну сумма этих углов
должна быть 360, с другой стороны, каждый из них меньше 180, поэтому здесь должно
быть хотя бы три вершины.
Три многоугольника.
Да, это не... Так лучше? Вот. Ну, значит, хотя бы три, потому что сумма углов
должна быть 360. Вот. Поэтому, поскольку Q лежит одновременно и в этом
многоугольнике, и в этом, и в этом, то она точно равно удалена от сайтов,
задающих эти самые ячейки. То есть Q точно лежит вот, равно удалена вот этих
трех, как минимум этих трех сайтов. Возможно, их там 4 и больше, если здесь
больше, чем три многоугольника стыкуются в этой точке. Почему не может быть
никого внутри? Ну, если бы внутри этого круга кто-то был, значит, Q была бы ближе
к этой точке, чем к этим. С другой стороны, Q лежит в этих ячейках, в
этих многоугольниках, поэтому она как бы равно удалена от этих, и больше никого
ближе быть не может. Поэтому этот круг пустой, и на нем хотя бы три точки. Круг
пустой и содержит хотя бы три сайта.
Согласны? Если нарисовать с центром в ней пустой круг, то у меня на границе сразу,
как минимум, три сайта. p, pg, pk. Вот. Ну, что это значит? Причем внутри никаких
других нет. Возможно, еще есть какие-то на границе, но внутри никого больше нет.
Значит, это получается, что Q равно удалена от этих трех сайтов, и понятно, что здесь
достигается минимально возможное расширение от Q до какого-либо сайта.
А раз внутри никого нет, то как бы к Q одновременно все вот эти ближайшие.
Значит, она во всех этих трех ячейках лежит.
Раз эти три ближе всего, возможно, какая-то четвертая есть, но неважно, эти три
ближе всего, а все остальные дальше. Значит, она одновременно в этих трех ячейках точно
лежит. Ну и надо понять, что такое пересечение вот трех ячеек в диаграмме, что это может
быть только вершина. Может быть только вершина. Ну, мы знаем, что такое пересечение двух ячеек.
То есть по факту они почти не пересекаются, они по внутренностям не пересекаются, они пересекаются
только по границам. Значит, если я, скажем, пересеку два обобщенных многоугольника, то их
пересечение, это может быть только ребро. Давайте я в простом случае нарисую, как они
могут пересекаться. Ну, как-то только вот по ребру. Возможно, оно полбесконечное, неважно,
ничего не меняется. Значит, вот два пересекаются по ребру. Вот эта ячейка ПИ, это ПЖ,
они пересеклись по ребру. Значит, дальше понятно, что все внутренние точки этого отрезка больше
ни в какой ячейке другой не лежат, потому что они находятся строго внутри вот этого отрезка.
Значит, для них ближе всего ПИ и ПЖ одновременно, то есть это серпир между ними, они ближе всего к
этим двум, ну и больше ни в каком другом многоугольнике они лежать не могут, потому что они внутри вот этих
вот двух, больше ни в каком другом многоугольнике лежать не могут. Поэтому единственное, что может
получиться при пересечении вот этого отрезка с еще кем-то, это одна из граничных точек, то есть одна из
вершин. Вот, значит, КУ вершина. Если есть хотя бы три, то обязательно КУ этой пересечения трех ячеек,
значит КУ это вершина всех этих трех многоугольников одновременно. Так, два, слева-направо давайте, что если
серпир участвует, то на нем можно выбрать какую-то точку. Ну пусть серпир участвует в качестве ребра.
Что это значит? Значит, как минимум, какой-то не тривиальный, не нулевой длины его кусок это ребро.
ПИПЖ, как минимум, то есть вот на этой прямой, как минимум, какой-то отрезочек не нулевой длины
является ребром, ну или там под частью ребра. Какой-то вот, возьмем достаточно маленький отрезок,
который вложен в ребро, скажем так. Давайте на нем возьмем какую-нибудь внутреннюю точку, середину,
скажем. Вот это КУ. Давайте нарисуем круг с центром в КУ, проходящий через ПИПЖ. Ну почти круг,
неважно. Понятно, что он существует, потому что ПИПЖ равно удалены от КУ, потому что КУ на серпире.
Я такой круг нарисовать могу. Вот я утверждаю, что внутри этого круга больше никого нет и на границе
тоже. Что это вот тот самый пустой круг, который содержит только ПИПЖ на границе. Ну почему? Ну пусть
кто-то внутри. Вот тогда КУ не может быть, не может лежать на, ну как бы не может являться куском
границы между ПИПЖ, потому что тогда есть какая-то более близкая точка. Значит у меня неправильная
диаграмма, потому что если точка, если КУ лежит на границе между ПИПЖ, значит к ней ПИПЖ самые
близкие, все остальные дальше. Поэтому внутри быть никого не может. Если есть кто-то еще вот здесь,
вот ПК, на границе этого круга, то почему такого не может быть? Ну потому что тогда КУ вершина,
например, да. А мы сказали, что это внутренняя точка ребра. Ну все, взять немножко слов напишем,
что пусть КУ внутренняя точка ребра, рисуем круг, содержащий ПИПЖ, других точек внутри на границе нет.
Значит как раз вот та самая точка КУ, которая существует, вот она.
Так, ну и теперь справа налево. Что если такая КУ существует, то это обязательно,
что кусок серпера это ребро обязательно. Ну давайте нарисуем какой-нибудь такой пустой круг.
Вот это пустой круг, который больше никаких точек ни внутри, ни на границе не содержит.
Что это значит? Значит расстояние от КУ до ПИПЖ равны и строго меньше всех остальных.
Равны и строго меньше, чем расстояние от КУ до всех остальных ПК, отличных от ИЖ.
Поскольку внутри круга и на границе никого нет, все остальные строго дальше.
Вот это значит, что, ну поскольку здесь какой-то зазор, здесь конечное количество элементов,
то есть вот эти штуки отличаются на какое-нибудь расстояние Эпс選.
Тогда если я скажем вот это КУ подвигаю вдоль этого серпера на Эпсилон поделить на сто,
скажем тогда для всех точек, вот в Эпсилон делить на 100 около этой точки, тоже это будет верно.
То есть я их двигаю вдоль серпера. Для них по-прежнему, для всех вот этих точек в маленькой
окрестности КУ, до них по-прежнему расстояние от них расстояниеΠПЖ одинаковое,
потому что я двигал вдоль серпира, и строго меньше всех остальных, потому что я
сдвигаюсь на эпселом поделить на 100, что, ну, как бы, заведомо этот эпсел не перекроет.
То есть это расстояние могло уменьшиться, но не больше, чем на эпсел он делит на 100. Вот.
Поэтому не только Q такова, что максимальный пустой круг содержит только
P и Pg, но какая-то маленькая окрестность тоже. Не пустая, а маленькая окрестность с обеих
стороны. Ну, значит, кусок ребра. Потому что все вот эти вот точки на каком-то нетривиальном,
не пустой длины отрезке равно удалены только от P и Pg, больше ни от кого. Значит, как раз,
это граница, разделяющая два многоугольника, и только их. Поэтому это как раз ребро. Небольшой
отрезок, содержащий Q, лежит только в итой и житой ячейках диаграммы. Ну, а значит, это кусок ребра.
Так, ну вроде все. Questions. Хорошо. Вот. Ну и тогда вроде мы готовы переходить к описанию алгоритма
построения диаграммы. Давайте алгоритм FORTUNE. Алгоритм такой. Plafactus Conline сверху вниз.
Вот давайте у меня есть мои сайты на плоскости. Давайте я буду идти сверху вниз вот таким вот
горизонтальным сконлайном. Вот эту вот линию буду сдвигать сверху вниз. И как бы мне бы хотелось
поддерживать, что вот все, что выше, здесь уже диаграмма построена. Я хочу знать диаграмму
выше этой прямой. И дальше, когда я ее спускаю сверху вниз, я все больше и больше информации
про диаграмму узнаю. Я не совсем могу это прям так делать, потому что, понятное дело,
что вид диаграммы выше прямой вполне себе может зависеть от точек, лежащих ниже, которые я как бы
еще не рассмотрел. Например, если здесь есть какая-нибудь вот точка очень близкая к этой прямой
разделяющей, то скажем, у меня будет какой-нибудь вот такой вот серпер. Вот этот серпер будет
участвовать в диаграмме между этими двумя точками. А я его еще не вижу, потому что эту точку даже еще
не увидел. Поэтому, ну, я не буду говорить, что я всю диаграмму знаю. Давайте я буду хранить ту
часть диаграммы, про которую мне уже все заведомо известно. А именно, у меня будет известна диаграмма
для тех точек плоскости X, которые хотя бы к одному из рассмотренных сайтов ближе, чем к прямой. То есть
мне нужно, чтобы вот это вот расстояние было меньше вот этого. Потому что, если от X ближайшее
состояние до одного из сайтов меньше, чем до прямой, то значит X гарантированно не лежит в
ячейках соответствующим вот этим вот сайтом, а только в тех ячейках, которые вот уже где-то выше.
Вот. Ну и теперь вопрос. Как тогда выглядит граница той области, где я что-то знаю,
той области, где я не знаю еще? Скажем, если бы я вот здесь равенство поставил, то что это была бы
за фигура, которая равна удаленной от точки и от прямой? Парабола. Да. С фокусом вот здесь вот,
и с директрисой вот здесь. То есть, если я нарисую прямую и точку, то я утверждаю, что геометрическое
место точек, равно удаленных от, давайте, P и L, где P это прямая, а L это точка, это какая-то вот такая
парабола. С фокусом в P, с директрисой в L. Ну это какой-то там геометрия, что-то такое. Вот. Получается,
что вот все, что внутри, как бы даже все, что находится, грубо говоря, внутри этой параболы,
здесь все точки ближе к P, чем к L, поэтому здесь я точно знаю вид диаграммы Воронова. От того,
что у меня внизу какие-то сайты новые появляются, вид диаграммы Воронова внутри этой параболы не
поменяется. Ну, значит, давайте я вот здесь буду полностью хранить. И более того, мне нужно,
чтобы точка лежала не в какой-то конкретной параболе, не над конкретной параболой, а над одной из тех,
которые мы уже рассмотрели. То есть, либо вот над этой параболой, либо вот над этой, либо вот над
этой, ну и так далее. То есть, каждый сайт задает параболу, и если я нахожусь, если X находится
вот выше вот этой вот линии, где-то там, тогда там мне известна вид диаграммы Воронова. Вот. Ну,
собственно, хорошо. Эту штуку называют beach line, потому что она же береговая линия. Ну, потому что,
типа, волны такие красивенькие такие. Вот. Значит, мы будем хранить вид этой береговой линии как,
собственно, просто последовательность дук-парабол. Ну, то есть, у меня есть вот одна парабола, как бы отсюда
до сюда, грубо говоря, потом другая отсюда до сюда, и третья отсюда до сюда. Вряд ли. Нет, нет, нет, нет, нет.
Храним как, ну, давайте пишу пока последовательность, последовательность дук-парабол. Вот. Хорошо. Теперь
надо понять, как меняется у нас этот профиль, как меняется береговая линия при каких-то событиях.
Значит, события на самом деле бывают двух типов. События по изменению береговой линии. Событие первое
называется событие точка. Значит, оно же site event. Это когда при движении вот этой вот директрисы,
мы натыкаемся на очередной сайт. На очередной сайт. Тогда по факту мне нужно вставить в береговой линии
новую параболу, потому что у меня появился новый сайт, а нас дают какую-то новую параболу, как те точки,
которые ближе к нему, к этому сайту, чем к директрисе. Вот. Ну, в момент времени, когда у меня
директриса прям проходит через эту точку, у меня парабола вырождается вот в такую вот вертикальней,
на самом деле, просто лучшую. Давайте вот так вот нарисую, как будто такая узенькая, тоненькая
парабола. Но дальше, когда я директрису начну опускать, у меня эта парабола начнет раздуваться и вот так
вот разбухать, так вот расцветать по факту. То есть ее вершина будет спускаться все ниже и ниже, и она
будет расширяться, раскрываться. Ну, значит, мне нужно ее вставить, потому что, начиная с этого момента,
у меня появляется такая парабола в битчлайне, мне нужно ее вставить. По факту просто вставка
новой параболы в береговую линию. Вот. Причем, смотрите, давайте вот проследим за точками пересечения,
которые были у меня там до этого и которые вот здесь там одна очередная появилась. Когда я вот
пересекаю вот такую вот параболу с этой, у меня появляется здесь точка пересечения. Смотрите,
точка пересечения двух соседних парабол, это как раз точки, равно удаленные от двух фокусов,
потому что вся парабола равно удалена от фокуса и директрисы, две соседние равно удалены, собственно,
от двух вот этих соседних фокусов. Вот это равно вот этому скажем. Значит, эта точка, на самом деле,
она удаляется вот этому второму свойству. И вот эти точки, являющиеся пересечения
ЯМИ соседних парабол, буду как раз нам вычерчивать ребра диаграммы Воронова.
Ну, потому что как бы эти точки равно удалены от этих двух, больше никого ближе нет, но это надо
строго доказывать. Ну, давайте пропустим. В общем, можно показать, что если у вас такая
береговая линия, то ближе никого к этой точке нет. Можно показать, давайте скрипнем. Вот. Ну и все,
тогда, соответственно, когда вот представьте, у вас эта береговая линия двигается, у вас пора
было чуть-чуть раскрывается, и точка переносится, соответственно, как-то двигается. Причем она двигается
вдоль серпера как раз между этими точками. Ну, потому что, как бы, параболы равно удалены от фокусов,
поэтому точка переносится вдоль прямой, ну как бы равно удаленной от фокусов, то есть вдоль
серпера. Поэтому у вас эта точка переносится. Ну и вот как раз вычерчивать кусочек диаграммы.
вот собственно основное содержание алгоритма вот но еще осталось только сказать про про вершины
что скажем в момент что такое вершины мы вершины ты когда три сайта как это равно удалены а ну да
или более это происходит в момент когда у нас на самом деле какая-то из парабол склеивается
какая-то из парабол и станчается и исчезает то есть ну вот представьте у нас были какие-то
параболы такая такая толстенькая и вот такая соответственно вот у меня бичлайн был вот такой
вот так вот так вот дальше когда я спускаю директрису вниз и вниз у меня но вот они начинают
вот так вот разбухать как-то сужаться и рано или поздно вот это вот более более толстая как бы
более высокая парабола более раскрывшуюся она затмится вот этими более низкими то есть
мне как бы вот одновременно будут вот такие три параболы такие что они будут по факту в одной
точке пересекаться то есть ну как бы иногда у меня бывает такое что две вот эти вот не соседние
параболы перекрывают какую-то лежащую между ними это как раз вершина диаграммы воронова потому
что эта точка равно как бы лежит на трех параболах значит она равно удальна хотя бы от трех прямых
от трех сайтов ссори вот от этого этого этого это называется событие окружность событие окружность
он же circle event ну да можете подумать я думаю что это не давайте давайте в любом случае бы дай
сейчас полминутки подумаю типа насколько очевидно или нет сейчас сейчас момент момент момент сейчас
сейчас погодите погодите а ну наверное смотрите типа если если был бы кто-то ближе но давайте
про ребра скажем то есть я утверждаю что у меня точка течения с этих парабол обязательно вычерчивает
ребро пусть не ну то есть понятно что эти две есть здесь пусть есть кто-то ближе то есть есть
какой-то сайт ближе к этой точке чем вот эти два но тогда извините расстояние до сайта меньше чем
расстояние от этой точки до прямой поэтому эта точка лежит внутри какой-то другой парабол
но это наверное не бывает сейчас
ну да типа если она внутри какой-то параболы то у меня вот такой бичлайн должен быть у меня
же она должен быть внутренней точка не гранично да то есть еще раз это неважно но меня попросили
доказать почему вот эта точка когда и когда я пересекаю два соседних две средние параболы
эта точка реально вычерчивает ребро но мне нужно вот этот критерий я понимаю что эта точка равна
удалена от двух фокусов это мы и так понимаем почему нет других скажем почему нет точек внутри вот
этого вот круга то есть если я нарисую такой круг да то есть с центра в этой точке проходящие
за эти два фокуса ну и заодно касающиеся прямой потому что точка равна удалена от этих всех трех
фигур почему нет других сайтов внутри но если бы у меня какой-то был сайт внутри вот здесь вот
соответственно расстояние до него было бы меньше чем радиус этого круга то тогда расстояние от
этой точки до этого сайта еще мимо как бы меньше чем расстояние от точки до прямой ну потому что
вот вот эти штуки равны а вот этот пунктирный меньше значит парабол образованная этим фокусом и
этой прямой содержит эту точку внутри себя потому что до фокуса меньше чем до прямой значит
внутри поэтому есть какая-то вот такая вот еще парабол с держащей точку внутри но тогда это
не бичлайн был потому что бичлайн для каждой вот такой вот вертикальной прямой стежу самую
низкую точку да а если это внутри строго внутри параболы то значит косяк еще раз
нет еще раз смотрите у вас есть точка пересечения двух парабол она равна удалена от двух фокусов и
прямой вот эти три штуки одинаковая если внутри есть другой сайт вот этот вот то до него расстояние
меньше чем до прямой супер ну короче при желании можно доказать причем не сложно так значит сюда
сюда вернемся я утверждаю что вот бывают моменты когда у меня какая-то парабола затмевается
двумя другими это называется события окружность потому что в этот момент точка их пересечения
точка причины трех парабол образует вершину значит точка пересечения трех соседних парабол
задает вершину диаграмма воронова
ну потому что она равна удалена от трех сайтов значит как раз вершина
вот все соответственно смотрите у нас будет две структуры данных в первой у меня будет
содержаться описание bitchline я буду я сделаю это просто с помощью сета значит сет будут меня
хранить bitchline хранить береговую линию значит элементом сета является дуга параболы
как ее можно задать кажется хватает следующий чтобы задать дугу ну во первых у меня есть
какая-то глобальная переменная y который задает текущую координаты директрисы текущую коронату
вот если у меня это фиксировано то любая дуга окружности кажется дуга парабол извините задается
просто двумя соседними фокусами есть пи какой-то пж есть у меня директриса есть одна парабола
есть другая парабола вот значит если я просто храню пи пж в этом порядке то я говорю что дуга
соответствующие этой ну как бы этому элементу это вот этот вот какой-то кусок этой параболы то
есть там я не знаю где он там начинается но какой-то такой конечно его кусок лежит то есть я просто
храню по факту два соседних фокус 2 соседних вот ну если надо я могу хранить еще и предыдущий чтобы
знать где она заканчивается ну то есть точнее где она начинается если я знаю вот здесь вот еще
одну параболу чем она задается то я знаю начальную точку этого фокуса этой дуги но это не
нужно будет не нужно мне достаточно хранить двух как бы зная где она заканчивается потому что если
что я могу взять предыдущий элемент сете и понять собственно вот эту точку печень двух предыдущих
парабол вот кажется не будем да нам надо просто вставлять да да и причем эти элементы именно
отсортированы по вот этой вот правой границе точки пересечения значит дуги в сете отсортированы
по x координате конца дуги
нет вот именно что как бы структурка который он как бы структ нот который вы храните в сете это
именно кажется просто две точки по и пыжи и при необходимости вы можете для данного фиксированного
y вы можете посчитать где эти параболы пересекаются вы можете посетить коронат этой точки и
соответственно когда в каждом момент времени вы знаете порядок дуг ну то есть вы храните что в
сете вот они в этом порядке и лежат у какого компаратора у вас есть одна пара парабол
задающий вот такую дугу другая парабол за такую дугу вы вычисляете точки пересечения то есть вы
взяли вот эту точку там и какой-то вот эту точку то есть вы пересекли параболы и дальше
сорвать их x координат конец вот и причем у меня как бы порядок парабол ну как бы я понимаю что с
ним происходит если на немножко двигаю директрис у меня ничего не меняется единственное что
происходит иногда новые появляются и какие-то исчезают когда у меня вот эти вот вот как я
тут рисовал вот эти две параболы настолько расширились что они затмили какой-то то что
было между ними тогда нужно просто эту эту из этого вы вытащить и удалить все относительно
порядок не меняется у них кроме вот этих вставок и удалений вот насчет первая структура где мы
храним собственно описание бичлайна и нужна вторая это будет просто куча у нас ну там то есть
очередь с приоритетом как угодно приоритетом это просто список событий список событий
список событий откуда мы достаем каждый раз события с максимальным y
достаем события с максимальным y ну потому что иду сверху вниз да и соответственно
порядка убывания y каждое событие не нужно достать максимальный y события напоминает
появление новой новой параболы новой точки site event либо события когда две параболы затмевают
то есть давайте давайте прям как их добавлять ну сайты вон понятно можно в самом начале по
всем точкам пройти искать в таком-то игреке если какая-то точка пи то я знаю что вот в
этот момент времени когда у меня такая-то ордината я знаю что появляется новая парабола вот вот такого
вида соответственно она появляется какие там две соседние ну темп в простом случае одну параболу
пересекает мне нужно вставить ее вот между между как бы то есть у меня вот это дуга теперь то есть
у меня была одна такая большая дуга станет такая потом эта точка потом такая потому что потом
она начнет раскрываться и соответственно вот как-то так вот пересекать мою мою старую параболу вот
это это это просто как обрабатывать события окружность когда оно происходит ну смотрите
давайте в каждый момент времени если у меня какая-то береговая линия то есть есть какие-то
параболы давайте для каждой тройки последовательных парабол вот в порядке сета давайте поймем какая
должна быть y координата чтобы две вот эти вот крайние затмели среднюю как-то сделать ну мы знаем
в какой точке должно произойти значит я знаю скажем давайте я нарисую да что вот есть у меня
одна такая парабола и две соседние вот такие значит когда они затмевают центральную в момент
времени когда их точка пересечения равно удалена от всех фокусов и еще и от директрисы значит мне
нужно понять в какой момент времени что-то у них есть какие-то фокусы что такое точка равна удаленной
от них это от центра описанной окружности для них ну то есть я там стройки серперы и определяю
точку описанной окружности вот этого вот треугольника какая-то окружность вот вам вот
вам почему сёркл и вент какая точка о значит в момент времени когда директрисы проходит вот
так вот касательно к моему кругу как раз это вершины и появляется то есть если у меня давайте так
напишем если пи пж пк 3 последовательных фокуса то описываем окружность вокруг этого треугольника
говорим что пусть о центр описанной окружности этого треугольника ну и дальше значит мы знаем
радиус там мы откладываем еще на r вниз и говорим что вот в этом вот y равная там о точка y минус
вот в этой вот координации вот в этой вот ординации у меня происходит событие точка с событие круг
события окружность когда вот эти вот две соседние не соседние параболы затмевают вот эту вот
центральная то есть картинка в этом оory cinema будет какой-то вот такой что у меня будет одна
парабола вот такая вот это вот будет какая-то вот такая а центральная будет вот так вот
между ними проходить и будет полностью ими затмеваться
с обеих сторон.
Что-то понятно?
Что?
Хайпуйте, кайф.
Не знаю, что это значит, но ладно.
Вот.
Тут надо аккуратно сказать, что происходит, если PIPGPK
на одной прямой, нельзя построить центрописной окружности,
да?
Ну, давайте подумаем чуть-чуть.
Нет?
Вы против?
Нет?
Вы против?
Очень жаль.
Ну, если PIPGPK на одной окружности у вас, на одной прямой,
у вас нет треугольника и нет описной окружности.
Давайте подумаем.
Почему параллельно?
А, типа затмения не будет, типа?
Ага.
Ну да, да, да, да, справедливо.
Значит, нам просто ничего не надо делать.
А то есть, вот если у меня три на одной прямой, то
у меня вот эти параболы, они друг друга никогда
не затмевают, потому что точки пересечения, ну, вычерчивают
серпер, ну, я как мог, вычерчивать серпер между соседними
точками.
Поэтому они не пересекутся и все хорошо.
Понимаю.
Вот.
Ну, чего?
Все.
То есть, мне нужно, смотрите, чтобы вот с этим вот разобраться,
мне нужно делать следующее.
В каждое время, когда перестраивается структура береговой линии,
когда там что-то вставляется или что-то удаляется, мне
нужно для каждой тройки последовательных парабол,
для каждой тройки последовательных парабол двух посчитать
центр описанной окружности и сказать, что в этот момент
времени происходит событие затмения.
Ну, все.
А событий изменений у меня мало.
У меня событий изменений по факту только сайты
в Энте, когда что-то вставляется.
Ну давайте в момент этой вставки, когда у меня вставляется
одна парабола, давайте, я там, вот, то есть, у меня
в нов...
Ну, новые тройки образуются, по факту.
была вот эта-вот эта-вот эта, вот эта-вот эта-вот эта,
вот эта-вот эта-вот эта. Ну, там.
От единиц новых троих, содержащих новую парабол.
Давайте для каждой из них...
Благо, они получаются за алгорифм.
Просто минус-минусом и плюс-плюсом в сете.
Значит, давайте для каждой новой тройке,
которая только что образовалась,
построим circle event и положим его,
что когда директриса будет такой,
тогда будет событий с circle event.
Поэтому запишем следующее.
В любой момент, в каждый момент.
изменения сета,
смотрим на все новые тройки
последовательных парабол
и добавляем в очередь событий новый circle event
новый circle event
в этот раз мы не будем делать
в момент обработки circle event
когда у меня было три парабола, осталось две
когда центральная пропала, у меня тоже появляются новые тройки
потому что теперь вот эти две крайние стали соседними
и мне нужно смотреть новые тройки, которые ими образуются
в то время, когда что-то с бичлайном происходит, мне нужно рассмотреть все новые тройки
благо это просто делается, потому что я знаю, где произошло изменение
локально двигаюсь влево-вправо, на 3 влево, на 3 вправо
рассматриваю все новые тройки, все новые circle events добавляю
ну и последнее, бывает такое, что у меня происходит false alarm
ложная тревога
когда пришел circle event
от каких-то парабол, которые уже раньше были удалены
то есть я когда-то там что-то три соседние парабола пересек
сказал, что вот здесь-то будет circle event, но потом после этого
у меня уже от другого circle event или от какой-то вставки
на этих трех параболах поменялся порядок, и этот circle event пропал
эти три стали непоследовательными, или одна из них удалилась раньше
что-то такое, тогда мне просто приходит событие, говорит, ага, посмотри, пожалуйста,
на эти три параболы, и скажи, что они задают вершины диаграммы Воронова
я такой, ну чувак, они уже удалились, я ничего не могу сделать, это типа старая информация
ты мне говоришь про вершину, которая была бы, если бы я там
ничего не поменял, но я уже поменял, поэтому я ее игнорирую
как это чекнуть? ну видимо нужно
в момент времени создания circle event, вот для этого y
хранить на указательной вершины сета
на элементы сета, что вот эти три последовательные элементы сета
задают circle event, и дальше если какая-то из них не лежит уже в сете, или они
непоследовательные, тогда мы его просто игнорируем
если три параболы
задающие
circle event
уже непоследовательные, или вообще не существуют
то просто continue
я это просто событие не обрабатываю, говорю, что оно
как бы несодержательно
вот
ну кажется, что все
единственное, надо еще сказать, что, давайте на примере
какой-нибудь простой пример, давайте три точки сначала
пусть у меня вот такие три сайта
пример
вот такие три сайта, значит изначально у меня директриса доходит
до сюда, в этот момент времени я добавляю одну вот такую вот параболу
и все, просто добавляю такую параболу
дальше я начинаю ее опускать, директрису опускать, у меня
раскрывается, расширяется моя парабола, вот так вот
в момент времени, когда я дошел директрисой до вот этой вот прямой
давайте для простоты одну только точку пока рассмотрю, другая будет чуть ниже
вот этот сайт P1, скажем, был, это P2, это P3
в этот момент времени у меня парабола вот такая
парабола соответствующая P1 вот такая
теперь пришла новая точка, сайт event, в этот момент времени
появляется новая парабола вот такого вида
вот такая узенькая-узенькая, бесконечно узкая парабола вверх
но она входит в beachline, более того, beachline теперь такой
сначала вот эта вот дуга первой параболы, потом
вот такая вот дуга второй, потом опять первый, то есть у меня в сете
будет следующее, у меня будет, значит, что у меня, у меня сначала есть
у меня есть парабола, задаваемая точками P1, P2
вот этот кусок, потом P2, P1
вот это вот, потому что сначала
ну как бы, у меня есть кусок параболы, задаваемые P2, и ограничено оно P1
потом 5P1P1, нет, сейчас
ой, а это как я храню?
ну вот эта парабола непонятно как хранить, или ее можно вообще не хранить, ну это странно
ну то есть в каком-то смысле, вот это
это типа парабола P1 бесконечность
да, да, да, да, то есть для вот этой дуги у нее как бы нет следующей
она не ограничена справа, поэтому она сдается только этим фокусом
давайте я так напишу пока
ну да, вот, что произошло, у меня поменялся бичлайн
у меня произошли какие-то сёркл-эвенты, у меня появились события
там, чего-то там, давайте посмотрим, что будет, когда я немножко снижу эту директрису
у меня вот эта парабола начнет раскрываться, и будет вот какой-то вот такой вот
и точки пересечения, вот эти вот, которые были изначально здесь
теперь они будут двигаться вот так, вот эти две точки пересечения, одна движется туда
другая движется сюда, буду как раз заметать ребро, причем
и именно, что поскольку у меня вот эта парабола расширяется, и это тоже расширяется
точек пересечения будет две, и они будут вот так вот двигаться, одна туда, другая сюда
и они вместе заметают ребро
чего-чего?
не-не-не, это вот это как раз
да, как раз конец задается пересечением EMP1 и EMP2
она и соответствует вот этому
она начинается в минус бесконечности
она начинается в минус бесконечности, да
но я храню конец, типа у меня, первое это на какой параболы мы лежим
а второе это описание конца
да, то есть это как бесконечный влево как раз
вот, то есть в этот момент времени у меня начинается ребро
и дальше, значит, мне нужно построить круг
с центром, то есть смотри, у меня вот есть три параболы
но тут не получается circle event, потому что у меня
все рассмотренные сайты пока что лежат на одной прямой
значит, пока что этот самый circle не произошел
circle у меня будет в момент времени, когда у меня дойдется до этой точки
добавится новая парабола
и будет три последних параболы
вот эта вот, вот эта вот и вот эта вот
если я их пересеку, то как раз получу центр описанной окружности этих трех сайтов
получше, что вот здесь вот происходит появление вершин диаграммы Воронова
это как раз когда пересечение этих двух парабол дошло вот до сюда
да, то есть у меня вот такой кусок серпера нарисовался
пересечение этих двух дошло, то есть это еще раскрылось, стало вот до сюда
и соответственно кусок, как они пересекаются, они движутся как-то вот так вот
по этому серперу
ну и соответственно вот в момент времени, когда это дошло до сюда, а это до сюда
у меня появилась вершина диаграммы Воронова
ну все, дальше он движется, просто вот эти две
будет какое-то вот такое вот бесконечное ребро вниз
нет, тут нет false alarma здесь, потому что у меня только один раз произошел circle event
когда вот эти вот три последние параболы для P2, P1 и P3 стали последовательными
в этот момент добавляется circle event и это будет реальная точка
но надо более сложный случай какой-то рисовать
когда скажем
когда скажем вот здесь появляется какая-то точка
у меня скажем вот эти три параболы были, да, вот например так
у меня были вот такие три последние параболы
для них circle event был где-то вот там, вот где-то очень далеко
потому что треугольник очень тупоугольный
дальше, когда директорис доходит вот до сюда, у меня появляется вот такая новая парабола
и соответственно тогда эти три перестают быть последовательными
и вот то событие уже не актуально, оно выбрасывается, ну как бы оно игнорируется
у меня вершина будет от перчения этих двух или этих двух
все, спасибо, извините, что задержал
