Стороной, ну обязательно с стороной многогранника.
Конечно, да, конечно, конечно, конечно.
Ну потенциально можно, но это нам нужно строить уравнение плоскости, проецировать туда все
точки, ну типа выкидывать какую-то координату. Это не самое приятное занятие. Лучшее. Ну и это тоже.
Вот, то еще раз давайте овервью алгоритма. Мы сначала нашли какое-то одно ребро.
Кстати, как? Давайте подумаем. Хорошо, давайте поймем, как найти то самое ребро Е.
Ну типа того, да, как найти первое ребро Е.
Вот, давайте сначала возьмем самую нижнюю точку с минимальным Z.
Чего?
Ну да, ну в смысле из таких несколько, то как обычно минимальную по Y, среди таких минимальную по X.
Вот. Ну давайте опять для удобства, я считаю, что точка с таким Z одна.
Дальше я понимаю, что у меня все точки лежат выше, чем она. То есть я могу провести вот такую
опорную плоскость с фиксированным Z вот такую вот горизонтальную. Такую, что все остальные
точки лежат выше нее. Ну теперь как найти какое-нибудь ребро, которое точно лежит в нашем многограннике?
Вот это я не уверен. Это, кажется, неправда.
Я бы сказал так, давайте мы возьмем такой вектор, от которого расстоит угол до плоскости вот этой
горизонтальной. Минимально возможен? Вот этот угол минимален. Вот, если он нулевой, то мы живем в
плоскости, уж там как-нибудь одно ребровые поклоблочки мы найдем. Там можно типа, вот если это
точка минимальная, то нужна та, от которой угол, на которой угол максимален. Ну как обычно, когда мы,
если мы в плоскости живем, мы знаем, что одна точка вершины, как найти другую сторону. Ну вот
надо все посортировать. Ну не посортировать, а найти короче максимальную, с максимальным таким углом.
Вот. А вот в этом пространственном случае, если у меня здесь одна точка и есть все остальные, я
могу для каждой точки провести вот такой вектор, посчитать, какой угол этот вектор образует с
горизонтальной плоскостью и взять минимальный угол среди всех таких. Вот. Ну, посчитать угол с
плоскостью, наверно, не очень приятно. Можно считать, так как-то тоже через смешанное произведение говорят,
можно это делать. Ну, во-первых, смотрите, можно считать не угол до плоскости, а угол с нормалью,
то есть вот, картинку перерисую. А нет, тут как раз более-менее руками, кажется, нужно это делать.
Вот у меня есть опорная плоскость, есть какая-то стартовая точка. Как понять угол между каким-то
вектором и плоскостью? Ну, это то же самое, что 90 градусов минус вот этот угол. Да, ну,
а между векторами мы уж как-нибудь угол найдем. У нас есть, например, скаллярное произведение,
которое принимает, ну, как бы, после деления надлинно возвращает косинус, и нам нужно найти
максимальный угол вот здесь, то есть минимальный косинус. Базис в этой плоскости? Нет, объем,
ну, объем содержит не только угол, но еще и вот как бы длинный вектор учитывает, к сожалению.
Поэтому, ну, тут как раз кажется, либо надо прям в тупую мерить углы, либо как-нибудь, ну, там,
считать квадрат скаллярное произведение, делить на квадраты длин, тогда не будет этих самых доблов,
но будет там в больших целых числах. Вот, короче, так или иначе, можно найти вектор, который ближе
всего к нашей плоскости, и это точно будет ребро. Так, нормально же? Ну вот, все, значит,
тогда алгоритм, да, мы находим сначала одно ребро вот этим способом. Дальше давайте делать
следующее. Для каждого найденного ребра давайте заведем очередь ребер, которые нам надо обработать.
Достаем сначала вот это вот ребро E, изначальное ребро, которое мы нашли, добавляем в очередь.
Достаем ребра из очереди по одному. У нас есть ребро. Давайте мы вот таким вот образом найдем
относительно этого ребра самые крайние точки, вот эти крайние страницы книжки, если корешок
поместить вдоль этого ребра. Да, мы найдем такие две плоскости. Ну, вот здесь надо две найти в
самом начале. На самом деле можно взять одну, да, то есть можно сначала вот здесь вот найти две и
потом уже искать по одной, но это все тонкость несущественная. То есть можно найти вот эти две
крайние плоскости, они задают нам какие-то новые ребра. То есть, скажем, вот мы нашли какой-то
треугольник, да, тогда мы говорим, что, грубо говоря, вот эта вот грань, вот эти штуки задают мне
ребра многогранника. Ну и дальше, если их еще не было в очереди, то я их туда добавляю. Ну и факт.
Ну вот это, да, всегда добавится точно. Ну что, это совсем неприятно. Я бы все-таки делал скорее так,
да, что у меня, я все-таки давайте добавлю треугольник такой полностью, а потом, а потом в
момент, если я, скажем, буду для этого ребра находить две самые крайние, пойму, что они как бы
параллельны друг к другу, то есть у меня, на самом деле, вот это ребро, оно лежит в грани, ну вот в этой вот,
да, и тогда по факту ребра на это надо удалить. Ну надо еще тогда сделать проверочку, что если у меня
две самые крайние полуплоскости, они параллельны, то есть как раз образуют угол 180 градусов развернутый,
то мне нужно это ребро удалить и те два треугольника, которые я построил, склеить. Ну и там опять вот
эти два новых ребра, вот эти два новых найденных ребра добавить в очередь и запустить уже от них.
Вот так вроде будет терпимо. Так, ну что, ау? Да, ну из них, значит, среди таких надо опять какую-то выбрать, да?
Ну, смотрите, кажется, что, кажется, что вот, вот в этот момент, когда я проговорил, что если я понимаю,
что ребро, на самом деле, внутри грани, а не граница грани, тогда его можно просто удалить и тогда вроде
тоже ничего не сломается. Даже если это ребро я нашел не как ребро, а как диагональ в грани какой-то,
то опять я встаю в него, нахожу, что у меня книжечка полностью раскрыта на 180 градусов,
нахожу там какие-то два треугольника, это стираю. То есть, грубо говоря, у меня была
треангуляция четырехугольника, да, я понял, что вот это ребро надо удалить, потому что она лежит в грани.
Ну, кажется, кажется, этот, этот случай, этот вбирает в себя. Да, да. Ну, потому что мы переберем только
нормальные ребра и плюс, видимо, какие-то диагонали, да. Нет. Ну, в смысле, в смысле, еще раз, конечно, есть
проверка, что если ребро уже в очередь, то мы ее не добавляем туда, его туда не добавляем. Нужен,
еще какой-то типа, что-то типа сета, которое для каждой ребра говорит о новой очереди или там,
может оно уже вообще было обработано, тогда его нет смысла добавлять в очередь. Тогда мы в очереди
явно обработаем только какие-то ребра, ну и вообще у нас на самом деле каждое ребро порождает два
новых ребра и поэтому у нас время работы будет как раз пропорционально размеру.
Да, это как раз не сложно. Это пишется.
Почему симпотика такая? Согласны ли вы, что она такая, если у нас все грани треугольные?
Сейчас у нас есть верификатор. Ну, просто потому что каждое ребро порождает грани,
как бы там грани примерно столько же сколько ребер и там каждый обрабатывается за ОАТН. А дальше
надо аккуратно повозиться, типа ну пусть у нас есть как бы грани, который многоугольник на самом
деле. Как мы ее обрабатываем? Мы сначала скажем, добавим вот это ребро, потом вот так
триангулируем, добавим вот эти два, потом это удалено, добавим вот эти два, потом это удалено,
добавим вот эти два. Ну, кажется, время работы это плюс количество диагоналей в какой-то
триангуляции. Ну, в смысле, вот это к увеличивается на количество диагоналей в триангуляции. Их там
тоже от числа ребер на границе, это тоже типа вот к получается сумма. Давайте разберемся сначала,
ладно, потом вопрос. Вопросы может? Окей. Хорошо, тогда давайте попробуем Зайн Логен, еще алгоритм.
Нет. Так, сейчас будет перерыв, да, про корректность. Ну, а что, ну понятно же там,
книжечка. Не, вообще про про корректность тут как бы надо сказать примерно следующее, что, что
такое грань вообще, как можно воспринимать грань. Грани у вас выступает такой, ну, набор точек по факту,
да, ну вот на границе многоугольника, что если провести через них плоскость, то все остальные будут
жать по одну сторону от этой плоскости. В каком-то смысле мы это и делаем, да, у нас как бы мы знаем,
что вот эта вот эта часть какой-то граня, мы в каком-то смысле рассматриваем все плоскости через
эту грань проходящие и из них выбираем вот ту самую крайний, ну, точнее две крайние, которые с двух
сторон все обрамляют, вот. Идеально студент уже не будет решать. Не будет, не будет. И теорки не будет. Давайте
дальше. Тоже не будет, скорее всего. Садитесь, давайте. Я не знаю.
Так, как это делать за NLogin? Не знаю, будет ли это проще для понимания? Сейчас проверим. Может там
меньше технических деталей может быть будет. Посмотрим. Значит, смотрите. Тут идея такая. Будет
инкрементальный рандомизированный алгоритм. Значит, мы будем идти по точкам инкрементально
рандомизированных, будем идти по точкам в порядке 1, 2, 3 и так далее N и будем поддерживать текущую
выпуклую оболочку для рассмотренного множества точек. Ну, давайте как-нибудь начнем. Как начать?
Нам нужен какой-нибудь многогранник на каких-то вершинах. Ну, наверное, можно начать с каких-нибудь
четырех точек. Давайте я для удобства буду считать, что у меня текущая выпуклая оболочка всегда уже
многогранник. Значит, мне нужно, наверное, тогда найти четыре вершины, не лежащие в одной плоскости,
и понятно тогда, что их выпуклая оболочка это как бы тетраэдр с вершинами на них. Любые четыре точки
задают как раз тетраэдр. То есть, есть три в одной плоскости, есть одна, не лежащая в той же
плоскости. Вот как раз все ребра между ними задают тетраэдр. Ну, конечно, если у нас исходно все
N точек в одной плоскости, у нас задача двумерная, и дальше мы как-нибудь уже на плоскости-то решим.
Вот, значит, иначе я говорю, что за линейное время можно найти четыре точки, не лежащие в одной
плоскости. Ну, скажем, берем первую, берем вторую, дальше находим третью, не лежащую с ними на одной
прямой. То есть, перебираем все остальные, ищем не лежащую с ними на одной прямой. Нашли третью. И дальше
идем, ищем четвертую, не лежащую с ними в одной плоскости. Это все делается просто одним проходом по
точкам. Итак, значит, старт. Это у нас тетраэдр на каких-то четырех точках.
Вот какая-то такая картинка. Это база нашего алгоритма. Мы начинаем с такого тетраэдра. Вот.
Давайте все остальные точки я случайно перемешаю. Ну, в смысле, веду на них случайный порядок.
Н-4 точки, я их по рандом-шафлю, будет теперь какой-то новый случайный порядок точек P5,
и так далее, Pn. То есть, вот здесь были первые четыре, все остальные я случайно посаштировал.
Случайно переставил, точнее. Что? Да нет. Нет. Ну, типа, мы просто идем 1, 2, 3, 4, 5, и так далее,
ну, по изначальному порядку вершин находим первый попавшийся тетраэдр. Это неважно. Начало
может быть любым. Вот. А вот все остальные мы случайно перемешали. И дальше давайте по одной
вводить точки в рассмотрение и перестраивать текущую выпуклооболочку. Вот. Идеальный случай
был бы, когда точка попадает внутрь текущего многогранника, тогда ничего перестраивать не
нужно, она внутри, ее просто игнорируем. В случае же, когда она не внутри, значит, она снаружи,
надо что-то перестроить. Да, ну вот представьте, давайте я опять нарисую картинку с усеченной пирамидкой.
Вот. Представьте, что точка, новая там, новая точка приходит вот где-то вот здесь,
чуть-чуть выше, чем верхняя грань. Значит, если она приходит совсем чуть-чуть выше,
где-то вот здесь вот она лежит, тогда нужно просто вот эти вот новые четыре треугольника добавить,
то есть у меня есть вот эта крышка верхняя, прямоугольник какой-то, у меня есть точка чуть-чуть
выше него, понятно, мне нужно просто провести отрезки во все вершины этого прямоугольника и
сказать, что вот эти треугольники новая грань. Вот. Если же она будет сильно выше, где-то вот там вот,
вот здесь вот возможно, да, то у меня на самом деле нужно будет также что-то удалить. Мне нужно
будет целиком этот прямоугольник удалить, потому что у меня все будет лежать вот в такой вот Пирамидке.
Вот, значит, вот до этой вершины, до этой, вот до этой. Вот,
то есть вот верхняя крышка удаляется, все будет целиком вложено в такой,
в такую Пирамидку с вершины вот этой точки. То есть мне на самом деле нужно будет сделатьести
следующее, мне нужно будет найти те грани, которые я вижу из этой точки, и их
удалить. То есть, если я стою здесь как раз, вот если мы очень высоко над
пирамидкой, то мы видим не только верхнюю эту крышку, но и вот эти четыре
боковые стороны, они-то могут под углом, но мы их будем видеть. И вот как раз их
нужно будет удалить, и вот этот внешний контур, вот эту внешнюю
границу, которую мы видим, то есть, представьте, я над этой пирамидкой стою
сверху, вижу какие-то грани, и крайние точки, что я вижу, это как раз нижний вот
этот вот опорный прямоугольник в плоскости. Вот мне нужно на него провести
отрезки, и сказать, что это мои будут новые грани.
Ну вот. Еще раз? Если мы где-то сзади стоим, типа, да? Ну, то же самое, на самом деле, в
общем случае, будет ровно это. Мы стоим в точке, мы смотрим на наш многогранник.
Какие-то грани мы видим, какие-то не видим. Ну, неформально, да? Вот то, что мы
видим, образует для нас какой-то контур. Там какие-то фигурки, вот мы их видим,
они чем-то обрамляются каким-то выпуклым многоугольником. То есть, грубо говоря,
если я стою в точке, все, что я вижу, вот я могу так нарисовать, будет какой-то
выпуклый многоугольник. Вот мне нужно все, что внутри него, все грани, которые, все
грани, которые я вижу, мне нужно удалить, а в границу этого выпуклого
многоугольника провести треугольнички, сказать, что вот это все, все внешний грань.
Например, если бы она лежала в этой же плоскости, да? Хороший вопрос. Ну, тогда
надо просто грани склеить, на самом деле. Это важный, важный выраженный случай.
Ну, представьте, вот у меня есть вот эта пирамидка усеченная, вот здесь точка.
Тогда что меняется? Ну, у меня эта грань, она как бы остается, но она немножко так
продлевается, на самом деле, да? То есть, будет что-то вот такое. Ну, а здесь вот эта
грань пропадает, у меня будут вот здесь вот такие, такие касательные. Но у меня
просто верхняя грань продлевается. Если у меня вот здесь вот был какой-то столик
сверху, какая-то граница, я встал сюда, я пускаю лучи, как я вижу эту грань, ну,
то есть, она будет выглядеть ребром, но я просто пускаю туда ребра и объединяю все это
в одну большую грань. То есть, вот этот треугольник объединиться с этим
прямоугольником, удаля по дороге вот это вот ребро, которое было здесь, раньше было
ребром, теперь пропало. Мы будем делать именно так, потому что, потому что на той
грани и так могло быть много точек, а мы добавляем всего, ну, как бы всего два
новых ребра. То есть, проще удалить одну и добавить два новых. Ну, просто, то есть,
по смыслу мы ровно это делаем, мы удаляем старую грань, добавляем новую, но с
точки зрения времени работы, будет проще добавить две новые точки в старую, чем
заводить новую, скажем так.
Нам удобнее хранить ребра, потому что, потому что реброинцидент на двум граням
всегда. Вот. Ну, и вообще, как бы, ребро более-менее однозначно задает грань,
которую нам принадлежит. Особенно, если мы ребра ориентируем в обе стороны, то есть, я
для каждого ребра ввожу два полуребра, то есть, ориентированный, одно вот такое,
другое вот такое. И если я считаю, что каждая грань обходится против всего
стрелки, если смотреть с внешности многогранника, тогда у него просто ребро
однозначно грани соответствует. А если мы как бы, как вершины храним, то, ну, короче,
непонятно. То есть, там много граней, непонятно какая из них. Собственно, как и
здесь, да, мы за опорную, за опорный привет, мы были, брали ребро. Относительно него
две крайние грани однозначно определены. Если бы мы брали вершину, то ничего бы не
получилось. Вот. Значит, давайте, что-то, что-то здесь попишу. Мы что-то перебираем,
рассматриваем точку в этом порядке.
Удаляем видимые грани,
видимые из нее грани. Сейчас, сейчас все проговорим. Видимые из нее грани. Значит,
я что-то удалил. Дальше, то, что я видел, образовывало какой-то контур. И вот мне
нужно в вершины этого контура провести еще ребра. Проводим ребра в вершины контура.
Вот. Ну, как-то, вот что-то такое мы хотим делать. Значит, да, что такое видимые грани
и невидимые грани? Это как раз очень просто. Смотрите, у нас каждая грань,
каждая грань многогранника разбивает пространство на два, на два полупространства. То, что лежит по ту же
сторону, что и многогранник, и по другую, по внешнюю сторону. Давайте просто говорим, что точка видит
грань, если она лежит во внешнем полупространстве относительно вот этой плоскости. Ну, то есть,
То есть как бы вот из нее, вот она и многогранник по разные стороны от этой плоскости.
Точка P видит грань F.
Ну или так, да.
Так, значит, P видит грань F.
Если P лежит в другом, ну я напишу открытом полупространстве, задаваемом F,
чем многогранник.
Открытая, то есть если я лежу на плоскости, то я считаю, что я грань не вижу.
Это как раз тот выраженный случай, если я из точки смотрю на плоскость, в которой я лежу, то я ее как бы не вижу.
Мне надо ее полностью обозреть.
Это мне нужно как раз подняться наверх, мне нужно быть над этой плоскостью.
Ну а там как-нибудь плоскость...
Ну как понять, например, вот если у меня есть какая-то грань, то тут, например, есть какие-то два ребра.
Ну давайте, давайте вот на этом примере.
Вот есть у меня такая грань, то есть у меня в ней два ребра, и есть какое-нибудь еще ребро вот такое вот ведущее в другую вершину.
Ну тогда как бы там одно смешанное произведение должно быть положительным,
вовнутрь вот туда вот в сторону многогранника должно быть положительным,
а во внешнюю сторону должно быть отрицательным.
Короче, смешанное произведение должно быть разных знаков.
То есть одно по одну сторону, другое по другую.
Содаваемом f, чем многогранник. То есть многограни по одну сторону от плоскости, точка p по другую.
Вот. Ну собственно все, вот так будем делать.
Значит в каждом моменте времени, для каждой точки я нахожу видимые грани.
Вот их там может быть много штук, если у меня какой-то сложный сейчас многогранник, я могу увидеть много граний.
Они там как-то, ну они образуют вот связанную область.
Я нахожу границу, нахожу контур этой грани, все что внутри удаляю и провожу ребра в контур.
Вот давайте тогда проговорим, что мы будем хранить.
Давайте пропишем, как хранить многогранник.
У меня будет три сущности, у меня будет вершина, у меня будет полуребро и у меня будет грань.
Для каждой из них будет свой, ну там не знаю, свой класс грубо говоря, своя какая-то сущность.
Что такое полуребро? Полуребро это как раз ориентированное ребро.
В случае с тетраедром я хочу сделать так, чтобы на каждой грани вот эти вот полуребро, ориентированные ребра были согласованы с обходом против щелвой стрелки.
То есть скажем вот для этой грани, для вот этого вот бокового треугольника я хочу, чтобы у меня ребра были ориентированы вот так вот.
Значит тогда я в частности для каждого вот такого полуребра, для каждого ориентированного ребра, буду скажем хранить ссылку или указатель на ту грань, которая лежит по правильную сторону, по левую сторону от ребра.
То есть у меня есть ребро вот это вот, по левую сторону лежит такая эта грань, по правую другая эта.
Вот давайте хранить то, что по левую руку.
Для полуребра храним указатель на грань по левую руку.
Ну и еще нужно хранить указатель на противоположное полуребро, то есть на то же ребро, проходимое в противоположную сторону.
Тогда у меня будет указатель вот с такого ребра на противоположное, вот на такое соответственно.
Ну и эта штука уже будет соответствовать вот такому правильному обходу моего вот этого другого треугольника и другой грани.
То есть у меня эта грань тоже обходится вот таким вот способом, ну и как бы у меня есть биекция между полуребром и гранями.
Ну не биекция в смысле, а в каком-то смысле однозначном отображение между полуребром и гранями.
Что каждая грань обходится таким-то набором ребер, а каждое полуребро задает такую-то грань.
То, что по левую руку от него ту гранину и задает.
Да, это вот ребро со стрелочкой.
Вот, ну какое-то такое, не знаю, так обычно называют.
Так, значит тогда, что мы хотим?
Значит, для новой точки П мы хотим удалить, ну собственно, я это уже писал, да, удалить все видимые грани.
Вот, это понятно?
А дальше мне нужно еще вот контур определить, да, по левому руку от него.
Если я знаю какие грани я вижу, мне еще нужно понять, какие вот были внешние ребра, которые я, в которые нужно провести грани.
Что это за ребра, скажите, пожалуйста?
То есть...
Еще раз?
Продолжающее что?
Да, я понял, я понял.
Но не только такие, потому что если я провожу в стол, то мне еще вот такие ребра надо.
Там вниз, вот в эти точки.
Вот я спрашиваю, как понять тот контур, в который нужно провести грани, нужно провести отрезки.
Да, именно так.
Давайте сделаем такое предположение.
Давайте считать, что я стою где-то вот здесь, многограни где-то там, я в этой точке смотрю на многограни и давайте нарисую, что я вижу.
Вот я вижу, какая там грани, там в этом месте.
Да, именно так. Давайте сделаем такое предположение. Давайте считать, что я стою где-то вот здесь,
многограни где-то там, я в этой точке смотрю на многограни, и давайте нарисую, что я вижу.
Я вижу какой-то такой вот выпуклый контур, который разбит на какие-то там выпуклые многоугольники.
Что-то такое. Соответственно, это какая-то грань наклона, это еще какая-то другая грань, и здесь есть какие-то ребра.
Мне нужно найти как раз вот эти вот внешние ребра, мне нужно удалить все, что здесь было внутри,
мне нужно все вот эти полуребра удалить, все эти грани стереть, мне нужно провести грани новые вот в эти крайние ребра.
Крайние это как раз те такие, что по одну сторону от них у меня получается грань видимая мной, а по другую невидимая.
Потому что для всех вот этих внутренних ребр как раз обе примыкающие к ней грани будут видимыми,
а для граничных как раз одна будет видимая, другая невидимая.
Поэтому контур, в который надо провести новые грани, это те полуребра, причем более того, здесь будет хорошая ориентация, вот такая вот на них,
потому что каждая грань обходится как раз будет против всего стрелки.
Значит, это те полуребра, что грань по левую руку видима, а по правую невидима.
Если я знаю список всех этих граней, которые надо удалить, я по ним прохожу, проверяю все полуребра, которые я здесь вижу,
и те из них, которые как раз такие граничные, в них надо провести новые грани.
И если заодно, то есть если я опускаю новую грань через точку, через новую пришедшую точку П, и вот то ребро, мне еще нужно понять,
а вот та другая грань, то есть смотрите, вот это полуребро было, оно соответствовало какой-то вот такой грани, который я удаляю, и какой-то другой такой боковой.
Если внезапно наша новая точка лежит в той же самой плоскости, которая вот по правую руку от того ребра лежала,
значит мне нужно склеить мой вводимый треугольник и то ли вот то боковое ребро, эту боковую грань.
Вот. Что-то такое будем делать. Ну да, да, да, да. Вот.
Вот. Отлично. Вот ровно это как раз надо починить. Потому что в целом мы как бы описали алгоритм.
Если мы храним наш многогранник в такой структуре, то вот приходит новая точка. Как ее обработать?
Надо найти все видимые грани. Кстати говоря, если она ни одной не видит, значит она внутри, ее можно скипнуть.
Чуть более хитро. Погодите, погодите. Давайте еще раз проговорю.
Вот приходит новая точка. Я должен понять, какие грани она видит, какие не видит. Если ни одной не видит, значит она внутри.
Потому что не видит, это значит, что она в том же полупространстве относительно всех граний, что и многогранник.
Значит, она лежит в пересечении полупространства, то есть внутри многогранника. Поэтому я ее скипаю.
А если она что-то видит, то значит ее нужно добавить. Все, что она видит, все вот эти грани, которые она видит, надо удалить.
И добавить новые вот такие вот треугольные грани. Если что, их склеить с продолжениями вот в тех же плоскостях.
Значит, все, что осталось, это научиться понимать видимые грани.
Как быстро находить видимые грани.
Очень просто. Давайте это хранить.
Вот в каждый момент времени для каждой грани и для каждой точки, ну или там просто типа,
давайте будем хранить для каждой еще не добавленной в оболочку точки, будем хранить те грани, которые она видит.
Ничего, не пугайтесь. В каждый момент для каждой точки храним список видимых граний.
Чего?
Не огромное. Вот не огромное будет.
Будем хранить это очень-очень простым образом. У меня будет двудольный граф.
Такой, что в одной доле будут еще не добавленные вершины. То есть вот вершины с номерами больше, чем текущие.
Начиная с какой-то P i и P plus 1 и так далее, вплоть до последней.
Во второй грани все присутствующие на данный момент грани моего многогранника. Все грани f1 и так далее fk.
Ну и просто типа вот граф, да, я провожу ребро между точкой и гранью, если из этой точки видна такая-то грань.
Вот у меня будет какой-то такой двудольный граф.
Для каждой точки я знаю видимые грани, для каждой грани знаю точки, из которых она видна.
Будем хранить такую структуру.
Вот. Ну давайте просто хранить не только выпуклую оболочку, но и раз я такую структуру обвожу, давайте покажем, как ее пересчитывать.
Это не просто двудольный граф. Одна доля это все еще не добавлены в оболочку точки.
Другая доля это все текущие грани, которые сейчас есть в многограннике.
Провожу ребро, если из точки видна грань.
Вот. Значит как этот граф хранить? Ну давайте с самого начала, да, вот мы начинаем с тетраэдра.
Давайте для тетраэдра посмотрим, как это сделать.
Ну вроде не очень сложно. У меня всего 4 грани.
Значит я завожу во второй доле 4 точки.
Здесь будут все элементы моего множества.
П5, П6 и так далее, ПН.
Ну и для каждой точки, для каждой грани я уж, ну, наверное, могу понять, видно оно или нет.
Это за линию причем делается.
Потому что у меня всего 4 грани и N точек.
Значит, старт, строим граф, давайте назову его граф видимости, граф видимости для тетраэдра.
Да, это работает причем за линию и тут никаких пока проблем нет.
Вот. И давайте теперь просто поймем, как этот граф перестраивается по дороге, по пути нашего алгоритма.
Что происходит с графом, когда мы вводим в рассмотрение новую точку, какие-то грани удаляем, какие-то новые добавляем.
Ну, во-первых, за счет того, что мы храним для каждой точки список видимых граний, мы точно знаем, что надо удалять.
То есть как раз вот мы сразу ответили на вопрос, как быстро находить видимые грани.
Очень просто, это просто список тех граний, в которые есть сейчас ребра.
Вот в этом графе, куда есть ребра.
У меня есть ребра во все вот эти грани, я их все вижу, я их все удаляю, строю новые грани.
Значит, единственная проблема, это понять, какие появились новые конфликты.
То есть какие теперь появились новые видимости, потому что я ввел новые грани.
Мне нужно для них понять, какие точки их видят.
Значит, после рассмотрения очередной точки
появляются новые грани.
Ну, соответственно, для каждой из них и для каждой из оставшихся точек надо понять, видна эта грани или нет.
Вот. Хорошо.
И это делается, на удивление, тоже несложно.
Потому что смотрите, какие грани мы вводим.
Вот если вот это была наша видимая область, вот эти грани были видимы, я их все удалил,
то я ввожу грани, ну, давайте в простом случае, являющиеся треугольниками с вершиной в этой точке
и с основаниями в каждом из вот этих вот ребер.
То есть вот я прохожу по контуру, такие вот все треугольнички делаю.
С вершиной в этой точке и с основаниями в этих ребрах.
Так, то есть, да вот давайте, есть какое-то ребро Е.
Тогда я утверждаю, что та новая грань, которую я построил,
вот если новая построенная грань видна из какой-то точки ПЖ,
то тогда обязательно хотя бы одна из грани инцидентных этому ребру в старом многограннике была тоже видна из ПЖ.
Значит, картинка.
Вот ребро Е.
Вот, давайте я нарисую вот такую одну грань,
и вот там где-то будет другая грань.
Такая книжечка, так, не очень, давайте наоборот.
Так вот, и вот так вот.
То есть такая книжечка, опять у меня вот это ребро, есть вот одна такая страничка, другая вот такая страничка.
Вот до этого, до того как я перешел к новой точке П,
у меня это ребро было инцидентно двум граням, вот этой и вот той.
Дальше пришла какая-то точка П, давайте скажу, где-то она вот здесь, вот она где-то вот здесь.
Она одну грань видит, другую не видит.
Как раз у нас ребра Е, которые лежат на контуре, это такие, что одна грань видима, другая не видима.
Я что?
Еще раз?
Я нарисовал только граней, в смысле.
Эта грань, типа понятно, они там как-то еще до замыкаются, до всего многогранника.
Я просто нарисовал вот эти две полуплоскости.
Ну да.
Вот.
Значит, из точки П была видна вот эта грань.
Значит, я ее удаляю и в частности провожу вот такую новую грань.
Так, ну давайте где-нибудь ее вот здесь вот нарисую.
Вот здесь вот.
Ну, соответственно, у меня теперь, у меня была вот такая наклонная полоска, стала вот такая.
И все вот здесь вот лежит в многограннике.
Значит, тогда утверждение следующее.
Пусть F, новая грань,
новая грань,
построенная по П или Бруге,
и пусть F1, F2, это старая грань инцидентной Е.
То есть вот эти две странички F1, F2, это старые грани, которые раньше были инцидентны Е.
Тогда я утверждаю, что ПЖ видит F,
то есть если ПЖ видит F, то она видела хотя бы одну из двух старых граней.
ПЖ видела F1 или ПЖ видела F2.
Ну почему?
Потому что если ПЖ видит F, смотрите, то есть я по факту что я сделал,
вот у меня при ребре Е была какая-то книжка вот с таким углом, скажем.
Я взял и одну из граней чуть-чуть поднял, у меня увеличился угол.
То есть у меня был сначала такой угол, теперь стал вот такой угол.
Угол стал побольше.
И теперь я проверяю, какие точки видят вот эту грань новую.
Ну раз ПЖ видит эту новую грань, то она в частности видит ребро Е.
Это что значит?
Вот если я через это ребро проведу какую-нибудь плоскость,
то значит по крайней мере...
Сейчас, не так.
То есть внутри, если мне где-то здесь...
Ну да, еще раз смотрите.
У меня даже есть книжечка.
Вот представьте, вот это...
Значит вот это старое ребро Е...
Извините, пожалуйста.
Значит это старое ребро Е.
Это F1 и F2, которые я удаляю.
Приходит новая грань F, скажем, где-то вот здесь.
Я хочу сказать, что это старое ребро Е.
Приходит новая грань F, скажем, где-то вот здесь.
Я хочу сказать, что если кто-то ее видит,
то она обязательно видела либо вот эту заднюю грань, либо переднюю.
Ну почему?
Давайте я какую-нибудь плоскость проведу через это ребро Е.
Какую-нибудь плоскость через это ребро Е
между вот этими гранями F1 и F2.
Тогда, чтобы видеть новую грань...
И давайте посмотрим, где наша новая точка ПЖ лежит.
Она лежит как бы либо по одну сторону от этой плоскости, либо по другую.
Если она лежит по эту сторону, то...
Что, она обязательно одну из них видит, что ли?
Ну, кажется, да.
То есть если точка видит новую грань, то она, в частности, видит это ребро.
Поэтому если она лежала, скажем, в этом полупространстве,
она видела вот эту заднюю грань.
Если она лежала в этом полупространстве, она видит вот эту грань.
Поэтому если у нас есть новая какая-то грань, содержащая то же самое ребро Е,
то хотя бы одну из старых граней она обязательно видела.
То есть либо по одну сторону от плоскости, либо по другую.
И хотя бы что-то мы точно видим.
Как-то так.
Упражнения.
Вот.
И тогда, чтобы понять, какие новые появились конфликты с новой гранью F,
мне достаточно просто перебрать конфликты, которые имела F1 или F2.
У меня получится какой-то номер точек, и для каждой из этих надо проверить,
образует ли она конфликт с новой гранью F.
Ну, конфликт-видимость, да, то есть.
Чего?
Значит, чтобы найти все Pj, из которых видна F,
значит, мы перебираем все точки, из которых видны хотя бы одна F1 или F2.
Перебираем все точки, из которых видна F1.
в которых видна f, значит мы перебираем все точки,
из которых видны хотя бы одна f1 или f2, перебираем
все точки, из которых видны f1 или f2, но это легко сделать,
потому что у меня есть вот такой вдольный граф,
точки из которых видна данная грань, это просто те, ну
как бы, откуда есть ребро в данную вот конкретную
f.
Я перебираю все такие точки, тестирую их на видимость,
ну и если как бы тест пройден, то есть если она лежит по
там правильную сторону от f, то я ввожу новый конфликт,
ввожу условие, что эта точка видит ту грань, которую
я только что добавил.
Вот.
Теперь все.
Да, если у нас какой-то треугольник склеивается с одной старой
граней, то на самом деле мне нужно просто отождествить,
ну давайте еще раз картинку вот эту вот со столом сделаем.
Вот, если у меня точка, то есть вот если я из этой точки
вижу какое-то ребро g, которое склеивается с одной из
старых граней, то по факту я просто я не ввожу новую
вершину, то есть смотрите, вот здесь, когда я там обрамлял
контур, я ввожу новые грани, вот это вот f, я ввожу новую
вершину вот в ту правую долю.
Если же строимый треугольник лежит в той же плоскости,
что и соответствующая грань, которую я не удаляю, значит
я просто не ввожу новую вершину и говорю, что этот
треугольник задает ту же грань, ту же вершину в
графе, что и вот эта вот грань.
По факту я просто две грани склеиваю и не ввожу
новой вершины в правую долю, а поскольку у меня плоскость
задающая грань осталась той же самой, то и видимость
у меня все те же самые, раз плоскость та же самая,
то и все видимости сохранились, потому что плоскость не
изменилась.
Это как раз случай простой, что если мы лежим в той
же плоскости, что одна из граней, мы просто склеиваем
и вот это даже делать ничего не нужно, а если она где-то
вот здесь, да, я там какие-то грани удаляю, то мне нужно
протестировать для каждого ребра, вот для каждого
ребра, который я здесь перебираю, для каждого контурного
ребра, я тестирую вот эти две грани, смотрю на все,
на все точки, которые из них видны, и каждую из
них проверяю, а видно ли теперь из этой точки вот
эту новую грань.
Если видно, то добавляю это условие.
Ну мы не обязаны, но как бы достаточно их точно
перебрать.
Ну то есть если отсюда следует это, то значит любая точка
в объединении вот этих множеств, если она удалится
этому условию, то мы как раз все переберем.
Нет, нет, нет, ну мы просто проходим все в тупую по объединению.
Не достаточно, не достаточно, нам как раз именно по объединению
надо пройтись.
Нет, нет, здесь дизъюнция, да, да, да, да, квадратная
скобка.
Вот, ну и все, утверждается, что тогда такая штука
вся работает в среднем за n лог n, да, что?
Говорю, если больше число размерности, то там, во-первых,
квадратичное число может быть граней, и что вообще
такое грань, я не знаю, я не знаю, что такое пространство
является грань, это для меня too much, выше чем R3 я не умею
разговаривать со всем.
Давай, расскажете?
Так, все ли я сказал здесь, что надо?
Кажется все хорошо.
Вопросы, может какие-то?
Давайте.
Это вот новая грань, смотрите, у меня новая добавляемая
точка, вот я рассмотрел точку P, я понял, что из нее,
ну скажем, вот F1 была видна, я тогда удаляю все, что было
вот здесь, E это одна из контурных граней, одна из контурных
ребер, я провожу новую плоскость, вот эту вот F, через P и
ребро E.
Так вот, я ввел новую грань, мне нужно понять, какие точки,
то есть смотрите, у меня появилась новая грань, значит по факту
появилась новая вершина вот этой правой доли, мне
нужно понять, из каких точек она видна, вот я сейчас перебираю
все вот эти точки, ну там пусть беру какую-то ПЖ, вот
я тоже что нужно привести ребро из ПЖ в F, то есть она
видит F только в случае, если она видела хотя бы одну
из двух старых граней инцидентных E.
Ну давайте без доказательств, ну типа вот, тут опять на
картинке, ну типа вот, ну я вот там с книжкой пытался
показать, то есть еще раз, вот у вас были две грань
инцидентная E, вот эта вот книжка, пришел как бы,
угол немножко расширился, чтобы видеть вторую грань
надо было видеть хотя бы одну из двух старых.
Берите с собой.
Все, спасибо.
